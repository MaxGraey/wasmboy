'use strict';(function(){function ua(a){return a.data?a.data:a}function Z(a,b){Ea?self.postMessage(a,b):Pa.postMessage(a,b)}function va(a,b){a||console.error("workerapi: No callback was provided to onMessage!");if(b)if(Ea)b.onmessage=a;else b.on("message",a);else if(Ea)self.onmessage=a;else Pa.on("message",a)}function N(a,b,f){b||(b=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),Fa++,b=`${b}-${Fa}`,1E5<Fa&&(Fa=0));return{workerId:f,messageId:b,message:a}}function vb(a,b){b=ua(b);switch(b.message.type){case C.GET_CONSTANTS:a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION=
a.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf(),a.WASMBOY_CURRENT_FRAME_SIZE=a.wasmInstance.exports.FRAME_SIZE.valueOf(),a.graphicsWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:a.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf()},b.messageId))}}function wb(a,b){b=ua(b);switch(b.message.type){case C.GET_CONSTANTS:a.WASMBOY_SOUND_OUTPUT_LOCATION=a.wasmInstance.exports.soundOutputLocation.valueOf();a.audioWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,
WASMBOY_SOUND_OUTPUT_LOCATION:a.wasmInstance.exports.soundOutputLocation.valueOf()},b.messageId));break;case C.AUDIO_LATENCY:a.currentAudioLatencyInSeconds=b.message.latency}}function xb(a,b){b=ua(b);switch(b.message.type){case C.SET_JOYPAD_STATE:a.wasmInstance.exports.setJoypadState.apply(a,b.message.setJoypadStateParamsAsArray)}}function $a(a){if(!a.wasmByteMemory)return new Uint8Array;let b=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327],f=void 0;if(0===b)return new Uint8Array;1<=b&&3>=b?f=
32768:5<=b&&6>=b?f=2048:15<=b&&19>=b?f=32768:25<=b&&30>=b&&(f=131072);return f?a.wasmByteMemory.slice(a.WASMBOY_GAME_RAM_BANKS_LOCATION,a.WASMBOY_GAME_RAM_BANKS_LOCATION+f):new Uint8Array}function ab(a){a.wasmInstance.exports.saveState();return a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_STATE_LOCATION,a.WASMBOY_INTERNAL_STATE_LOCATION+a.WASMBOY_INTERNAL_STATE_SIZE)}function yb(a,b){b=ua(b);switch(b.message.type){case C.CLEAR_MEMORY:for(var c=0;c<=a.wasmByteMemory.length;c++)a.wasmByteMemory[c]=0;c=
a.wasmByteMemory.slice(0);a.memoryWorkerPort.postMessage(N({type:C.CLEAR_MEMORY_DONE,wasmByteMemory:c.buffer},b.messageId),[c.buffer]);break;case C.GET_CONSTANTS:a.WASMBOY_GAME_BYTES_LOCATION=a.wasmInstance.exports.gameBytesLocation.valueOf();a.WASMBOY_GAME_RAM_BANKS_LOCATION=a.wasmInstance.exports.gameRamBanksLocation.valueOf();a.WASMBOY_INTERNAL_STATE_SIZE=a.wasmInstance.exports.wasmBoyInternalStateSize.valueOf();a.WASMBOY_INTERNAL_STATE_LOCATION=a.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf();
a.WASMBOY_INTERNAL_MEMORY_SIZE=a.wasmInstance.exports.gameBoyInternalMemorySize.valueOf();a.WASMBOY_INTERNAL_MEMORY_LOCATION=a.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf();a.WASMBOY_PALETTE_MEMORY_SIZE=a.wasmInstance.exports.gameboyColorPaletteSize.valueOf();a.WASMBOY_PALETTE_MEMORY_LOCATION=a.wasmInstance.exports.gameboyColorPaletteLocation.valueOf();a.memoryWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,WASMBOY_GAME_BYTES_LOCATION:a.wasmInstance.exports.gameBytesLocation.valueOf(),
WASMBOY_GAME_RAM_BANKS_LOCATION:a.wasmInstance.exports.gameRamBanksLocation.valueOf(),WASMBOY_INTERNAL_STATE_SIZE:a.wasmInstance.exports.wasmBoyInternalStateSize.valueOf(),WASMBOY_INTERNAL_STATE_LOCATION:a.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf(),WASMBOY_INTERNAL_MEMORY_SIZE:a.wasmInstance.exports.gameBoyInternalMemorySize.valueOf(),WASMBOY_INTERNAL_MEMORY_LOCATION:a.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf(),WASMBOY_PALETTE_MEMORY_SIZE:a.wasmInstance.exports.gameboyColorPaletteSize.valueOf(),
WASMBOY_PALETTE_MEMORY_LOCATION:a.wasmInstance.exports.gameboyColorPaletteLocation.valueOf()},b.messageId));break;case C.SET_MEMORY:c=Object.keys(b.message);c.includes(F.CARTRIDGE_ROM)&&a.wasmByteMemory.set(new Uint8Array(b.message[F.CARTRIDGE_ROM]),a.WASMBOY_GAME_BYTES_LOCATION);c.includes(F.CARTRIDGE_RAM)&&a.wasmByteMemory.set(new Uint8Array(b.message[F.CARTRIDGE_RAM]),a.WASMBOY_GAME_RAM_BANKS_LOCATION);c.includes(F.GAMEBOY_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(b.message[F.GAMEBOY_MEMORY]),
a.WASMBOY_INTERNAL_MEMORY_LOCATION);c.includes(F.PALETTE_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(b.message[F.PALETTE_MEMORY]),a.WASMBOY_PALETTE_MEMORY_LOCATION);c.includes(F.INTERNAL_STATE)&&(a.wasmByteMemory.set(new Uint8Array(b.message[F.INTERNAL_STATE]),a.WASMBOY_INTERNAL_STATE_LOCATION),a.wasmInstance.exports.loadState());a.memoryWorkerPort.postMessage(N({type:C.SET_MEMORY_DONE},b.messageId));break;case C.GET_MEMORY:{c={type:C.GET_MEMORY};const f=[];var t=b.message.memoryTypes;if(t.includes(F.CARTRIDGE_ROM)){if(a.wasmByteMemory){var x=
a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327];var d=void 0;0===x?d=32768:1<=x&&3>=x?d=2097152:5<=x&&6>=x?d=262144:15<=x&&19>=x?d=2097152:25<=x&&30>=x&&(d=8388608);x=d?a.wasmByteMemory.slice(a.WASMBOY_GAME_BYTES_LOCATION,a.WASMBOY_GAME_BYTES_LOCATION+d):new Uint8Array}else x=new Uint8Array;x=x.buffer;c[F.CARTRIDGE_ROM]=x;f.push(x)}t.includes(F.CARTRIDGE_RAM)&&(x=$a(a).buffer,c[F.CARTRIDGE_RAM]=x,f.push(x));t.includes(F.CARTRIDGE_HEADER)&&(a.wasmByteMemory?(x=a.WASMBOY_GAME_BYTES_LOCATION+308,
x=a.wasmByteMemory.slice(x,x+27)):x=new Uint8Array,x=x.buffer,c[F.CARTRIDGE_HEADER]=x,f.push(x));t.includes(F.GAMEBOY_MEMORY)&&(x=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer,c[F.GAMEBOY_MEMORY]=x,f.push(x));t.includes(F.PALETTE_MEMORY)&&(x=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer,c[F.PALETTE_MEMORY]=x,f.push(x));t.includes(F.INTERNAL_STATE)&&
(a.wasmInstance.exports.saveState(),t=ab(a).buffer,c[F.INTERNAL_STATE]=t,f.push(t));a.memoryWorkerPort.postMessage(N(c,b.messageId),f)}}}function p(a,b){return(a&255)<<8|b&255}function H(a){return(a&65280)>>8}function M(a,b){return b&~(1<<a)}function n(a,b){return 0!=(b&1<<a)}function Qa(a){var b=a;n(7,b)&&(b=-1*(256-a));return b}function Ga(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function l(a){Ga(7,a)}function q(a){Ga(6,a)}function D(a){Ga(5,a)}function w(a){Ga(4,
a)}function na(){return b.registerF>>7&1}function Q(){return b.registerF>>4&1}function O(a,b){0<=b?0!==((a&15)+(b&15)&16)?D(1):D(0):(Math.abs(b)&15)>(a&15)?D(1):D(0)}function Ra(a,b){0<=b?a>(a+b&255)?w(1):w(0):Math.abs(b)>a?w(1):w(0)}function sa(a,b,f){f?(a=a^b^a+b,0!==(a&16)?D(1):D(0),0!==(a&256)?w(1):w(0)):(f=a+b&65535,f<a?w(1):w(0),0!==((a^b^f)&4096)?D(1):D(0))}function Ha(a,b,f){void 0===f&&(f=!1);var c=a;f||(c=y(b)>>2*a&3);a=242;switch(c){case 1:a=160;break;case 2:a=88;break;case 3:a=8}return a}
function Ia(a,b,f){b=8*a+2*b;a=bb(b+1,f);f=bb(b,f);return p(a,f)}function aa(a,b){return 8*((b&31<<5*a)>>5*a)}function bb(a,b){a&=63;b&&(a+=64);return h[67584+a]}function Ja(a,b,f,t){void 0===f&&(f=0);void 0===t&&(t=!1);f&=3;t&&(f|=4);h[69632+(160*b+a)]=f}function cb(a,b,f,t,x,d,k,e,l,p,g,m,oa){void 0===g&&(g=!1);void 0===m&&(m=0);void 0===oa&&(oa=-1);var c=0;b=wa(b,a);a=X(b+2*d,f);f=X(b+2*d+1,f);for(d=t;d<=x;d++)if(b=k+(d-t),b<l){var B=d;if(0>oa||!n(5,oa))B=7-B;var ta=0;n(B,f)&&(ta+=1,ta<<=1);n(B,
a)&&(ta+=1);if(0<=oa){var q=Ia(oa&7,ta,!1);B=aa(0,q);var u=aa(1,q);q=aa(2,q)}else 0>=m&&(m=r.memoryLocationBackgroundPalette),u=B=q=Ha(ta,m,g);var y=3*(e*l+b);h[p+y]=B;h[p+y+1]=u;h[p+y+2]=q;B=!1;0<=oa&&(B=n(7,oa));Ja(b,e,ta,B);c++}return c}function wa(a,b){if(a===r.memoryLocationTileDataSelectZeroStart){var c=b+128;n(7,b)&&(c=b-128);return a+16*c}return a+16*b}function db(a,b){switch(a){case 1:return n(b,129);case 2:return n(b,135);case 3:return n(b,126);default:return n(b,1)}}function eb(){var a=
fb();2047>=a&&0<z.NRx0SweepShift&&(z.sweepShadowFrequency=a,z.setFrequency(a),a=fb());2047<a&&(z.isEnabled=!1)}function fb(){var a=z.sweepShadowFrequency;a>>=z.NRx0SweepShift;return a=z.NRx0Negate?z.sweepShadowFrequency-a:z.sweepShadowFrequency+a}function Ka(a){switch(a){case z.channelNumber:if(u.channel1DacEnabled!==z.isDacEnabled)return u.channel1DacEnabled=z.isDacEnabled,!0;break;case K.channelNumber:if(u.channel2DacEnabled!==K.isDacEnabled)return u.channel2DacEnabled=K.isDacEnabled,!0;break;case I.channelNumber:if(u.channel3DacEnabled!==
I.isDacEnabled)return u.channel3DacEnabled=I.isDacEnabled,!0;break;case L.channelNumber:if(u.channel4DacEnabled!==L.isDacEnabled)return u.channel4DacEnabled=L.isDacEnabled,!0}return!1}function La(){if(!(e.currentCycles<e.batchProcessCycles()))for(;e.currentCycles>=e.batchProcessCycles();)gb(e.batchProcessCycles()),e.currentCycles-=e.batchProcessCycles()}function gb(a){e.frameSequenceCycleCounter+=a;if(e.frameSequenceCycleCounter>=e.maxFrameSequenceCycles()){e.frameSequenceCycleCounter-=e.maxFrameSequenceCycles();
switch(e.frameSequencer){case 0:z.updateLength();K.updateLength();I.updateLength();L.updateLength();break;case 2:z.updateLength();K.updateLength();I.updateLength();L.updateLength();z.updateSweep();break;case 4:z.updateLength();K.updateLength();I.updateLength();L.updateLength();break;case 6:z.updateLength();K.updateLength();I.updateLength();L.updateLength();z.updateSweep();break;case 7:z.updateEnvelope(),K.updateEnvelope(),L.updateEnvelope()}e.frameSequencer+=1;8<=e.frameSequencer&&(e.frameSequencer=
0);var b=!0}else b=!1;if(R.audioAccumulateSamples&&!b){b=z.willChannelUpdate(a)||Ka(z.channelNumber);var f=K.willChannelUpdate(a)||Ka(K.channelNumber),t=I.willChannelUpdate(a)||Ka(I.channelNumber),x=L.willChannelUpdate(a)||Ka(L.channelNumber);b&&(u.channel1Sample=z.getSampleFromCycleCounter());f&&(u.channel2Sample=K.getSampleFromCycleCounter());t&&(u.channel3Sample=I.getSampleFromCycleCounter());x&&(u.channel4Sample=L.getSampleFromCycleCounter());if(b||f||t||x)u.needToRemixSamples=!0;e.downSampleCycleCounter+=
a*e.downSampleCycleMultiplier;e.downSampleCycleCounter>=e.maxDownSampleCycles()&&(e.downSampleCycleCounter-=e.maxDownSampleCycles(),(u.needToRemixSamples||u.mixerVolumeChanged||u.mixerEnabledChanged)&&hb(u.channel1Sample,u.channel2Sample,u.channel3Sample,u.channel4Sample),a=u.rightChannelSampleUnsignedByte+1,b=588800+2*e.audioQueueIndex,h[b]=u.leftChannelSampleUnsignedByte+1+1,h[b+1]=a+1,e.audioQueueIndex+=1,e.audioQueueIndex>=e.wasmBoyMemoryMaxBufferSize/2-1&&--e.audioQueueIndex)}else b=z.getSample(a),
f=K.getSample(a),t=I.getSample(a),x=L.getSample(a),u.channel1Sample=b,u.channel2Sample=f,u.channel3Sample=t,u.channel4Sample=x,e.downSampleCycleCounter+=a*e.downSampleCycleMultiplier,e.downSampleCycleCounter>=e.maxDownSampleCycles()&&(e.downSampleCycleCounter-=e.maxDownSampleCycles(),a=hb(b,f,t,x),b=H(a),f=588800+2*e.audioQueueIndex,h[f]=b+1+1,h[f+1]=(a&255)+2,e.audioQueueIndex+=1,e.audioQueueIndex>=e.wasmBoyMemoryMaxBufferSize/2-1&&--e.audioQueueIndex)}function Ma(){return e.audioQueueIndex}function Sa(){e.audioQueueIndex=
0}function hb(a,b,f,t){void 0===a&&(a=15);void 0===b&&(b=15);void 0===f&&(f=15);void 0===t&&(t=15);u.mixerVolumeChanged=!1;var c=0,d=0;c=e.NR51IsChannel1EnabledOnLeftOutput?c+a:c+15;c=e.NR51IsChannel2EnabledOnLeftOutput?c+b:c+15;c=e.NR51IsChannel3EnabledOnLeftOutput?c+f:c+15;c=e.NR51IsChannel4EnabledOnLeftOutput?c+t:c+15;d=e.NR51IsChannel1EnabledOnRightOutput?d+a:d+15;d=e.NR51IsChannel2EnabledOnRightOutput?d+b:d+15;d=e.NR51IsChannel3EnabledOnRightOutput?d+f:d+15;d=e.NR51IsChannel4EnabledOnRightOutput?
d+t:d+15;u.mixerEnabledChanged=!1;u.needToRemixSamples=!1;a=ib(c,e.NR50LeftMixerVolume+1);d=ib(d,e.NR50RightMixerVolume+1);u.leftChannelSampleUnsignedByte=a;u.rightChannelSampleUnsignedByte=d;return p(a,d)}function ib(a,b){if(60===a)return 127;a=1E5*(a-60)*b/8;a/=1E5;a+=60;a=1E5*a/(12E6/254);return a|=0}function Na(a){m.masterInterruptSwitch=!1;var c=y(m.memoryLocationInterruptRequest);c=M(a,c);m.interruptsRequestedValue=c;k(m.memoryLocationInterruptRequest,c);b.stackPointer-=2;c=b.stackPointer;var f=
b.programCounter,t=H(f),d=c+1;k(c,f&255);k(d,t);switch(a){case m.bitPositionVBlankInterrupt:m.isVBlankInterruptRequested=!1;b.programCounter=64;break;case m.bitPositionLcdInterrupt:m.isLcdInterruptRequested=!1;b.programCounter=72;break;case m.bitPositionTimerInterrupt:m.isTimerInterruptRequested=!1;b.programCounter=80;break;case m.bitPositionJoypadInterrupt:m.isJoypadInterruptRequested=!1,b.programCounter=96}}function xa(a){var b=y(m.memoryLocationInterruptRequest);b|=1<<a;m.interruptsRequestedValue=
b;k(m.memoryLocationInterruptRequest,b)}function Ta(a){for(var b=0;b<a;){var f=g.dividerRegister;b+=4;g.dividerRegister+=4;65535<g.dividerRegister&&(g.dividerRegister-=65536);g.timerEnabled&&(g.timerCounterOverflowDelay?(g.timerCounter=g.timerModulo,m.isTimerInterruptRequested=!0,xa(m.bitPositionTimerInterrupt),g.timerCounterOverflowDelay=!1,g.timerCounterWasReset=!0):g.timerCounterWasReset&&(g.timerCounterWasReset=!1),jb(f,g.dividerRegister)&&Ua())}}function Ua(){g.timerCounter+=1;255<g.timerCounter&&
(g.timerCounterOverflowDelay=!0,g.timerCounter=0)}function jb(a,b){var c=Va(g.timerInputClock);return n(c,a)&&!n(c,b)?!0:!1}function Va(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function pa(a){var c=b.isStopped=!1;zb(a)||(c=!0);ca(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,A.isDpadType&&c&&(a=!0),A.isButtonType&&!c&&(a=!0),a&&(m.isJoypadInterruptRequested=!0,xa(m.bitPositionJoypadInterrupt)))}function zb(a){switch(a){case 0:return A.up;case 1:return A.right;case 2:return A.down;
case 3:return A.left;case 4:return A.a;case 5:return A.b;case 6:return A.select;case 7:return A.start;default:return!1}}function ca(a,b){switch(a){case 0:A.up=b;break;case 1:A.right=b;break;case 2:A.down=b;break;case 3:A.left=b;break;case 4:A.a=b;break;case 5:A.b=b;break;case 6:A.select=b;break;case 7:A.start=b}}function kb(a,c,f){for(var t=0;t<f;t++){for(var x=lb(a+t),h=c+t;40959<h;)h-=8192;Oa(h,x)&&k(h,x)}a=32;b.GBCDoubleSpeed&&(a=64);d.DMACycles+=f/16*a}function Oa(a,c){var f=d.videoRamLocation,
t=d.spriteInformationTableLocation;if(a<f){if(!d.isRomOnly)if(8191>=a){if(!d.isMBC2||n(4,c))c&=15,0===c?d.isRamBankingEnabled=!1:10===c&&(d.isRamBankingEnabled=!0)}else 16383>=a?!d.isMBC5||12287>=a?(d.isMBC2&&(d.currentRomBank=c&15),d.isMBC1?(c&=31,d.currentRomBank&=224):d.isMBC3?(c&=127,d.currentRomBank&=128):d.isMBC5&&(d.currentRomBank&=0),d.currentRomBank|=c):(a=0,f=d.currentRomBank&255,0<c&&(a=1),d.currentRomBank=p(a,f)):!d.isMBC2&&24575>=a?d.isMBC1&&d.isMBC1RomModeEnabled?(d.currentRomBank&=
31,d.currentRomBank|=c&224):(c=d.isMBC5?c&15:c&3,d.currentRamBank=c):!d.isMBC2&&32767>=a&&d.isMBC1&&(n(0,c)?d.isMBC1RomModeEnabled=!0:d.isMBC1RomModeEnabled=!1);return!1}if(a>=f&&a<d.cartridgeRamLocation)return!0;if(a>=d.echoRamLocation&&a<t)return k(a-8192,c),!0;if(a>=t&&a<=d.spriteInformationTableLocationEnd)return 2>E.currentLcdMode?!1:!0;if(a>=d.unusableMemoryLocation&&a<=d.unusableMemoryEndLocation)return!1;if(65296<=a&&65318>=a){La();if(a===e.memoryLocationNR52||e.NR52IsSoundEnabled){switch(a){case z.memoryLocationNRx0:z.updateNRx0(c);
break;case I.memoryLocationNRx0:I.updateNRx0(c);break;case z.memoryLocationNRx1:z.updateNRx1(c);break;case K.memoryLocationNRx1:K.updateNRx1(c);break;case I.memoryLocationNRx1:I.updateNRx1(c);break;case L.memoryLocationNRx1:L.updateNRx1(c);break;case z.memoryLocationNRx2:z.updateNRx2(c);break;case K.memoryLocationNRx2:K.updateNRx2(c);break;case I.memoryLocationNRx2:I.volumeCodeChanged=!0;I.updateNRx2(c);break;case L.memoryLocationNRx2:L.updateNRx2(c);break;case z.memoryLocationNRx3:z.updateNRx3(c);
break;case K.memoryLocationNRx3:K.updateNRx3(c);break;case I.memoryLocationNRx3:I.updateNRx3(c);break;case L.memoryLocationNRx3:L.updateNRx3(c);break;case z.memoryLocationNRx4:n(7,c)&&(z.updateNRx4(c),z.trigger());break;case K.memoryLocationNRx4:n(7,c)&&(K.updateNRx4(c),K.trigger());break;case I.memoryLocationNRx4:n(7,c)&&(I.updateNRx4(c),I.trigger());break;case L.memoryLocationNRx4:n(7,c)&&(L.updateNRx4(c),L.trigger());break;case e.memoryLocationNR50:e.updateNR50(c);u.mixerVolumeChanged=!0;break;
case e.memoryLocationNR51:e.updateNR51(c);u.mixerEnabledChanged=!0;break;case e.memoryLocationNR52:if(e.updateNR52(c),!n(7,c))for(c=65296;65318>c;c++)k(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&La();if(a>=E.memoryLocationLcdControl&&a<=r.memoryLocationWindowX){if(a===E.memoryLocationLcdControl)return E.updateLcdControl(c),!0;if(a===r.memoryLocationScanlineRegister)return r.scanlineRegister=0,k(a,0),!1;if(a===E.memoryLocationCoincidenceCompare)return E.coincidenceCompare=c,!0;if(a===r.memoryLocationDmaTransfer){c<<=
8;for(a=0;159>=a;a++)f=y(c+a),k(d.spriteInformationTableLocation+a,f);d.DMACycles=644;return!0}switch(a){case r.memoryLocationScrollX:r.scrollX=c;break;case r.memoryLocationScrollY:r.scrollY=c;break;case r.memoryLocationWindowX:r.windowX=c;break;case r.memoryLocationWindowY:r.windowY=c}return!0}if(a===d.memoryLocationHdmaTrigger)return b.GBCEnabled&&(d.isHblankHdmaActive&&!n(7,c)?(d.isHblankHdmaActive=!1,c=y(d.memoryLocationHdmaTrigger),k(d.memoryLocationHdmaTrigger,c|128)):(a=y(d.memoryLocationHdmaSourceHigh),
f=y(d.memoryLocationHdmaSourceLow),a=p(a,f)&65520,f=y(d.memoryLocationHdmaDestinationHigh),t=y(d.memoryLocationHdmaDestinationLow),f=p(f,t),f=(f&8176)+d.videoRamLocation,t=M(7,c),t=16*(t+1),n(7,c)?(d.isHblankHdmaActive=!0,d.hblankHdmaTransferLengthRemaining=t,d.hblankHdmaSource=a,d.hblankHdmaDestination=f,k(d.memoryLocationHdmaTrigger,M(7,c))):(kb(a,f,t),k(d.memoryLocationHdmaTrigger,255)))),!1;if((a===d.memoryLocationGBCWRAMBank||a===d.memoryLocationGBCVRAMBank)&&d.isHblankHdmaActive&&(16384<=d.hblankHdmaSource&&
32767>=d.hblankHdmaSource||53248<=d.hblankHdmaSource&&57343>=d.hblankHdmaSource))return!1;if(a>=ya.memoryLocationBackgroundPaletteIndex&&a<=ya.memoryLocationSpritePaletteData){if(a===ya.memoryLocationBackgroundPaletteData||a===ya.memoryLocationSpritePaletteData){f=y(a-1);f=M(6,f);t=!1;a===ya.memoryLocationSpritePaletteData&&(t=!0);var x=f&63;t&&(x+=64);h[67584+x]=c;c=f;--a;n(7,c)&&k(a,c+1|128)}return!0}if(a>=g.memoryLocationDividerRegister&&a<=g.memoryLocationTimerControl){Ta(g.currentCycles);g.currentCycles=
0;switch(a){case g.memoryLocationDividerRegister:return g.updateDividerRegister(c),!1;case g.memoryLocationTimerCounter:g.updateTimerCounter(c);break;case g.memoryLocationTimerModulo:g.updateTimerModulo(c);break;case g.memoryLocationTimerControl:g.updateTimerControl(c)}return!0}a===A.memoryLocationJoypadRegister&&A.updateJoypad(c);if(a===m.memoryLocationInterruptRequest)return m.updateInterruptRequested(c),!0;a===m.memoryLocationInterruptEnabled&&m.updateInterruptEnabled(c);return!0}function Wa(a){switch(a>>
12){case 0:case 1:case 2:case 3:return a+850944;case 4:case 5:case 6:case 7:var c=d.currentRomBank;d.isMBC5||0!==c||(c=1);return 16384*c+(a-d.switchableCartridgeRomLocation)+850944;case 8:case 9:return c=0,b.GBCEnabled&&(c=y(d.memoryLocationGBCVRAMBank)&1),a-d.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*d.currentRamBank+(a-d.cartridgeRamLocation)+719872;case 12:return a-d.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=y(d.memoryLocationGBCWRAMBank)&7),1>c&&(c=1),
a-d.internalRamBankZeroLocation+18432+4096*(c-1);default:return a-d.echoRamLocation+51200}}function k(a,b){a=Wa(a);h[a]=b}function S(a,b){h[a]=b?1:0}function mb(a,c,f,t,d,k){for(var x=t>>3;160>d;d++){var e=d+k;256<=e&&(e-=256);var l=f+32*x+(e>>3),p=X(l,0),g=!1;if(R.tileCaching){var B=d;var m=a,q=e,u=l,w=p,v=0;if(0<m&&8<B&&w===da.tileId&&B===da.nextXIndexToPerformCacheCheck){var z=w=!1;n(5,y(u-1))&&(w=!0);n(5,y(u))&&(z=!0);for(u=0;8>u;u++)if(w!==z&&(u=7-u),160>=B+u){for(var A=B-(8-u),D=93184+3*(160*
m+(B+u)),C=0;3>C;C++)Y(B+u,m,C,h[D+C]);A=h[69632+(160*m+A)];Ja(B+u,m,M(2,A),n(2,A));v++}}else da.tileId=w;B>=da.nextXIndexToPerformCacheCheck&&(da.nextXIndexToPerformCacheCheck=B+8,m=q%8,B<m&&(da.nextXIndexToPerformCacheCheck+=m));B=v;0<B&&(d+=B-1,g=!0)}R.tileRendering&&!g?(g=d,B=a,v=c,m=t%8,q=0,0==g&&(q=e-e/8*8),e=7,160<g+8&&(e=160-g),w=-1,z=0,b.GBCEnabled&&(w=X(l,1),n(3,w)&&(z=1),n(6,w)&&(m=7-m)),B=cb(p,v,z,q,e,m,g,B,160,93184,!1,0,w),0<B&&(d+=B-1)):g||(b.GBCEnabled?(g=d,B=a,m=t,v=wa(c,p),l=X(l,
1),m%=8,n(6,l)&&(m=7-m),q=0,n(3,l)&&(q=1),p=X(v+2*m,q),v=X(v+2*m+1,q),m=e%8,n(5,l)||(m=7-m),e=0,n(m,v)&&(e=e+1<<1),n(m,p)&&(e+=1),m=Ia(l&7,e,!1),p=aa(0,m),v=aa(1,m),m=aa(2,m),Y(g,B,0,p),Y(g,B,1,v),Y(g,B,2,m),Ja(g,B,e,n(7,l))):(l=d,g=a,v=t,B=wa(c,p),v%=8,p=X(B+2*v,0),B=X(B+2*v+1,0),v=7-e%8,e=0,n(v,B)&&(e=e+1<<1),n(v,p)&&(e+=1),p=Ha(e,r.memoryLocationBackgroundPalette),Y(l,g,0,p),Y(l,g,1,p),Y(l,g,2,p),Ja(l,g,e)))}}function nb(a){if(E.enabled)for(r.scanlineCycleCounter+=a;r.scanlineCycleCounter>=r.MAX_CYCLES_PER_SCANLINE();){r.scanlineCycleCounter-=
r.MAX_CYCLES_PER_SCANLINE();a=r.scanlineRegister;if(144===a){if(R.graphicsDisableScanlineRendering)for(var b=0;144>=b;b++)Xa(b);else Xa(a);for(b=0;144>b;b++)for(var f=0;160>f;f++)h[69632+(160*b+f)]=0;da.tileId=-1;da.nextXIndexToPerformCacheCheck=-1}else 144>a&&(R.graphicsDisableScanlineRendering||Xa(a));a=153<a?0:a+1;r.scanlineRegister=a}if(E.enabled){if(a=r.scanlineRegister,f=E.currentLcdMode,b=0,144<=a?b=1:r.scanlineCycleCounter>=r.MIN_CYCLES_SPRITES_LCD_MODE()?b=2:r.scanlineCycleCounter>=r.MIN_CYCLES_TRANSFER_DATA_LCD_MODE()&&
(b=3),f!==b){f=y(E.memoryLocationLcdStatus);E.currentLcdMode=b;var t=!1;switch(b){case 0:f=M(0,f);f=M(1,f);t=n(3,f);break;case 1:f=M(1,f);f|=1;t=n(4,f);break;case 2:f=M(0,f);f|=2;t=n(5,f);break;case 3:f|=3}t&&(m.isLcdInterruptRequested=!0,xa(m.bitPositionLcdInterrupt));0===b&&d.isHblankHdmaActive&&(t=16,d.hblankHdmaTransferLengthRemaining<t&&(t=d.hblankHdmaTransferLengthRemaining),kb(d.hblankHdmaSource,d.hblankHdmaDestination,t),d.hblankHdmaSource+=t,d.hblankHdmaDestination+=t,d.hblankHdmaTransferLengthRemaining-=
t,0>=d.hblankHdmaTransferLengthRemaining?(d.isHblankHdmaActive=!1,k(d.memoryLocationHdmaTrigger,255)):k(d.memoryLocationHdmaTrigger,M(7,d.hblankHdmaTransferLengthRemaining/16-1)));1===b&&(m.isVBlankInterruptRequested=!0,xa(m.bitPositionVBlankInterrupt));t=E.coincidenceCompare;0!==b&&1!==b||a!==t?f=M(2,f):(f|=4,n(6,f)&&(m.isLcdInterruptRequested=!0,xa(m.bitPositionLcdInterrupt)));k(E.memoryLocationLcdStatus,f)}}else r.scanlineCycleCounter=0,r.scanlineRegister=0,k(r.memoryLocationScanlineRegister,0),
f=y(E.memoryLocationLcdStatus),f=M(1,f),f=M(0,f),E.currentLcdMode=0,k(E.memoryLocationLcdStatus,f)}function Xa(a){var c=r.memoryLocationTileDataSelectZeroStart;E.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);if(b.GBCEnabled||E.bgDisplayEnabled){var f=r.memoryLocationTileMapSelectZeroStart;E.bgTileMapDisplaySelect&&(f=r.memoryLocationTileMapSelectOneStart);var t=r.scrollX,d=a+r.scrollY;256<=d&&(d-=256);mb(a,c,f,d,0,t)}E.windowDisplayEnabled&&(f=r.memoryLocationTileMapSelectZeroStart,
E.windowTileMapDisplaySelect&&(f=r.memoryLocationTileMapSelectOneStart),t=r.windowX,d=r.windowY,a<d||(t-=7,mb(a,c,f,a-d,t,-1*t)));if(E.spriteDisplayEnable)for(c=E.tallSpriteSize,f=39;0<=f;f--){d=4*f;var e=y(r.memoryLocationSpriteAttributesTable+d);t=y(r.memoryLocationSpriteAttributesTable+d+1);var k=y(r.memoryLocationSpriteAttributesTable+d+2);e-=16;t-=8;var l=8;c&&(l=16,1===k%2&&--k);if(a>=e&&a<e+l){d=y(r.memoryLocationSpriteAttributesTable+d+3);var m=n(7,d),g=n(6,d),p=n(5,d);e=a-e;g&&(e-=l,e*=-1,
--e);e*=2;k=wa(r.memoryLocationTileDataSelectOneStart,k);l=k+=e;e=0;b.GBCEnabled&&n(3,d)&&(e=1);k=X(l,e);l=X(l+1,e);for(e=7;0<=e;e--){g=e;p&&(g-=7,g*=-1);var q=0;n(g,l)&&(q+=1,q<<=1);n(g,k)&&(q+=1);if(0!==q&&(g=t+(7-e),0<=g&&160>=g)){var u=!1,v=!1,w=!1;b.GBCEnabled&&!E.bgDisplayEnabled&&(u=!0);if(!u){var z=h[69632+(160*a+g)],A=z&3;m&&0<A?v=!0:b.GBCEnabled&&n(2,z)&&0<A&&(w=!0)}if(u||!v&&!w)b.GBCEnabled?(v=Ia(d&7,q,!0),q=aa(0,v),u=aa(1,v),v=aa(2,v),Y(g,a,0,q),Y(g,a,1,u),Y(g,a,2,v)):(u=r.memoryLocationSpritePaletteOne,
n(4,d)&&(u=r.memoryLocationSpritePaletteTwo),q=Ha(q,u),Y(g,a,0,q),Y(g,a,1,q),Y(g,a,2,q))}}}}}function Y(a,b,f,d){h[93184+3*(160*b+a)+f]=d}function X(a,b){return h[a-d.videoRamLocation+2048+8192*(b&1)]}function Ya(a){var b=d.videoRamLocation;return a<b||a>=b&&a<d.cartridgeRamLocation?-1:a>=d.echoRamLocation&&a<d.spriteInformationTableLocation?y(a-8192):a>=d.spriteInformationTableLocation&&a<=d.spriteInformationTableLocationEnd?2>E.currentLcdMode?255:-1:a===r.memoryLocationScanlineRegister?(k(a,r.scanlineRegister),
r.scanlineRegister):65296<=a&&65318>=a?(La(),a=a===e.memoryLocationNR52?y(e.memoryLocationNR52)&128|112:-1,a):65328<=a&&65343>=a?(La(),-1):a===g.memoryLocationDividerRegister?(b=H(g.dividerRegister),k(a,b),b):a===g.memoryLocationTimerCounter?(k(a,g.timerCounter),g.timerCounter):a===A.memoryLocationJoypadRegister?(a=A.joypadRegisterFlipped,A.isDpadType?(a=A.up?M(2,a):a|4,a=A.right?M(0,a):a|1,a=A.down?M(3,a):a|8,a=A.left?M(1,a):a|2):A.isButtonType&&(a=A.a?M(0,a):a|1,a=A.b?M(1,a):a|2,a=A.select?M(2,
a):a|4,a=A.start?M(3,a):a|8),a|240):-1}function y(a){return h[Wa(a)]}function lb(a){var b=Ya(a);switch(b){case -1:return y(a);default:return b}}function T(a){return 0<h[a]?!0:!1}function ea(a){O(b.registerA,a);Ra(b.registerA,a);b.registerA=b.registerA+a&255;0===b.registerA?l(1):l(0);q(0)}function fa(a){var c=b.registerA+a+Q()&255;0!=((b.registerA^a^c)&16)?D(1):D(0);0<(b.registerA+a+Q()&256)?w(1):w(0);b.registerA=c;0===b.registerA?l(1):l(0);q(0)}function ha(a){var c=-1*a;O(b.registerA,c);Ra(b.registerA,
c);b.registerA=b.registerA-a&255;0===b.registerA?l(1):l(0);q(1)}function ia(a){var c=b.registerA-a-Q()&255;0!=((b.registerA^a^c)&16)?D(1):D(0);0<(b.registerA-a-Q()&256)?w(1):w(0);b.registerA=c;0===b.registerA?l(1):l(0);q(1)}function ja(a){b.registerA&=a;0===b.registerA?l(1):l(0);q(0);D(1);w(0)}function ka(a){b.registerA=(b.registerA^a)&255;0===b.registerA?l(1):l(0);q(0);D(0);w(0)}function la(a){b.registerA|=a;0===b.registerA?l(1):l(0);q(0);D(0);w(0)}function ma(a){a*=-1;O(b.registerA,a);Ra(b.registerA,
a);0===b.registerA+a?l(1):l(0);q(1)}function qa(a,b){0===(b&1<<a)?l(1):l(0);q(0);D(1);return b}function W(a,b,f){return 0<b?f|1<<a:f&~(1<<a)}function za(a){a=Qa(a);b.programCounter=b.programCounter+a&65535;b.programCounter=b.programCounter+1&65535}function ob(a){b.programCounter=b.programCounter+1&65535;switch((a&240)>>4){case 0:return Ab(a);case 1:return Bb(a);case 2:return Cb(a);case 3:return Db(a);case 4:return Eb(a);case 5:return Fb(a);case 6:return Gb(a);case 7:return Hb(a);case 8:return Ib(a);
case 9:return Jb(a);case 10:return Kb(a);case 11:return Lb(a);case 12:return Mb(a);case 13:return Nb(a);case 14:return Ob(a);default:return Pb(a)}}function J(a){ra(4);return lb(a)}function P(a,b){ra(4);Oa(a,b)&&k(a,b)}function ba(a){ra(8);var b=Ya(a);switch(b){case -1:b=y(a)}a+=1;var f=Ya(a);switch(f){case -1:a=y(a);break;default:a=f}return p(a,b)}function U(a,b){ra(8);var c=H(b);b&=255;var d=a+1;Oa(a,b)&&k(a,b);Oa(d,c)&&k(d,c)}function G(){ra(4);return y(b.programCounter)}function V(){ra(4);var a=
y(b.programCounter+1&65535);return p(a,G())}function Ab(a){switch(a){case 0:return 4;case 1:return a=V(),b.registerB=H(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return P(p(b.registerB,b.registerC),b.registerA),4;case 3:return a=p(b.registerB,b.registerC),a++,b.registerB=H(a),b.registerC=a&255,8;case 4:return O(b.registerB,1),b.registerB=b.registerB+1&255,0===b.registerB?l(1):l(0),q(0),4;case 5:return O(b.registerB,-1),b.registerB=b.registerB-1&255,0===b.registerB?l(1):
l(0),q(1),4;case 6:return b.registerB=G(),b.programCounter=b.programCounter+1&65535,4;case 7:128===(b.registerA&128)?w(1):w(0);a=b;var c=b.registerA;a.registerA=(c<<1|c>>7)&255;l(0);q(0);D(0);return 4;case 8:return U(V(),b.stackPointer),b.programCounter=b.programCounter+2&65535,4;case 9:return a=p(b.registerH,b.registerL),c=p(b.registerB,b.registerC),sa(a,c,!1),a=a+c&65535,b.registerH=H(a),b.registerL=a&255,q(0),8;case 10:return b.registerA=J(p(b.registerB,b.registerC)),4;case 11:return a=p(b.registerB,
b.registerC),a=a-1&65535,b.registerB=H(a),b.registerC=a&255,8;case 12:return O(b.registerC,1),b.registerC=b.registerC+1&255,0===b.registerC?l(1):l(0),q(0),4;case 13:return O(b.registerC,-1),b.registerC=b.registerC-1&255,0===b.registerC?l(1):l(0),q(1),4;case 14:return b.registerC=G(),b.programCounter=b.programCounter+1&65535,4;case 15:return 0<(b.registerA&1)?w(1):w(0),a=b,c=b.registerA,a.registerA=(c>>1|c<<7)&255,l(0),q(0),D(0),4}return-1}function Bb(a){switch(a){case 16:if(b.GBCEnabled&&(a=J(b.memoryLocationSpeedSwitch),
n(0,a)))return a=M(0,a),n(7,a)?(b.GBCDoubleSpeed=!1,a=M(7,a)):(b.GBCDoubleSpeed=!0,a|=128),P(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=V(),b.registerD=H(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return P(p(b.registerD,b.registerE),b.registerA),4;case 19:return a=p(b.registerD,b.registerE),a=a+1&65535,b.registerD=H(a),b.registerE=a&255,8;case 20:return O(b.registerD,1),b.registerD=b.registerD+
1&255,0===b.registerD?l(1):l(0),q(0),4;case 21:return O(b.registerD,-1),b.registerD=b.registerD-1&255,0===b.registerD?l(1):l(0),q(1),4;case 22:return b.registerD=G(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=!1,128===(b.registerA&128)&&(a=!0),b.registerA=(b.registerA<<1|Q())&255,a?w(1):w(0),l(0),q(0),D(0),4;case 24:return za(G()),8;case 25:a=p(b.registerH,b.registerL);var c=p(b.registerD,b.registerE);sa(a,c,!1);a=a+c&65535;b.registerH=H(a);b.registerL=a&255;q(0);return 8;case 26:return a=
p(b.registerD,b.registerE),b.registerA=J(a),4;case 27:return a=p(b.registerD,b.registerE),a=a-1&65535,b.registerD=H(a),b.registerE=a&255,8;case 28:return O(b.registerE,1),b.registerE=b.registerE+1&255,0===b.registerE?l(1):l(0),q(0),4;case 29:return O(b.registerE,-1),b.registerE=b.registerE-1&255,0===b.registerE?l(1):l(0),q(1),4;case 30:return b.registerE=G(),b.programCounter=b.programCounter+1&65535,4;case 31:return a=!1,1===(b.registerA&1)&&(a=!0),b.registerA=(b.registerA>>1|Q()<<7)&255,a?w(1):w(0),
l(0),q(0),D(0),4}return-1}function Cb(a){switch(a){case 32:return 0===na()?za(G()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=V(),b.registerH=H(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=p(b.registerH,b.registerL),P(a,b.registerA),a=a+1&65535,b.registerH=H(a),b.registerL=a&255,4;case 35:return a=p(b.registerH,b.registerL),a=a+1&65535,b.registerH=H(a),b.registerL=a&255,8;case 36:return O(b.registerH,1),b.registerH=b.registerH+1&255,0===b.registerH?
l(1):l(0),q(0),4;case 37:return O(b.registerH,-1),b.registerH=b.registerH-1&255,0===b.registerH?l(1):l(0),q(1),4;case 38:return b.registerH=G(),b.programCounter=b.programCounter+1&65535,4;case 39:var c=0;0<(b.registerF>>5&1)&&(c|=6);0<Q()&&(c|=96);0<(b.registerF>>6&1)?a=b.registerA-c&255:(9<(b.registerA&15)&&(c|=6),153<b.registerA&&(c|=96),a=b.registerA+c&255);0===a?l(1):l(0);0!==(c&96)?w(1):w(0);D(0);b.registerA=a;return 4;case 40:return 0<na()?za(G()):b.programCounter=b.programCounter+1&65535,8;
case 41:return a=p(b.registerH,b.registerL),sa(a,a,!1),a=2*a&65535,b.registerH=H(a),b.registerL=a&255,q(0),8;case 42:return a=p(b.registerH,b.registerL),b.registerA=J(a),a=a+1&65535,b.registerH=H(a),b.registerL=a&255,4;case 43:return a=p(b.registerH,b.registerL),a=a-1&65535,b.registerH=H(a),b.registerL=a&255,8;case 44:return O(b.registerL,1),b.registerL=b.registerL+1&255,0===b.registerL?l(1):l(0),q(0),4;case 45:return O(b.registerL,-1),b.registerL=b.registerL-1&255,0===b.registerL?l(1):l(0),q(1),
4;case 46:return b.registerL=G(),b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=~b.registerA,q(1),D(1),4}return-1}function Db(a){switch(a){case 48:return 0===Q()?za(G()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=V(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=p(b.registerH,b.registerL),P(a,b.registerA),a=a-1&65535,b.registerH=H(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=p(b.registerH,
b.registerL);var c=J(a);O(c,1);c=c+1&255;0===c?l(1):l(0);q(0);P(a,c);return 4;case 53:return a=p(b.registerH,b.registerL),c=J(a),O(c,-1),c=c-1&255,0===c?l(1):l(0),q(1),P(a,c),4;case 54:return P(p(b.registerH,b.registerL),G()),b.programCounter=b.programCounter+1&65535,4;case 55:return q(0),D(0),w(1),4;case 56:return 1===Q()?za(G()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=p(b.registerH,b.registerL),sa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=H(a),b.registerL=a&
255,q(0),8;case 58:return a=p(b.registerH,b.registerL),b.registerA=J(a),a=a-1&65535,b.registerH=H(a),b.registerL=a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return O(b.registerA,1),b.registerA=b.registerA+1&255,0===b.registerA?l(1):l(0),q(0),4;case 61:return O(b.registerA,-1),b.registerA=b.registerA-1&255,0===b.registerA?l(1):l(0),q(1),4;case 62:return b.registerA=G(),b.programCounter=b.programCounter+1&65535,4;case 63:return q(0),D(0),0<Q()?w(0):w(1),4}return-1}function Eb(a){switch(a){case 64:return 4;
case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=J(p(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=
b.registerL,4;case 78:return b.registerC=J(p(b.registerH,b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function Fb(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=J(p(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,
4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=J(p(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function Gb(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=
b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=J(p(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=J(p(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,
4}return-1}function Hb(a){switch(a){case 112:return P(p(b.registerH,b.registerL),b.registerB),4;case 113:return P(p(b.registerH,b.registerL),b.registerC),4;case 114:return P(p(b.registerH,b.registerL),b.registerD),4;case 115:return P(p(b.registerH,b.registerL),b.registerE),4;case 116:return P(p(b.registerH,b.registerL),b.registerH),4;case 117:return P(p(b.registerH,b.registerL),b.registerL),4;case 118:return d.isHblankHdmaActive||(b.isHalted=!0),4;case 119:return P(p(b.registerH,b.registerL),b.registerA),
4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=J(p(b.registerH,b.registerL)),4;case 127:return 4}return-1}function Ib(a){switch(a){case 128:return ea(b.registerB),4;case 129:return ea(b.registerC),4;case 130:return ea(b.registerD),4;case 131:return ea(b.registerE),4;
case 132:return ea(b.registerH),4;case 133:return ea(b.registerL),4;case 134:return a=J(p(b.registerH,b.registerL)),ea(a),4;case 135:return ea(b.registerA),4;case 136:return fa(b.registerB),4;case 137:return fa(b.registerC),4;case 138:return fa(b.registerD),4;case 139:return fa(b.registerE),4;case 140:return fa(b.registerH),4;case 141:return fa(b.registerL),4;case 142:return a=J(p(b.registerH,b.registerL)),fa(a),4;case 143:return fa(b.registerA),4}return-1}function Jb(a){switch(a){case 144:return ha(b.registerB),
4;case 145:return ha(b.registerC),4;case 146:return ha(b.registerD),4;case 147:return ha(b.registerE),4;case 148:return ha(b.registerH),4;case 149:return ha(b.registerL),4;case 150:return a=J(p(b.registerH,b.registerL)),ha(a),4;case 151:return ha(b.registerA),4;case 152:return ia(b.registerB),4;case 153:return ia(b.registerC),4;case 154:return ia(b.registerD),4;case 155:return ia(b.registerE),4;case 156:return ia(b.registerH),4;case 157:return ia(b.registerL),4;case 158:return a=J(p(b.registerH,b.registerL)),
ia(a),4;case 159:return ia(b.registerA),4}return-1}function Kb(a){switch(a){case 160:return ja(b.registerB),4;case 161:return ja(b.registerC),4;case 162:return ja(b.registerD),4;case 163:return ja(b.registerE),4;case 164:return ja(b.registerH),4;case 165:return ja(b.registerL),4;case 166:return a=J(p(b.registerH,b.registerL)),ja(a),4;case 167:return ja(b.registerA),4;case 168:return ka(b.registerB),4;case 169:return ka(b.registerC),4;case 170:return ka(b.registerD),4;case 171:return ka(b.registerE),
4;case 172:return ka(b.registerH),4;case 173:return ka(b.registerL),4;case 174:return a=J(p(b.registerH,b.registerL)),ka(a),4;case 175:return ka(b.registerA),4}return-1}function Lb(a){switch(a){case 176:return la(b.registerB),4;case 177:return la(b.registerC),4;case 178:return la(b.registerD),4;case 179:return la(b.registerE),4;case 180:return la(b.registerH),4;case 181:return la(b.registerL),4;case 182:return a=J(p(b.registerH,b.registerL)),la(a),4;case 183:return la(b.registerA),4;case 184:return ma(b.registerB),
4;case 185:return ma(b.registerC),4;case 186:return ma(b.registerD),4;case 187:return ma(b.registerE),4;case 188:return ma(b.registerH),4;case 189:return ma(b.registerL),4;case 190:return a=J(p(b.registerH,b.registerL)),ma(a),4;case 191:return ma(b.registerA),4}return-1}function Mb(a){switch(a){case 192:return 0===na()?(b.programCounter=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 193:return a=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=H(a),b.registerC=
a&255,4;case 194:if(0===na())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 195:return b.programCounter=V(),8;case 196:if(0===na())return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,p(b.registerB,b.registerC)),8;case 198:return ea(G()),b.programCounter=b.programCounter+1&65535,
4;case 199:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),b.programCounter=0,8;case 200:return 1===na()?(b.programCounter=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 201:return b.programCounter=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,8;case 202:if(1===na())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=G();a=-1;var f=!1,d=0,e=0,h=c%8;switch(h){case 0:d=b.registerB;break;case 1:d=
b.registerC;break;case 2:d=b.registerD;break;case 3:d=b.registerE;break;case 4:d=b.registerH;break;case 5:d=b.registerL;break;case 6:d=J(p(b.registerH,b.registerL));break;case 7:d=b.registerA}var k=(c&240)>>4;switch(k){case 0:7>=c?(c=d,128===(c&128)?w(1):w(0),c=(c<<1|c>>7)&255,0===c?l(1):l(0),q(0),D(0),e=c,f=!0):15>=c&&(c=d,0<(c&1)?w(1):w(0),c=(c>>1|c<<7)&255,0===c?l(1):l(0),q(0),D(0),e=c,f=!0);break;case 1:23>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=(c<<1|Q())&255,f?w(1):w(0),0===c?l(1):l(0),q(0),D(0),
e=c,f=!0):31>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=(c>>1|Q()<<7)&255,f?w(1):w(0),0===c?l(1):l(0),q(0),D(0),e=c,f=!0);break;case 2:39>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=c<<1&255,f?w(1):w(0),0===c?l(1):l(0),q(0),D(0),e=c,f=!0):47>=c&&(c=d,f=!1,128===(c&128)&&(f=!0),d=!1,1===(c&1)&&(d=!0),c=c>>1&255,f&&(c|=128),0===c?l(1):l(0),q(0),D(0),d?w(1):w(0),e=c,f=!0);break;case 3:55>=c?(c=d,c=((c&15)<<4|(c&240)>>4)&255,0===c?l(1):l(0),q(0),D(0),w(0),e=c,f=!0):63>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=c>>1&255,0===c?
l(1):l(0),q(0),D(0),f?w(1):w(0),e=c,f=!0);break;case 4:71>=c?(e=qa(0,d),f=!0):79>=c&&(e=qa(1,d),f=!0);break;case 5:87>=c?(e=qa(2,d),f=!0):95>=c&&(e=qa(3,d),f=!0);break;case 6:103>=c?(e=qa(4,d),f=!0):111>=c&&(e=qa(5,d),f=!0);break;case 7:119>=c?(e=qa(6,d),f=!0):127>=c&&(e=qa(7,d),f=!0);break;case 8:135>=c?(e=W(0,0,d),f=!0):143>=c&&(e=W(1,0,d),f=!0);break;case 9:151>=c?(e=W(2,0,d),f=!0):159>=c&&(e=W(3,0,d),f=!0);break;case 10:167>=c?(e=W(4,0,d),f=!0):175>=c&&(e=W(5,0,d),f=!0);break;case 11:183>=c?(e=
W(6,0,d),f=!0):191>=c&&(e=W(7,0,d),f=!0);break;case 12:199>=c?(e=W(0,1,d),f=!0):207>=c&&(e=W(1,1,d),f=!0);break;case 13:215>=c?(e=W(2,1,d),f=!0):223>=c&&(e=W(3,1,d),f=!0);break;case 14:231>=c?(e=W(4,1,d),f=!0):239>=c&&(e=W(5,1,d),f=!0);break;case 15:247>=c?(e=W(6,1,d),f=!0):255>=c&&(e=W(7,1,d),f=!0)}switch(h){case 0:b.registerB=e;break;case 1:b.registerC=e;break;case 2:b.registerD=e;break;case 3:b.registerE=e;break;case 4:b.registerH=e;break;case 5:b.registerL=e;break;case 6:(4>k||7<k)&&P(p(b.registerH,
b.registerL),e);break;case 7:b.registerA=e}f&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===na())return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter+2),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;case 206:return fa(G()),b.programCounter=b.programCounter+1&65535,4;case 207:return b.stackPointer=b.stackPointer-
2&65535,U(b.stackPointer,b.programCounter),b.programCounter=8}return-1}function Nb(a){switch(a){case 208:return 0===Q()?(b.programCounter=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 209:return a=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerD=H(a),b.registerE=a&255,4;case 210:if(0===Q())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===Q())return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter+
2),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,p(b.registerD,b.registerE)),8;case 214:return ha(G()),b.programCounter=b.programCounter+1&65535,4;case 215:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),b.programCounter=16,8;case 216:return 1===Q()?(b.programCounter=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 217:return b.programCounter=ba(b.stackPointer),
m.masterInterruptSwitch=!0,b.stackPointer=b.stackPointer+2&65535,8;case 218:if(1===Q())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===Q())return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return ia(G()),b.programCounter=b.programCounter+1&65535,4;case 223:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),
b.programCounter=24,8}return-1}function Ob(a){switch(a){case 224:return a=G(),P(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:return a=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerH=H(a),b.registerL=a&255,4;case 226:return P(65280+b.registerC,b.registerA),4;case 229:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,p(b.registerH,b.registerL)),8;case 230:return ja(G()),b.programCounter=b.programCounter+1&65535,4;case 231:return b.stackPointer=
b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),b.programCounter=32,8;case 232:return a=Qa(G()),sa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,l(0),q(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=p(b.registerH,b.registerL),4;case 234:return P(V(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return ka(G()),b.programCounter=b.programCounter+1&65535,4;case 239:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,
b.programCounter),b.programCounter=40,8}return-1}function Pb(a){switch(a){case 240:return a=G(),b.registerA=J(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:return a=ba(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerA=H(a),b.registerF=a&255,4;case 242:return b.registerA=J(65280+b.registerC)&255,4;case 243:return m.masterInterruptSwitch=!1,4;case 245:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,p(b.registerA,b.registerF)),8;case 246:return la(G()),
b.programCounter=b.programCounter+1&65535,4;case 247:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),b.programCounter=48,8;case 248:return a=Qa(G()),l(0),q(0),sa(b.stackPointer,a,!0),a=b.stackPointer+a&65535,b.registerH=H(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=p(b.registerH,b.registerL),8;case 250:return b.registerA=J(V()),b.programCounter=b.programCounter+2&65535,4;case 251:return m.masterInterruptSwitch=!0,
4;case 254:return ma(G()),b.programCounter=b.programCounter+1&65535,4;case 255:return b.stackPointer=b.stackPointer-2&65535,U(b.stackPointer,b.programCounter),b.programCounter=56,8}return-1}function pb(){for(var a=!1,c;!a&&b.currentCycles<b.MAX_CYCLES_PER_FRAME();)c=Aa(),0>c&&(a=!0);if(b.currentCycles>=b.MAX_CYCLES_PER_FRAME())return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),0;b.programCounter=b.programCounter-1&65535;return-1}function Aa(){Ba=!0;var a=4;b.isHalted||b.isStopped?b.isHalted&&!m.masterInterruptSwitch&&
m.areInterruptsPending()&&(b.isHalted=!1,b.isStopped=!1,a=y(b.programCounter),a=ob(a),b.programCounter=b.programCounter-1&65535):(a=y(b.programCounter),a=ob(a));b.registerF&=240;if(0>=a)return a;a:{if(m.masterInterruptSwitch&&0<m.interruptsEnabledValue&&0<m.interruptsRequestedValue){var c=!1;m.isVBlankInterruptEnabled&&m.isVBlankInterruptRequested?(Na(m.bitPositionVBlankInterrupt),c=!0):m.isLcdInterruptEnabled&&m.isLcdInterruptRequested?(Na(m.bitPositionLcdInterrupt),c=!0):m.isTimerInterruptEnabled&&
m.isTimerInterruptRequested?(Na(m.bitPositionTimerInterrupt),c=!0):m.isJoypadInterruptEnabled&&m.isJoypadInterruptRequested&&(Na(m.bitPositionJoypadInterrupt),c=!0);if(c){c=20;b.isHalted&&(b.isHalted=!1,c+=4);break a}}c=0}a+=c;ra(a);return a}function ra(a){0<d.DMACycles&&(a+=d.DMACycles,d.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(R.graphicsBatchProcessing){if(r.currentCycles+=a,!(r.currentCycles<r.batchProcessCycles()))for(;r.currentCycles>=r.batchProcessCycles();)nb(r.batchProcessCycles()),
r.currentCycles-=r.batchProcessCycles()}else nb(a);R.audioBatchProcessing?e.currentCycles+=a:gb(a)}R.timersBatchProcessing?(g.currentCycles+=a,Ta(g.currentCycles),g.currentCycles=0):Ta(a)}function Qb(a){const b="undefined"!==typeof window?performance.now():Date.now();for(;a.fpsTimeStamps[0]<b-1E3;)a.fpsTimeStamps.shift();a.fpsTimeStamps.push(b);a.timeStampsUntilReady--;0>a.timeStampsUntilReady&&(a.timeStampsUntilReady=0);return b}function qb(a){a.timeStampsUntilReady=90>=a.options.gameboyFrameRate?
1.25*Math.floor(a.options.gameboyFrameRate):120}function rb(a){var b=("undefined"!==typeof window?performance.now():Date.now())-a.fpsTimeStamps[a.fpsTimeStamps.length-1];b=sb-b;0>b&&(b=0);a.updateId=setTimeout(()=>{tb(a)},Math.floor(b))}function tb(a,b){if(a.paused)return!0;void 0!==b&&(sb=b);Ca=a.getFPS();if(Ca>a.options.gameboyFrameRate+1)return a.fpsTimeStamps.shift(),rb(a),!0;Qb(a);const c=!a.options.headless&&!a.pauseFpsThrottle&&a.options.isAudioEnabled;(new Promise((b)=>{let f;c?Za(a,b):(f=
a.wasmInstance.exports.executeFrame(),b(f))})).then((b)=>{if(0<=b){Z(N({type:C.UPDATED,fps:Ca}));b=!1;a.options.frameSkip&&0<a.options.frameSkip&&(a.frameSkipCounter++,a.frameSkipCounter<=a.options.frameSkip?b=!0:a.frameSkipCounter=0);b||(b=a.wasmByteMemory.slice(a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION,a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION+a.WASMBOY_CURRENT_FRAME_SIZE).buffer,a.graphicsWorkerPort.postMessage(N({type:C.UPDATED,graphicsFrameBuffer:b}),[b]));const c={type:C.UPDATED};c[F.CARTRIDGE_RAM]=
$a(a).buffer;c[F.GAMEBOY_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer;c[F.PALETTE_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer;c[F.INTERNAL_STATE]=ab(a).buffer;Object.keys(c).forEach((a)=>{void 0===c[a]&&(c[a]=(new Uint8Array).buffer)});a.memoryWorkerPort.postMessage(N(c),[c[F.CARTRIDGE_RAM],c[F.GAMEBOY_MEMORY],c[F.PALETTE_MEMORY],
c[F.INTERNAL_STATE]]);rb(a)}else Z(N({type:C.CRASHED})),a.paused=!0})}function Za(a,b){var c=a.wasmInstance.exports.executeFrameAndCheckAudio(1024);1!==c&&b(c);if(1===c){c=a.wasmInstance.exports.getAudioQueueIndex();const f=Ca>=a.options.gameboyFrameRate;.25<a.currentAudioLatencyInSeconds&&f?(ub(a,c),setTimeout(()=>{qb(a);Za(a,b)},Math.floor(Math.floor(1E3*(a.currentAudioLatencyInSeconds-.25))/10))):(ub(a,c),Za(a,b))}}function ub(a,b){const c=a.wasmByteMemory.slice(a.WASMBOY_SOUND_OUTPUT_LOCATION,
a.WASMBOY_SOUND_OUTPUT_LOCATION+2*b).buffer;a.audioWorkerPort.postMessage(N({type:C.UPDATED,audioBuffer:c,numberOfSamples:b,fps:Ca,allowFastSpeedStretching:60<a.options.gameboyFrameRate}),[c]);a.wasmInstance.exports.resetAudioQueue()}const Ea="undefined"!==typeof self;let Pa;Ea||(Pa=require("worker_threads").parentPort);const C={CONNECT:"CONNECT",INSTANTIATE_WASM:"INSTANTIATE_WASM",CLEAR_MEMORY:"CLEAR_MEMORY",CLEAR_MEMORY_DONE:"CLEAR_MEMORY_DONE",GET_MEMORY:"GET_MEMORY",SET_MEMORY:"SET_MEMORY",SET_MEMORY_DONE:"SET_MEMORY_DONE",
GET_CONSTANTS:"GET_CONSTANTS",GET_CONSTANTS_DONE:"GET_CONSTANTS_DONE",CONFIG:"CONFIG",RESET_AUDIO_QUEUE:"RESET_AUDIO_QUEUE",PLAY:"PLAY",PAUSE:"PAUSE",UPDATED:"UPDATED",CRASHED:"CRASHED",SET_JOYPAD_STATE:"SET_JOYPAD_STATE",AUDIO_LATENCY:"AUDIO_LATENCY",RUN_WASM_EXPORT:"RUN_WASM_EXPORT",GET_WASM_MEMORY_SECTION:"GET_WASM_MEMORY_SECTION",GET_WASM_CONSTANT:"GET_WASM_CONSTANT"},F={CARTRIDGE_RAM:"CARTRIDGE_RAM",CARTRIDGE_ROM:"CARTRIDGE_ROM",CARTRIDGE_HEADER:"CARTRIDGE_HEADER",GAMEBOY_MEMORY:"GAMEBOY_MEMORY",
PALETTE_MEMORY:"PALETTE_MEMORY",INTERNAL_STATE:"INTERNAL_STATE"};let Fa=0;const h=new Uint8ClampedArray(9109504),Da={size:()=>9109504,grow:()=>{},wasmByteMemory:h};var ya=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;return a}(),da=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),z=function(){function a(){}
a.updateNRx0=function(b){a.NRx0SweepPeriod=(b&112)>>4;a.NRx0Negate=n(3,b);a.NRx0SweepShift=b&7};a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=
b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){S(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;h[1038+50*a.saveStateSlot]=a.volume;h[1043+50*a.saveStateSlot]=a.dutyCycle;h[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;S(1049+50*a.saveStateSlot,a.isSweepEnabled);h[1050+50*a.saveStateSlot]=a.sweepCounter;h[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};
a.loadState=function(){a.isEnabled=T(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.dutyCycle=h[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=h[1044+50*a.saveStateSlot];a.isSweepEnabled=T(1049+50*a.saveStateSlot);a.sweepCounter=h[1050+50*a.saveStateSlot];a.sweepShadowFrequency=h[1055+50*a.saveStateSlot]};a.initialize=function(){k(a.memoryLocationNRx0,
128);k(a.memoryLocationNRx1,191);k(a.memoryLocationNRx2,243);k(a.memoryLocationNRx3,193);k(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&
(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;db(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&0<a.NRx0SweepShift?!0:!1;0<a.NRx0SweepShift&&eb();a.isDacEnabled||(a.isEnabled=
!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateSweep=function(){--a.sweepCounter;0>=a.sweepCounter&&(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&0<a.NRx0SweepPeriod&&eb())};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&
15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=y(a.memoryLocationNRx4)&248|c;k(a.memoryLocationNRx3,b);k(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=
0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=7;return a}(),K=function(){function a(){}a.updateNRx1=function(b){a.NRx1Duty=b>>
6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){S(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=
a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;h[1038+50*a.saveStateSlot]=a.volume;h[1043+50*a.saveStateSlot]=a.dutyCycle;h[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.isEnabled=T(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.dutyCycle=h[1043+50*a.saveStateSlot];
a.waveFormPositionOnDuty=h[1044+50*a.saveStateSlot]};a.initialize=function(){k(a.memoryLocationNRx1-1,255);k(a.memoryLocationNRx1,63);k(a.memoryLocationNRx2,0);k(a.memoryLocationNRx3,0);k(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),
a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;db(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<
a.frequencyTimer-a.cycleCounter?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=y(a.memoryLocationNRx4)&248|c;k(a.memoryLocationNRx3,b);k(a.memoryLocationNRx4,
d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=
0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),I=function(){function a(){}a.updateNRx0=function(b){a.isDacEnabled=n(7,b)};a.updateNRx1=function(b){a.NRx1LengthLoad=b;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2VolumeCode=b>>5&15};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|
a.NRx3FrequencyLSB};a.saveState=function(){S(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.lengthCounter;h[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=T(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.lengthCounter=h[1029+50*a.saveStateSlot];a.waveTablePosition=h[1033+50*a.saveStateSlot]};a.initialize=function(){k(a.memoryLocationNRx0,127);k(a.memoryLocationNRx1,255);k(a.memoryLocationNRx2,
159);k(a.memoryLocationNRx3,0);k(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveTablePosition+=1,32<=a.waveTablePosition&&(a.waveTablePosition=0));b=0;var c=a.volumeCode;
if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&(c=y(a.memoryLocationNRx2),c=c>>5&15,a.volumeCode=c,a.volumeCodeChanged=!1);else return 15;var d=y(a.memoryLocationWaveTable+a.waveTablePosition/2);d=0===a.waveTablePosition%2?d>>4&15:d&15;switch(c){case 0:d>>=4;break;case 1:b=1;break;case 2:d>>=1;b=2;break;default:d>>=2,b=4}return(0<b?d/b:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=
function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter&&!a.volumeCodeChanged?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=
65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=9;return a}(),L=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3ClockShift=b>>4;a.NRx3WidthMode=
n(3,b);a.NRx3DivisorCode=b&7;switch(a.NRx3DivisorCode){case 0:a.divisor=8;break;case 1:a.divisor=16;break;case 2:a.divisor=32;break;case 3:a.divisor=48;break;case 4:a.divisor=64;break;case 5:a.divisor=80;break;case 6:a.divisor=96;break;case 7:a.divisor=112}};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b)};a.saveState=function(){S(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;
h[1038+50*a.saveStateSlot]=a.volume;h[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};a.loadState=function(){a.isEnabled=T(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=h[1043+50*a.saveStateSlot]};a.initialize=function(){k(a.memoryLocationNRx1-1,255);k(a.memoryLocationNRx1,255);k(a.memoryLocationNRx2,0);k(a.memoryLocationNRx3,
0);k(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.frequencyTimer=a.getNoiseChannelFrequencyPeriod(),a.frequencyTimer-=b,b=a.linearFeedbackShiftRegister&1^a.linearFeedbackShiftRegister>>1&1,a.linearFeedbackShiftRegister>>=1,a.linearFeedbackShiftRegister|=b<<14,a.NRx3WidthMode&&(a.linearFeedbackShiftRegister&=-65,a.linearFeedbackShiftRegister|=
b<<6));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=n(0,a.linearFeedbackShiftRegister)?-1:1;return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.getNoiseChannelFrequencyPeriod=
function(){var c=a.divisor<<a.NRx3ClockShift;b.GBCDoubleSpeed&&(c*=2);return c};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=
65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),u=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=
15;a.channel1DacEnabled=!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),R=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=
!1;return a}(),e=function(){function a(){}a.batchProcessCycles=function(){return b.GBCDoubleSpeed?174:87};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=n(7,b);a.NR51IsChannel3EnabledOnLeftOutput=n(6,b);a.NR51IsChannel2EnabledOnLeftOutput=n(5,b);a.NR51IsChannel1EnabledOnLeftOutput=n(4,b);a.NR51IsChannel4EnabledOnRightOutput=n(3,b);a.NR51IsChannel3EnabledOnRightOutput=n(2,b);a.NR51IsChannel2EnabledOnRightOutput=
n(1,b);a.NR51IsChannel1EnabledOnRightOutput=n(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=n(7,b)};a.maxFrameSequenceCycles=function(){return b.GBCDoubleSpeed?16384:8192};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;h[1028+50*a.saveStateSlot]=a.downSampleCycleCounter;h[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=h[1024+50*a.saveStateSlot];a.downSampleCycleCounter=
h[1028+50*a.saveStateSlot];a.frameSequencer=h[1029+50*a.saveStateSlot];Sa()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=
!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),m=function(){function a(){}a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=
n(a.bitPositionTimerInterrupt,b);a.isJoypadInterruptEnabled=n(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=n(a.bitPositionTimerInterrupt,b);a.isJoypadInterruptRequested=n(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&
a.interruptsEnabledValue)};a.saveState=function(){S(1024+50*a.saveStateSlot,a.masterInterruptSwitch);S(1025+50*a.saveStateSlot,a.masterInterruptSwitchDelay)};a.loadState=function(){a.masterInterruptSwitch=T(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=T(1025+50*a.saveStateSlot);a.updateInterruptEnabled(y(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(y(a.memoryLocationInterruptRequest))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=
0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),g=function(){function a(){}
a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(b){b=a.dividerRegister;a.dividerRegister=0;k(a.memoryLocationDividerRegister,0);a.timerEnabled&&jb(b,a.dividerRegister)&&Ua()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=a.timerModulo,a.timerCounterWasReset=
!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=n(2,b);b&=3;if(!c){c=Va(a.timerInputClock);var d=Va(b);(a.timerEnabled?n(c,a.dividerRegister):n(c,a.dividerRegister)&&n(d,a.dividerRegister))&&Ua()}a.timerInputClock=b};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.currentCycles;h[1028+50*a.saveStateSlot]=a.dividerRegister;S(1032+50*a.saveStateSlot,a.timerCounterOverflowDelay);S(1035+50*a.saveStateSlot,a.timerCounterWasReset);k(a.memoryLocationTimerCounter,a.timerCounter)};
a.loadState=function(){a.currentCycles=h[1024+50*a.saveStateSlot];a.dividerRegister=h[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=T(1032+50*a.saveStateSlot);a.timerCounterWasReset=T(1035+50*a.saveStateSlot);a.timerCounter=y(a.memoryLocationTimerCounter);a.timerModulo=y(a.memoryLocationTimerModulo);a.timerInputClock=y(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=
!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),A=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=n(4,a.joypadRegisterFlipped);a.isButtonType=n(5,a.joypadRegisterFlipped)};a.saveState=function(){};a.loadState=function(){a.updateJoypad(y(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;
a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),E=function(){function a(){}a.updateLcdControl=function(b){a.enabled=n(7,b);a.windowTileMapDisplaySelect=n(6,b);a.windowDisplayEnabled=n(5,b);a.bgWindowTileDataSelect=n(4,b);a.bgTileMapDisplaySelect=n(3,b);a.tallSpriteSize=n(2,b);a.spriteDisplayEnable=n(1,b);a.bgDisplayEnabled=n(0,b)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=
0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),r=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return b.GBCDoubleSpeed?912:456};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return b.GBCDoubleSpeed?
752:376};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return b.GBCDoubleSpeed?498:249};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;h[1028+50*a.saveStateSlot]=E.currentLcdMode;k(a.memoryLocationScanlineRegister,a.scanlineRegister)};a.loadState=function(){a.scanlineCycleCounter=h[1024+50*a.saveStateSlot];E.currentLcdMode=h[1028+50*a.saveStateSlot];a.scanlineRegister=y(a.memoryLocationScanlineRegister);E.updateLcdControl(y(E.memoryLocationLcdControl))};a.currentCycles=
0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=
65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),d=function(){function a(){}a.saveState=function(){h[1024+50*a.saveStateSlot]=a.currentRomBank;h[1026+50*a.saveStateSlot]=a.currentRamBank;S(1028+50*a.saveStateSlot,a.isRamBankingEnabled);S(1029+50*a.saveStateSlot,a.isMBC1RomModeEnabled);S(1030+50*a.saveStateSlot,a.isRomOnly);S(1031+50*a.saveStateSlot,a.isMBC1);S(1032+50*a.saveStateSlot,a.isMBC2);
S(1033+50*a.saveStateSlot,a.isMBC3);S(1034+50*a.saveStateSlot,a.isMBC5)};a.loadState=function(){a.currentRomBank=h[1024+50*a.saveStateSlot];a.currentRamBank=h[1026+50*a.saveStateSlot];a.isRamBankingEnabled=T(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=T(1029+50*a.saveStateSlot);a.isRomOnly=T(1030+50*a.saveStateSlot);a.isMBC1=T(1031+50*a.saveStateSlot);a.isMBC2=T(1032+50*a.saveStateSlot);a.isMBC3=T(1033+50*a.saveStateSlot);a.isMBC5=T(1034+50*a.saveStateSlot)};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=
16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=
65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return a.GBCDoubleSpeed?8388608:4194304};a.MAX_CYCLES_PER_FRAME=function(){return a.GBCDoubleSpeed?140448:
70224};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.registerA;h[1025+50*a.saveStateSlot]=a.registerB;h[1026+50*a.saveStateSlot]=a.registerC;h[1027+50*a.saveStateSlot]=a.registerD;h[1028+50*a.saveStateSlot]=a.registerE;h[1029+50*a.saveStateSlot]=a.registerH;h[1030+50*a.saveStateSlot]=a.registerL;h[1031+50*a.saveStateSlot]=a.registerF;h[1032+50*a.saveStateSlot]=a.stackPointer;h[1034+50*a.saveStateSlot]=a.programCounter;h[1036+50*a.saveStateSlot]=a.currentCycles;S(1041+50*a.saveStateSlot,a.isHalted);
S(1042+50*a.saveStateSlot,a.isStopped)};a.loadState=function(){a.registerA=h[1024+50*a.saveStateSlot];a.registerB=h[1025+50*a.saveStateSlot];a.registerC=h[1026+50*a.saveStateSlot];a.registerD=h[1027+50*a.saveStateSlot];a.registerE=h[1028+50*a.saveStateSlot];a.registerH=h[1029+50*a.saveStateSlot];a.registerL=h[1030+50*a.saveStateSlot];a.registerF=h[1031+50*a.saveStateSlot];a.stackPointer=h[1032+50*a.saveStateSlot];a.programCounter=h[1034+50*a.saveStateSlot];a.currentCycles=h[1036+50*a.saveStateSlot];
a.isHalted=T(1041+50*a.saveStateSlot);a.isStopped=T(1042+50*a.saveStateSlot)};a.GBCEnabled=!1;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHalted=!1;a.isStopped=!1;a.memoryLocationSpeedSwitch=65357;a.saveStateSlot=0;return a}();139>Da.size()&&Da.grow(139-Da.size());var Ba=!1,Rb=Object.freeze({memory:Da,config:function(a,c,f,h,l,n,m,p,q){R.enableBootRom=0<
a?!0:!1;R.useGbcWhenAvailable=0<c?!0:!1;R.audioBatchProcessing=0<f?!0:!1;R.graphicsBatchProcessing=0<h?!0:!1;R.timersBatchProcessing=0<l?!0:!1;R.graphicsDisableScanlineRendering=0<n?!0:!1;R.audioAccumulateSamples=0<m?!0:!1;R.tileRendering=0<p?!0:!1;R.tileCaching=0<q?!0:!1;a=y(323);b.GBCEnabled=192===a||R.useGbcWhenAvailable&&128===a?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=
0;b.currentCycles=0;b.isHalted=!1;b.isStopped=!1;b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77);b.programCounter=256;b.stackPointer=65534;d.isRamBankingEnabled=!1;d.isMBC1RomModeEnabled=!0;a=y(327);d.isRomOnly=!1;d.isMBC1=!1;d.isMBC2=!1;d.isMBC3=!1;d.isMBC5=!1;0===a?d.isRomOnly=!0:1<=a&&3>=a?d.isMBC1=
!0:5<=a&&6>=a?d.isMBC2=!0:15<=a&&19>=a?d.isMBC3=!0:25<=a&&30>=a&&(d.isMBC5=!0);d.currentRomBank=1;d.currentRamBank=0;k(65361,255);k(65362,255);k(65363,255);k(65364,255);k(65365,255);r.currentCycles=0;r.scanlineCycleCounter=0;r.scanlineRegister=0;r.scrollX=0;r.scrollY=0;r.windowX=0;r.windowY=0;b.GBCEnabled?(r.scanlineRegister=144,k(65344,145),k(65345,129),k(65348,144),k(65351,252)):(r.scanlineRegister=144,k(65344,145),k(65345,133),k(65350,255),k(65351,252),k(65352,255),k(65353,255));k(65359,0);k(65392,
1);b.GBCEnabled?(k(65384,192),k(65385,255),k(65386,193),k(65387,13)):(k(65384,255),k(65385,255),k(65386,255),k(65387,255));e.currentCycles=0;e.NR50LeftMixerVolume=0;e.NR50RightMixerVolume=0;e.NR51IsChannel1EnabledOnLeftOutput=!0;e.NR51IsChannel2EnabledOnLeftOutput=!0;e.NR51IsChannel3EnabledOnLeftOutput=!0;e.NR51IsChannel4EnabledOnLeftOutput=!0;e.NR51IsChannel1EnabledOnRightOutput=!0;e.NR51IsChannel2EnabledOnRightOutput=!0;e.NR51IsChannel3EnabledOnRightOutput=!0;e.NR51IsChannel4EnabledOnRightOutput=
!0;e.NR52IsSoundEnabled=!0;e.frameSequenceCycleCounter=0;e.downSampleCycleCounter=0;e.frameSequencer=0;e.audioQueueIndex=0;z.initialize();K.initialize();I.initialize();L.initialize();k(e.memoryLocationNR50,119);k(e.memoryLocationNR51,243);k(e.memoryLocationNR52,241);u.channel1Sample=15;u.channel2Sample=15;u.channel3Sample=15;u.channel4Sample=15;u.channel1DacEnabled=!1;u.channel2DacEnabled=!1;u.channel3DacEnabled=!1;u.channel4DacEnabled=!1;u.leftChannelSampleUnsignedByte=127;u.rightChannelSampleUnsignedByte=
127;u.mixerVolumeChanged=!0;u.mixerEnabledChanged=!0;u.needToRemixSamples=!1;g.currentCycles=0;g.dividerRegister=0;g.timerCounter=0;g.timerModulo=0;g.timerEnabled=!1;g.timerInputClock=0;g.timerCounterOverflowDelay=!1;g.timerCounterWasReset=!1;b.GBCEnabled?(k(65284,30),g.dividerRegister=7840):(k(65284,171),g.dividerRegister=43980);k(65287,248);g.timerInputClock=248;b.GBCEnabled?(k(65392,248),k(65359,254),k(65357,126),k(65280,207),k(65282,124),k(65295,225),k(65388,254),k(65397,143)):(k(65392,255),k(65359,
255),k(65357,255),k(65280,207),k(65282,126),k(65295,225));Ba=!1},executeFrame:pb,executeFrameAndCheckAudio:function(a){var c=!1,d=1024;for(a&&0<a&&(d=a);!c&&b.currentCycles<b.MAX_CYCLES_PER_FRAME()&&Ma()<d;)a=Aa(),0>a&&(c=!0);if(b.currentCycles>=b.MAX_CYCLES_PER_FRAME())return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),0;if(Ma()>=d)return 1;b.programCounter=b.programCounter-1&65535;return-1},executeFrameUntilBreakpoint:function(a){for(var c=!1,d;!c&&b.currentCycles<b.MAX_CYCLES_PER_FRAME()&&b.programCounter!==
a;)d=Aa(),0>d&&(c=!0);if(b.currentCycles>=b.MAX_CYCLES_PER_FRAME())return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),0;if(b.programCounter===a)return 1;b.programCounter=b.programCounter-1&65535;return-1},executeStep:Aa,saveState:function(){b.saveState();r.saveState();m.saveState();A.saveState();d.saveState();g.saveState();e.saveState();z.saveState();K.saveState();I.saveState();L.saveState();Ba=!1},loadState:function(){b.loadState();r.loadState();m.loadState();A.loadState();d.loadState();g.loadState();
e.loadState();z.loadState();K.loadState();I.loadState();L.loadState();Ba=!1},hasCoreStarted:function(){return Ba?1:0},setJoypadState:function(a,b,d,e,h,k,l,g){0<a?pa(0):ca(0,!1);0<b?pa(1):ca(1,!1);0<d?pa(2):ca(2,!1);0<e?pa(3):ca(3,!1);0<h?pa(4):ca(4,!1);0<k?pa(5):ca(5,!1);0<l?pa(6):ca(6,!1);0<g?pa(7):ca(7,!1)},getNumberOfSamplesInAudioBuffer:Ma,clearAudioBuffer:Sa,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:9109504,WASMBOY_WASM_PAGES:139,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,
WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,GAMEBOY_INTERNAL_MEMORY_SIZE:65535,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:67584,GRAPHICS_OUTPUT_SIZE:521216,GBC_PALETTE_LOCATION:67584,GBC_PALETTE_SIZE:512,BG_PRIORITY_MAP_LOCATION:69632,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:93184,FRAME_SIZE:93184,
BACKGROUND_MAP_LOCATION:232448,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:429056,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:576512,OAM_TILES_SIZE:12288,AUDIO_BUFFER_LOCATION:588800,AUDIO_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:719872,CARTRIDGE_RAM_SIZE:131072,CARTRIDGE_ROM_LOCATION:850944,CARTRIDGE_ROM_SIZE:8258560,getWasmBoyOffsetFromGameBoyOffset:Wa,getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},
getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return y(b.programCounter)},getLY:function(){return r.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){void 0===a&&(a=0);var c=r.memoryLocationTileDataSelectZeroStart;E.bgWindowTileDataSelect&&
(c=r.memoryLocationTileDataSelectOneStart);var d=r.memoryLocationTileMapSelectZeroStart;E.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);for(var e=0;256>e;e++)for(var k=0;256>k;k++){var l=e,g=k,m=d+32*(l>>3)+(g>>3),p=X(m,0);p=wa(c,p);var q=l%8;l=g%8;l=7-l;g=0;b.GBCEnabled&&0<a&&(g=X(m,1));n(6,g)&&(q=7-q);var u=0;n(3,g)&&(u=1);m=X(p+2*q,u);p=X(p+2*q+1,u);q=0;n(l,p)&&(q+=1,q<<=1);n(l,m)&&(q+=1);p=3*(256*e+k);if(b.GBCEnabled&&0<a)g=Ia(g&7,q,!1),l=aa(0,g),m=aa(1,g),q=aa(2,g),g=232448+
p,h[g]=l,h[g+1]=m,h[g+2]=q;else for(l=Ha(q,r.memoryLocationBackgroundPalette),m=0;3>m;m++)g=232448+p+m,h[g]=l}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var b=0;31>b;b++){var d=0;15<b&&(d=1);var e=a;15<a&&(e-=15);e<<=4;e=15<b?e+(b-15):e+b;var h=r.memoryLocationTileDataSelectOneStart;15<a&&(h=r.memoryLocationTileDataSelectZeroStart);for(var g=0;8>g;g++)cb(e,h,d,0,7,g,8*b,8*a+g,248,429056,!0)}},getDIV:function(){return g.dividerRegister},getTIMA:function(){return g.timerCounter},
getTMA:function(){return g.timerModulo},getTAC:function(){var a=g.timerInputClock;g.timerEnabled&&(a|=4);return a},update:pb,emulationStep:Aa,getAudioQueueIndex:Ma,resetAudioQueue:Sa,wasmMemorySize:9109504,wasmBoyInternalStateLocation:1024,wasmBoyInternalStateSize:1024,gameBoyInternalMemoryLocation:2048,gameBoyInternalMemorySize:65535,videoOutputLocation:67584,frameInProgressVideoOutputLocation:93184,gameboyColorPaletteLocation:67584,gameboyColorPaletteSize:512,backgroundMapLocation:232448,tileDataMap:429056,
soundOutputLocation:588800,gameBytesLocation:850944,gameRamBanksLocation:719872});const Sb=async()=>({instance:{exports:Rb},byteMemory:Da.wasmByteMemory,type:"TypeScript"});let Ca,sb,v;v={graphicsWorkerPort:void 0,memoryWorkerPort:void 0,controllerWorkerPort:void 0,audioWorkerPort:void 0,wasmInstance:void 0,wasmByteMemory:void 0,options:void 0,WASMBOY_GAME_BYTES_LOCATION:0,WASMBOY_GAME_RAM_BANKS_LOCATION:0,WASMBOY_INTERNAL_STATE_SIZE:0,WASMBOY_INTERNAL_STATE_LOCATION:0,WASMBOY_INTERNAL_MEMORY_SIZE:0,
WASMBOY_INTERNAL_MEMORY_LOCATION:0,WASMBOY_PALETTE_MEMORY_SIZE:0,WASMBOY_PALETTE_MEMORY_LOCATION:0,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:0,WASMBOY_CURRENT_FRAME_SIZE:0,WASMBOY_SOUND_OUTPUT_LOCATION:0,paused:!0,updateId:void 0,timeStampsUntilReady:0,fpsTimeStamps:[],frameSkipCounter:0,currentAudioLatencyInSeconds:0,messageHandler:(a)=>{const b=ua(a);switch(b.message.type){case C.CONNECT:"GRAPHICS"===b.message.workerId?(v.graphicsWorkerPort=b.message.ports[0],va(vb.bind(void 0,v),v.graphicsWorkerPort)):
"MEMORY"===b.message.workerId?(v.memoryWorkerPort=b.message.ports[0],va(yb.bind(void 0,v),v.memoryWorkerPort)):"CONTROLLER"===b.message.workerId?(v.controllerWorkerPort=b.message.ports[0],va(xb.bind(void 0,v),v.controllerWorkerPort)):"AUDIO"===b.message.workerId&&(v.audioWorkerPort=b.message.ports[0],va(wb.bind(void 0,v),v.audioWorkerPort));Z(N(void 0,b.messageId));break;case C.INSTANTIATE_WASM:(async()=>{let a;a=await Sb();v.wasmInstance=a.instance;v.wasmByteMemory=a.byteMemory;Z(N({type:a.type},
b.messageId))})();break;case C.CONFIG:v.wasmInstance.exports.config.apply(v,b.message.config);v.options=b.message.options;Z(N(void 0,b.messageId));break;case C.RESET_AUDIO_QUEUE:v.wasmInstance.exports.resetAudioQueue();Z(N(void 0,b.messageId));break;case C.PLAY:if(!v.paused||!v.wasmInstance||!v.wasmByteMemory){Z(N({error:!0},b.messageId));break}v.paused=!1;v.fpsTimeStamps=[];v.frameSkipCounter=0;v.currentAudioLatencyInSeconds=0;tb(v,1E3/v.options.gameboyFrameRate);qb(v);Z(N(void 0,b.messageId));break;
case C.PAUSE:v.paused=!0;v.updateId&&(clearTimeout(v.updateId),v.updateId=void 0);Z(N(void 0,b.messageId));break;case C.RUN_WASM_EXPORT:a=b.message.parameters?v.wasmInstance.exports[b.message.export].apply(void 0,b.message.parameters):v.wasmInstance.exports[b.message.export]();Z(N({type:C.RUN_WASM_EXPORT,response:a},b.messageId));break;case C.GET_WASM_MEMORY_SECTION:{a=0;let c=v.wasmByteMemory.length;b.message.start&&(a=b.message.start);b.message.end&&(c=b.message.end);a=v.wasmByteMemory.slice(a,
c).buffer;Z(N({type:C.RUN_WASM_EXPORT,response:a},b.messageId),[a]);break}case C.GET_WASM_CONSTANT:Z(N({type:C.GET_WASM_CONSTANT,response:v.wasmInstance.exports[b.message.constant].valueOf()},b.messageId));break;default:console.log(b)}},getFPS:()=>0<v.timeStampsUntilReady?v.options.gameboyFrameRate:v.fpsTimeStamps?v.fpsTimeStamps.length:0};va(v.messageHandler)})();
