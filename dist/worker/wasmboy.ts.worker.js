'use strict';(function(){function Da(a){return a.data?a.data:a}function ca(a,b){Qa?self.postMessage(a,b):cb.postMessage(a,b)}function Ea(a,b){a||console.error("workerapi: No callback was provided to onMessage!");if(b)if(Qa)b.onmessage=a;else b.on("message",a);else if(Qa)self.onmessage=a;else cb.on("message",a)}function N(a,b,e){b||(b=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10),Ra++,b=`${b}-${Ra}`,1E5<Ra&&(Ra=0));return{workerId:e,messageId:b,message:a}}function Yb(a,b){b=Da(b);
switch(b.message.type){case C.GET_CONSTANTS:a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION=a.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf(),a.WASMBOY_CURRENT_FRAME_SIZE=a.wasmInstance.exports.FRAME_SIZE.valueOf(),a.graphicsWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:a.wasmInstance.exports.frameInProgressVideoOutputLocation.valueOf()},b.messageId))}}function Zb(a,b){b=Da(b);switch(b.message.type){case C.GET_CONSTANTS:a.WASMBOY_SOUND_OUTPUT_LOCATION=
a.wasmInstance.exports.soundOutputLocation.valueOf();a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_1_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_2_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_3_BUFFER_LOCATION.valueOf();a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION=a.wasmInstance.exports.CHANNEL_4_BUFFER_LOCATION.valueOf();a.audioWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,WASMBOY_SOUND_OUTPUT_LOCATION:a.wasmInstance.exports.soundOutputLocation.valueOf()},
b.messageId));break;case C.AUDIO_LATENCY:a.currentAudioLatencyInSeconds=b.message.latency}}function $b(a,b){b=Da(b);switch(b.message.type){case C.SET_JOYPAD_STATE:a.wasmInstance.exports.setJoypadState.apply(a,b.message.setJoypadStateParamsAsArray)}}function Cb(a){if(!a.wasmByteMemory)return new Uint8Array;let b=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327],e=void 0;if(0===b)return new Uint8Array;1<=b&&3>=b?e=32768:5<=b&&6>=b?e=2048:15<=b&&19>=b?e=32768:25<=b&&30>=b&&(e=131072);return e?a.wasmByteMemory.slice(a.WASMBOY_GAME_RAM_BANKS_LOCATION,
a.WASMBOY_GAME_RAM_BANKS_LOCATION+e):new Uint8Array}function Db(a){a.wasmInstance.exports.saveState();return a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_STATE_LOCATION,a.WASMBOY_INTERNAL_STATE_LOCATION+a.WASMBOY_INTERNAL_STATE_SIZE)}function ac(a,b){b=Da(b);switch(b.message.type){case C.CLEAR_MEMORY:for(var c=0;c<=a.wasmByteMemory.length;c++)a.wasmByteMemory[c]=0;c=a.wasmByteMemory.slice(0);a.memoryWorkerPort.postMessage(N({type:C.CLEAR_MEMORY_DONE,wasmByteMemory:c.buffer},b.messageId),[c.buffer]);
break;case C.GET_CONSTANTS:a.WASMBOY_GAME_BYTES_LOCATION=a.wasmInstance.exports.gameBytesLocation.valueOf();a.WASMBOY_GAME_RAM_BANKS_LOCATION=a.wasmInstance.exports.gameRamBanksLocation.valueOf();a.WASMBOY_INTERNAL_STATE_SIZE=a.wasmInstance.exports.wasmBoyInternalStateSize.valueOf();a.WASMBOY_INTERNAL_STATE_LOCATION=a.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf();a.WASMBOY_INTERNAL_MEMORY_SIZE=a.wasmInstance.exports.gameBoyInternalMemorySize.valueOf();a.WASMBOY_INTERNAL_MEMORY_LOCATION=
a.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf();a.WASMBOY_PALETTE_MEMORY_SIZE=a.wasmInstance.exports.gameboyColorPaletteSize.valueOf();a.WASMBOY_PALETTE_MEMORY_LOCATION=a.wasmInstance.exports.gameboyColorPaletteLocation.valueOf();a.memoryWorkerPort.postMessage(N({type:C.GET_CONSTANTS_DONE,WASMBOY_GAME_BYTES_LOCATION:a.wasmInstance.exports.gameBytesLocation.valueOf(),WASMBOY_GAME_RAM_BANKS_LOCATION:a.wasmInstance.exports.gameRamBanksLocation.valueOf(),WASMBOY_INTERNAL_STATE_SIZE:a.wasmInstance.exports.wasmBoyInternalStateSize.valueOf(),
WASMBOY_INTERNAL_STATE_LOCATION:a.wasmInstance.exports.wasmBoyInternalStateLocation.valueOf(),WASMBOY_INTERNAL_MEMORY_SIZE:a.wasmInstance.exports.gameBoyInternalMemorySize.valueOf(),WASMBOY_INTERNAL_MEMORY_LOCATION:a.wasmInstance.exports.gameBoyInternalMemoryLocation.valueOf(),WASMBOY_PALETTE_MEMORY_SIZE:a.wasmInstance.exports.gameboyColorPaletteSize.valueOf(),WASMBOY_PALETTE_MEMORY_LOCATION:a.wasmInstance.exports.gameboyColorPaletteLocation.valueOf()},b.messageId));break;case C.SET_MEMORY:c=Object.keys(b.message);
c.includes(E.CARTRIDGE_ROM)&&a.wasmByteMemory.set(new Uint8Array(b.message[E.CARTRIDGE_ROM]),a.WASMBOY_GAME_BYTES_LOCATION);c.includes(E.CARTRIDGE_RAM)&&a.wasmByteMemory.set(new Uint8Array(b.message[E.CARTRIDGE_RAM]),a.WASMBOY_GAME_RAM_BANKS_LOCATION);c.includes(E.GAMEBOY_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(b.message[E.GAMEBOY_MEMORY]),a.WASMBOY_INTERNAL_MEMORY_LOCATION);c.includes(E.PALETTE_MEMORY)&&a.wasmByteMemory.set(new Uint8Array(b.message[E.PALETTE_MEMORY]),a.WASMBOY_PALETTE_MEMORY_LOCATION);
c.includes(E.INTERNAL_STATE)&&(a.wasmByteMemory.set(new Uint8Array(b.message[E.INTERNAL_STATE]),a.WASMBOY_INTERNAL_STATE_LOCATION),a.wasmInstance.exports.loadState());a.memoryWorkerPort.postMessage(N({type:C.SET_MEMORY_DONE},b.messageId));break;case C.GET_MEMORY:{c={type:C.GET_MEMORY};const e=[];var w=b.message.memoryTypes;if(w.includes(E.CARTRIDGE_ROM)){if(a.wasmByteMemory){var m=a.wasmByteMemory[a.WASMBOY_GAME_BYTES_LOCATION+327];var d=void 0;0===m?d=32768:1<=m&&3>=m?d=2097152:5<=m&&6>=m?d=262144:
15<=m&&19>=m?d=2097152:25<=m&&30>=m&&(d=8388608);m=d?a.wasmByteMemory.slice(a.WASMBOY_GAME_BYTES_LOCATION,a.WASMBOY_GAME_BYTES_LOCATION+d):new Uint8Array}else m=new Uint8Array;m=m.buffer;c[E.CARTRIDGE_ROM]=m;e.push(m)}w.includes(E.CARTRIDGE_RAM)&&(m=Cb(a).buffer,c[E.CARTRIDGE_RAM]=m,e.push(m));w.includes(E.CARTRIDGE_HEADER)&&(a.wasmByteMemory?(m=a.WASMBOY_GAME_BYTES_LOCATION+308,m=a.wasmByteMemory.slice(m,m+27)):m=new Uint8Array,m=m.buffer,c[E.CARTRIDGE_HEADER]=m,e.push(m));w.includes(E.GAMEBOY_MEMORY)&&
(m=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer,c[E.GAMEBOY_MEMORY]=m,e.push(m));w.includes(E.PALETTE_MEMORY)&&(m=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+a.WASMBOY_PALETTE_MEMORY_SIZE).buffer,c[E.PALETTE_MEMORY]=m,e.push(m));w.includes(E.INTERNAL_STATE)&&(a.wasmInstance.exports.saveState(),w=Db(a).buffer,c[E.INTERNAL_STATE]=w,e.push(w));a.memoryWorkerPort.postMessage(N(c,
b.messageId),e)}}}function r(a,b){return(a&255)<<8|b&255}function F(a){return(a&65280)>>8}function H(a,b){return b&~(1<<a)}function q(a,b){return 0!=(b&1<<a)}function db(a){var b=a;q(7,b)&&(b=-1*(256-a));return b}function Sa(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function l(a){Sa(7,a)}function u(a){Sa(6,a)}function D(a){Sa(5,a)}function v(a){Sa(4,a)}function ta(){return b.registerF>>7&1}function V(){return b.registerF>>4&1}function T(a,b){0<=b?0!==((a&
15)+(b&15)&16)?D(1):D(0):(Math.abs(b)&15)>(a&15)?D(1):D(0)}function eb(a,b){0<=b?a>(a+b&255)?v(1):v(0):Math.abs(b)>a?v(1):v(0)}function wa(a,b,e){e?(a=a^b^a+b,0!==(a&16)?D(1):D(0),0!==(a&256)?v(1):v(0)):(e=a+b&65535,e<a?v(1):v(0),0!==((a^b^e)&4096)?D(1):D(0))}function Ta(a,b,e){void 0===e&&(e=!1);var c=a;e||(c=y(b)>>2*a&3);a=242;switch(c){case 1:a=160;break;case 2:a=88;break;case 3:a=8}return a}function Ua(a,b,e){b=8*a+2*b;a=Eb(b+1,e);e=Eb(b,e);return r(a,e)}function fa(a,b){return 8*((b&31<<5*a)>>
5*a)}function Eb(a,b){a&=63;b&&(a+=64);return k[67584+a]}function Va(a,b,e,w){void 0===e&&(e=0);void 0===w&&(w=!1);e&=3;w&&(e|=4);k[67712+(160*b+a)]=e}function fb(a,c,e,w,m,d,h,f,l,p,r,n,g,y){var O=0;c=Ga(c,a);a=Y(c+2*d,e);e=Y(c+2*d+1,e);for(d=w;d<=m;d++)if(c=h+(d-w),c<l){var da=d;if(0>g||!q(5,g))da=7-da;var ya=0;q(da,e)&&(ya+=1,ya<<=1);q(da,a)&&(ya+=1);if(b.GBCEnabled&&(0<=g||0<=y)){da=0<=y;var Fa=g&7;da&&(Fa=y&7);var xa=Ua(Fa,ya,da);da=fa(0,xa);Fa=fa(1,xa);xa=fa(2,xa)}else 0>=n&&(n=t.memoryLocationBackgroundPalette),
Fa=da=xa=Ta(ya,n,r);var u=3*(f*l+c);k[p+u]=da;k[p+u+1]=Fa;k[p+u+2]=xa;da=!1;0<=g&&(da=q(7,g));Va(c,f,ya,da);O++}return O}function Ga(a,b){if(a===t.memoryLocationTileDataSelectZeroStart){var c=b+128;q(7,b)&&(c=b-128);return a+16*c}return a+16*b}function Fb(a,b){switch(a){case 1:return q(b,129);case 2:return q(b,135);case 3:return q(b,126);default:return q(b,1)}}function Gb(){var a=Hb();2047>=a&&0<z.NRx0SweepShift&&(z.sweepShadowFrequency=a,z.setFrequency(a),a=Hb());2047<a&&(z.isEnabled=!1)}function Hb(){var a=
z.sweepShadowFrequency;a>>=z.NRx0SweepShift;return a=z.NRx0Negate?z.sweepShadowFrequency-a:z.sweepShadowFrequency+a}function Wa(a){switch(a){case z.channelNumber:if(x.channel1DacEnabled!==z.isDacEnabled)return x.channel1DacEnabled=z.isDacEnabled,!0;break;case K.channelNumber:if(x.channel2DacEnabled!==K.isDacEnabled)return x.channel2DacEnabled=K.isDacEnabled,!0;break;case I.channelNumber:if(x.channel3DacEnabled!==I.isDacEnabled)return x.channel3DacEnabled=I.isDacEnabled,!0;break;case L.channelNumber:if(x.channel4DacEnabled!==
L.isDacEnabled)return x.channel4DacEnabled=L.isDacEnabled,!0}return!1}function Xa(){if(!(f.currentCycles<f.batchProcessCycles()))for(;f.currentCycles>=f.batchProcessCycles();)Ib(f.batchProcessCycles()),f.currentCycles-=f.batchProcessCycles()}function Ib(a){f.frameSequenceCycleCounter+=a;if(f.frameSequenceCycleCounter>=f.maxFrameSequenceCycles()){f.frameSequenceCycleCounter-=f.maxFrameSequenceCycles();switch(f.frameSequencer){case 0:z.updateLength();K.updateLength();I.updateLength();L.updateLength();
break;case 2:z.updateLength();K.updateLength();I.updateLength();L.updateLength();z.updateSweep();break;case 4:z.updateLength();K.updateLength();I.updateLength();L.updateLength();break;case 6:z.updateLength();K.updateLength();I.updateLength();L.updateLength();z.updateSweep();break;case 7:z.updateEnvelope(),K.updateEnvelope(),L.updateEnvelope()}f.frameSequencer+=1;8<=f.frameSequencer&&(f.frameSequencer=0);var b=!0}else b=!1;if(Q.audioAccumulateSamples&&!b){b=z.willChannelUpdate(a)||Wa(z.channelNumber);
var e=K.willChannelUpdate(a)||Wa(K.channelNumber),w=I.willChannelUpdate(a)||Wa(I.channelNumber),m=L.willChannelUpdate(a)||Wa(L.channelNumber);b&&(x.channel1Sample=z.getSampleFromCycleCounter());e&&(x.channel2Sample=K.getSampleFromCycleCounter());w&&(x.channel3Sample=I.getSampleFromCycleCounter());m&&(x.channel4Sample=L.getSampleFromCycleCounter());if(b||e||w||m)x.needToRemixSamples=!0;f.downSampleCycleCounter+=a*f.downSampleCycleMultiplier;f.downSampleCycleCounter>=f.maxDownSampleCycles()&&(f.downSampleCycleCounter-=
f.maxDownSampleCycles(),(x.needToRemixSamples||x.mixerVolumeChanged||x.mixerEnabledChanged)&&za(x.channel1Sample,x.channel2Sample,x.channel3Sample,x.channel4Sample),Aa(x.leftChannelSampleUnsignedByte+1,x.rightChannelSampleUnsignedByte+1,Ha),f.audioQueueIndex+=1,f.audioQueueIndex>=(f.wasmBoyMemoryMaxBufferSize/2|0)-1&&--f.audioQueueIndex)}else if(b=z.getSample(a)|0,e=K.getSample(a)|0,w=I.getSample(a)|0,m=L.getSample(a)|0,x.channel1Sample=b,x.channel2Sample=e,x.channel3Sample=w,x.channel4Sample=m,f.downSampleCycleCounter+=
a*f.downSampleCycleMultiplier,f.downSampleCycleCounter>=f.maxDownSampleCycles()){f.downSampleCycleCounter-=f.maxDownSampleCycles();a=za(b,e,w,m);var d=F(a);Aa(d+1,(a&255)+1,Ha);Q.enableAudioDebugging&&(a=za(b,15,15,15),d=F(a),Aa(d+1,(a&255)+1,gb),a=za(15,e,15,15),d=F(a),Aa(d+1,(a&255)+1,hb),a=za(15,15,w,15),d=F(a),Aa(d+1,(a&255)+1,ib),a=za(15,15,15,m),d=F(a),Aa(d+1,(a&255)+1,jb));f.audioQueueIndex+=1;f.audioQueueIndex>=(f.wasmBoyMemoryMaxBufferSize/2|0)-1&&--f.audioQueueIndex}}function kb(){return f.audioQueueIndex}
function lb(){f.audioQueueIndex=0}function za(a,b,e,w){void 0===a&&(a=15);void 0===b&&(b=15);void 0===e&&(e=15);void 0===w&&(w=15);x.mixerVolumeChanged=!1;var c=0,d=0;c=f.NR51IsChannel1EnabledOnLeftOutput?c+a:c+15;c=f.NR51IsChannel2EnabledOnLeftOutput?c+b:c+15;c=f.NR51IsChannel3EnabledOnLeftOutput?c+e:c+15;c=f.NR51IsChannel4EnabledOnLeftOutput?c+w:c+15;d=f.NR51IsChannel1EnabledOnRightOutput?d+a:d+15;d=f.NR51IsChannel2EnabledOnRightOutput?d+b:d+15;d=f.NR51IsChannel3EnabledOnRightOutput?d+e:d+15;d=
f.NR51IsChannel4EnabledOnRightOutput?d+w:d+15;x.mixerEnabledChanged=!1;x.needToRemixSamples=!1;a=Jb(c,f.NR50LeftMixerVolume+1);d=Jb(d,f.NR50RightMixerVolume+1);x.leftChannelSampleUnsignedByte=a;x.rightChannelSampleUnsignedByte=d;return r(a,d)}function Jb(a,b){if(60===a)return 127;a=1E5*(a-60)*b/8|0;a=a/1E5|0;a+=60;a=1E5*a/(12E6/254|0)|0;return a|=0}function Aa(a,b,e){e+=2*f.audioQueueIndex;k[e]=a+1;k[e+1]=b+1}function Ia(a){Ya(!1);var c=y(p.memoryLocationInterruptRequest);c=H(a,c);p.interruptsRequestedValue=
c;h(p.memoryLocationInterruptRequest,c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var e=b.programCounter,w=F(e),d=c+1;h(c,e&255);h(d,w);switch(a){case p.bitPositionVBlankInterrupt:p.isVBlankInterruptRequested=!1;b.programCounter=64;break;case p.bitPositionLcdInterrupt:p.isLcdInterruptRequested=!1;b.programCounter=72;break;case p.bitPositionTimerInterrupt:p.isTimerInterruptRequested=!1;b.programCounter=80;break;case p.bitPositionSerialInterrupt:p.isSerialInterruptRequested=!1;b.programCounter=
88;break;case p.bitPositionJoypadInterrupt:p.isJoypadInterruptRequested=!1,b.programCounter=96}}function Ba(a){var b=y(p.memoryLocationInterruptRequest);b|=1<<a;p.interruptsRequestedValue=b;h(p.memoryLocationInterruptRequest,b)}function Ya(a){a?p.masterInterruptSwitchDelay=!0:p.masterInterruptSwitch=!1}function mb(a){for(var b=0;b<a;){var e=n.dividerRegister;b+=4;n.dividerRegister+=4;65535<n.dividerRegister&&(n.dividerRegister-=65536);n.timerEnabled&&(n.timerCounterOverflowDelay?(n.timerCounter=n.timerModulo,
p.isTimerInterruptRequested=!0,Ba(p.bitPositionTimerInterrupt),n.timerCounterOverflowDelay=!1,n.timerCounterWasReset=!0):n.timerCounterWasReset&&(n.timerCounterWasReset=!1),Kb(e,n.dividerRegister)&&nb())}}function nb(){n.timerCounter+=1;255<n.timerCounter&&(n.timerCounterOverflowDelay=!0,n.timerCounter=0)}function Kb(a,b){var c=ob(n.timerInputClock);return q(c,a)&&!q(c,b)?!0:!1}function ob(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function ua(a){var c=b.isStopped=
!1;bc(a)||(c=!0);ia(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,A.isDpadType&&c&&(a=!0),A.isButtonType&&!c&&(a=!0),a&&(p.isJoypadInterruptRequested=!0,Ba(p.bitPositionJoypadInterrupt)))}function bc(a){switch(a){case 0:return A.up;case 1:return A.right;case 2:return A.down;case 3:return A.left;case 4:return A.a;case 5:return A.b;case 6:return A.select;case 7:return A.start;default:return!1}}function ia(a,b){switch(a){case 0:A.up=b;break;case 1:A.right=b;break;case 2:A.down=b;break;case 3:A.left=b;break;case 4:A.a=
b;break;case 5:A.b=b;break;case 6:A.select=b;break;case 7:A.start=b}}function Lb(a,c,e){for(var w=0;w<e;w++){for(var m=pb(a+w),k=c+w;40959<k;)k-=8192;Mb(k,m)}a=32;b.GBCDoubleSpeed&&(a=64);d.DMACycles+=e/16*a}function qb(a,c){if(a===b.memoryLocationSpeedSwitch)return h(b.memoryLocationSpeedSwitch,c&1),!1;var e=d.videoRamLocation,w=d.spriteInformationTableLocation;if(a<e){if(!d.isRomOnly)if(8191>=a){if(!d.isMBC2||q(4,c))c&=15,0===c?d.isRamBankingEnabled=!1:10===c&&(d.isRamBankingEnabled=!0)}else 16383>=
a?!d.isMBC5||12287>=a?(d.isMBC2&&(d.currentRomBank=c&15),d.isMBC1?(c&=31,d.currentRomBank&=224):d.isMBC3?(c&=127,d.currentRomBank&=128):d.isMBC5&&(d.currentRomBank&=0),d.currentRomBank|=c):(a=0,e=d.currentRomBank&255,0<c&&(a=1),d.currentRomBank=r(a,e)):!d.isMBC2&&24575>=a?d.isMBC1&&d.isMBC1RomModeEnabled?(d.currentRomBank&=31,d.currentRomBank|=c&224):(c=d.isMBC5?c&15:c&3,d.currentRamBank=c):!d.isMBC2&&32767>=a&&d.isMBC1&&(q(0,c)?d.isMBC1RomModeEnabled=!0:d.isMBC1RomModeEnabled=!1);return!1}if(a>=
e&&a<d.cartridgeRamLocation)return!0;if(a>=d.echoRamLocation&&a<w)return h(a-8192,c),!0;if(a>=w&&a<=d.spriteInformationTableLocationEnd)return 2>B.currentLcdMode?!1:!0;if(a>=d.unusableMemoryLocation&&a<=d.unusableMemoryEndLocation)return!1;if(a===M.memoryLocationSerialTransferControl)return M.updateTransferControl(c);if(65296<=a&&65318>=a){Xa();if(a===f.memoryLocationNR52||f.NR52IsSoundEnabled){switch(a){case z.memoryLocationNRx0:z.updateNRx0(c);break;case I.memoryLocationNRx0:I.updateNRx0(c);break;
case z.memoryLocationNRx1:z.updateNRx1(c);break;case K.memoryLocationNRx1:K.updateNRx1(c);break;case I.memoryLocationNRx1:I.updateNRx1(c);break;case L.memoryLocationNRx1:L.updateNRx1(c);break;case z.memoryLocationNRx2:z.updateNRx2(c);break;case K.memoryLocationNRx2:K.updateNRx2(c);break;case I.memoryLocationNRx2:I.volumeCodeChanged=!0;I.updateNRx2(c);break;case L.memoryLocationNRx2:L.updateNRx2(c);break;case z.memoryLocationNRx3:z.updateNRx3(c);break;case K.memoryLocationNRx3:K.updateNRx3(c);break;
case I.memoryLocationNRx3:I.updateNRx3(c);break;case L.memoryLocationNRx3:L.updateNRx3(c);break;case z.memoryLocationNRx4:q(7,c)&&(z.updateNRx4(c),z.trigger());break;case K.memoryLocationNRx4:q(7,c)&&(K.updateNRx4(c),K.trigger());break;case I.memoryLocationNRx4:q(7,c)&&(I.updateNRx4(c),I.trigger());break;case L.memoryLocationNRx4:q(7,c)&&(L.updateNRx4(c),L.trigger());break;case f.memoryLocationNR50:f.updateNR50(c);x.mixerVolumeChanged=!0;break;case f.memoryLocationNR51:f.updateNR51(c);x.mixerEnabledChanged=
!0;break;case f.memoryLocationNR52:if(f.updateNR52(c),!q(7,c))for(c=65296;65318>c;c++)h(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&Xa();if(a>=B.memoryLocationLcdControl&&a<=t.memoryLocationWindowX){if(a===B.memoryLocationLcdControl)return B.updateLcdControl(c),!0;if(a===B.memoryLocationLcdStatus)return B.updateLcdStatus(c),!1;if(a===t.memoryLocationScanlineRegister)return t.scanlineRegister=0,h(a,0),!1;if(a===B.memoryLocationCoincidenceCompare)return B.coincidenceCompare=c,!0;if(a===t.memoryLocationDmaTransfer){c<<=
8;for(a=0;159>=a;a++)e=y(c+a),h(d.spriteInformationTableLocation+a,e);d.DMACycles=644;return!0}switch(a){case t.memoryLocationScrollX:t.scrollX=c;break;case t.memoryLocationScrollY:t.scrollY=c;break;case t.memoryLocationWindowX:t.windowX=c;break;case t.memoryLocationWindowY:t.windowY=c}return!0}if(a===d.memoryLocationHdmaTrigger)return b.GBCEnabled&&(d.isHblankHdmaActive&&!q(7,c)?(d.isHblankHdmaActive=!1,c=y(d.memoryLocationHdmaTrigger),h(d.memoryLocationHdmaTrigger,c|128)):(a=y(d.memoryLocationHdmaSourceHigh),
e=y(d.memoryLocationHdmaSourceLow),a=r(a,e)&65520,e=y(d.memoryLocationHdmaDestinationHigh),w=y(d.memoryLocationHdmaDestinationLow),e=r(e,w),e=(e&8176)+d.videoRamLocation,w=H(7,c),w=16*(w+1),q(7,c)?(d.isHblankHdmaActive=!0,d.hblankHdmaTransferLengthRemaining=w,d.hblankHdmaSource=a,d.hblankHdmaDestination=e,h(d.memoryLocationHdmaTrigger,H(7,c))):(Lb(a,e,w),h(d.memoryLocationHdmaTrigger,255)))),!1;if((a===d.memoryLocationGBCWRAMBank||a===d.memoryLocationGBCVRAMBank)&&d.isHblankHdmaActive&&(16384<=d.hblankHdmaSource&&
32767>=d.hblankHdmaSource||53248<=d.hblankHdmaSource&&57343>=d.hblankHdmaSource))return!1;if(a>=Ja.memoryLocationBackgroundPaletteIndex&&a<=Ja.memoryLocationSpritePaletteData){if(a===Ja.memoryLocationBackgroundPaletteData||a===Ja.memoryLocationSpritePaletteData){e=y(a-1);e=H(6,e);w=!1;a===Ja.memoryLocationSpritePaletteData&&(w=!0);var m=e&63;w&&(m+=64);k[67584+m]=c;c=e;--a;q(7,c)&&h(a,c+1|128)}return!0}if(a>=n.memoryLocationDividerRegister&&a<=n.memoryLocationTimerControl){mb(n.currentCycles);n.currentCycles=
0;switch(a){case n.memoryLocationDividerRegister:return n.updateDividerRegister(c),!1;case n.memoryLocationTimerCounter:n.updateTimerCounter(c);break;case n.memoryLocationTimerModulo:n.updateTimerModulo(c);break;case n.memoryLocationTimerControl:n.updateTimerControl(c)}return!0}a===A.memoryLocationJoypadRegister&&A.updateJoypad(c);if(a===p.memoryLocationInterruptRequest)return p.updateInterruptRequested(c),!0;a===p.memoryLocationInterruptEnabled&&p.updateInterruptEnabled(c);return!0}function rb(a){switch(a>>
12){case 0:case 1:case 2:case 3:return a+Ka;case 4:case 5:case 6:case 7:var c=d.currentRomBank;d.isMBC5||0!==c||(c=1);return 16384*c+(a-d.switchableCartridgeRomLocation)+Ka;case 8:case 9:return c=0,b.GBCEnabled&&(c=y(d.memoryLocationGBCVRAMBank)&1),a-d.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*d.currentRamBank+(a-d.cartridgeRamLocation)+Za;case 12:return a-d.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=y(d.memoryLocationGBCWRAMBank)&7),1>c&&(c=1),a-d.internalRamBankZeroLocation+
18432+4096*(c-1);default:return a-d.echoRamLocation+51200}}function h(a,b){a=rb(a);k[a]=b}function Mb(a,b){a===aa.writeGbMemory&&(aa.reachedBreakpoint=!0);qb(a,b)&&h(a,b)}function R(a,b){k[a]=b?1:0}function Nb(a){t.scanlineCycleCounter=0;t.scanlineRegister=0;h(t.memoryLocationScanlineRegister,0);var b=y(B.memoryLocationLcdStatus);b=H(1,b);b=H(0,b);B.currentLcdMode=0;h(B.memoryLocationLcdStatus,b);if(a)for(a=0;a<Ob;a++)k[67584+a]=255}function Pb(a,b){var c=B.coincidenceCompare;0!==a&&1!==a||t.scanlineRegister!==
c?b=H(2,b):(b|=4,q(6,b)&&(p.isLcdInterruptRequested=!0,Ba(p.bitPositionLcdInterrupt)));return b}function Qb(a,c,e,w,d,h){for(var m=w>>3;160>d;d++){var f=d+h;256<=f&&(f-=256);var l=e+32*m+(f>>3),p=Y(l,0),O=!1;if(Q.tileCaching){var n=d;var g=a,r=f,u=l,x=p,v=0;if(0<g&&8<n&&x===ja.tileId&&n===ja.nextXIndexToPerformCacheCheck){var z=x=!1;q(5,y(u-1))&&(x=!0);q(5,y(u))&&(z=!0);for(u=0;8>u;u++)if(x!==z&&(u=7-u),160>=n+u){for(var B=n-(8-u),C=Ca+3*(160*g+(n+u)),A=0;3>A;A++)ea(n+u,g,A,k[C+A]);B=k[67712+(160*
g+B)];Va(n+u,g,H(2,B),q(2,B));v++}}else ja.tileId=x;n>=ja.nextXIndexToPerformCacheCheck&&(ja.nextXIndexToPerformCacheCheck=n+8,g=r%8,n<g&&(ja.nextXIndexToPerformCacheCheck+=g));n=v;0<n&&(d+=n-1,O=!0)}Q.tileRendering&&!O?(O=d,n=a,v=c,g=w%8,r=0,0==O&&(r=f-f/8*8),f=7,160<O+8&&(f=160-O),x=-1,z=0,b.GBCEnabled&&(x=Y(l,1),q(3,x)&&(z=1),q(6,x)&&(g=7-g)),n=fb(p,v,z,r,f,g,O,n,160,Ca,!1,0,x,-1),0<n&&(d+=n-1)):O||(b.GBCEnabled?(O=d,n=a,g=w,v=Ga(c,p),l=Y(l,1),g%=8,q(6,l)&&(g=7-g),r=0,q(3,l)&&(r=1),p=Y(v+2*g,r),
v=Y(v+2*g+1,r),g=f%8,q(5,l)||(g=7-g),f=0,q(g,v)&&(f=f+1<<1),q(g,p)&&(f+=1),g=Ua(l&7,f,!1),p=fa(0,g),v=fa(1,g),g=fa(2,g),ea(O,n,0,p),ea(O,n,1,v),ea(O,n,2,g),Va(O,n,f,q(7,l))):(l=d,O=a,v=w,n=Ga(c,p),v%=8,p=Y(n+2*v,0),n=Y(n+2*v+1,0),v=7-f%8,f=0,q(v,n)&&(f=f+1<<1),q(v,p)&&(f+=1),p=Ta(f,t.memoryLocationBackgroundPalette),ea(l,O,0,p),ea(l,O,1,p),ea(l,O,2,p),Va(l,O,f)))}}function Rb(a){if(B.enabled)for(t.scanlineCycleCounter+=a;t.scanlineCycleCounter>=t.MAX_CYCLES_PER_SCANLINE();){t.scanlineCycleCounter-=
t.MAX_CYCLES_PER_SCANLINE();a=t.scanlineRegister;if(144===a){if(Q.graphicsDisableScanlineRendering)for(var b=0;144>=b;b++)sb(b);else sb(a);for(b=0;144>b;b++)for(var e=0;160>e;e++)k[67712+(160*b+e)]=0;ja.tileId=-1;ja.nextXIndexToPerformCacheCheck=-1}else 144>a&&(Q.graphicsDisableScanlineRendering||sb(a));a=153<a?0:a+1;t.scanlineRegister=a}if(B.enabled)if(b=t.scanlineRegister,e=B.currentLcdMode,a=0,144<=b?a=1:t.scanlineCycleCounter>=t.MIN_CYCLES_SPRITES_LCD_MODE()?a=2:t.scanlineCycleCounter>=t.MIN_CYCLES_TRANSFER_DATA_LCD_MODE()&&
(a=3),e!==a){b=y(B.memoryLocationLcdStatus);B.currentLcdMode=a;e=!1;switch(a){case 0:b=H(0,b);b=H(1,b);e=q(3,b);break;case 1:b=H(1,b);b|=1;e=q(4,b);break;case 2:b=H(0,b);b|=2;e=q(5,b);break;case 3:b|=3}e&&(p.isLcdInterruptRequested=!0,Ba(p.bitPositionLcdInterrupt));0===a&&d.isHblankHdmaActive&&(e=16,d.hblankHdmaTransferLengthRemaining<e&&(e=d.hblankHdmaTransferLengthRemaining),Lb(d.hblankHdmaSource,d.hblankHdmaDestination,e),d.hblankHdmaSource+=e,d.hblankHdmaDestination+=e,d.hblankHdmaTransferLengthRemaining-=
e,0>=d.hblankHdmaTransferLengthRemaining?(d.isHblankHdmaActive=!1,h(d.memoryLocationHdmaTrigger,255)):h(d.memoryLocationHdmaTrigger,H(7,d.hblankHdmaTransferLengthRemaining/16-1)));1===a&&(p.isVBlankInterruptRequested=!0,Ba(p.bitPositionVBlankInterrupt));b=Pb(a,b);h(B.memoryLocationLcdStatus,b)}else 153===b&&(b=y(B.memoryLocationLcdStatus),b=Pb(a,b),h(B.memoryLocationLcdStatus,b))}function sb(a){var c=t.memoryLocationTileDataSelectZeroStart;B.bgWindowTileDataSelect&&(c=t.memoryLocationTileDataSelectOneStart);
if(b.GBCEnabled||B.bgDisplayEnabled){var e=t.memoryLocationTileMapSelectZeroStart;B.bgTileMapDisplaySelect&&(e=t.memoryLocationTileMapSelectOneStart);var d=t.scrollX,m=a+t.scrollY;256<=m&&(m-=256);Qb(a,c,e,m,0,d)}B.windowDisplayEnabled&&(e=t.memoryLocationTileMapSelectZeroStart,B.windowTileMapDisplaySelect&&(e=t.memoryLocationTileMapSelectOneStart),d=t.windowX,m=t.windowY,a<m||(d-=7,Qb(a,c,e,a-m,d,-1*d)));if(B.spriteDisplayEnable)for(c=B.tallSpriteSize,e=39;0<=e;e--){m=4*e;var f=y(t.memoryLocationSpriteAttributesTable+
m);d=y(t.memoryLocationSpriteAttributesTable+m+1);var h=y(t.memoryLocationSpriteAttributesTable+m+2);f-=16;d-=8;var l=8;c&&(l=16,1===h%2&&--h);if(a>=f&&a<f+l){m=y(t.memoryLocationSpriteAttributesTable+m+3);var n=q(7,m),g=q(6,m),p=q(5,m);f=a-f;g&&(f-=l,f*=-1,--f);f*=2;h=Ga(t.memoryLocationTileDataSelectOneStart,h);l=h+=f;f=0;b.GBCEnabled&&q(3,m)&&(f=1);h=Y(l,f);l=Y(l+1,f);for(f=7;0<=f;f--){g=f;p&&(g-=7,g*=-1);var r=0;q(g,l)&&(r+=1,r<<=1);q(g,h)&&(r+=1);if(0!==r&&(g=d+(7-f),0<=g&&160>=g)){var u=!1,
v=!1,x=!1;b.GBCEnabled&&!B.bgDisplayEnabled&&(u=!0);if(!u){var z=k[67712+(160*a+g)],A=z&3;n&&0<A?v=!0:b.GBCEnabled&&q(2,z)&&0<A&&(x=!0)}if(u||!v&&!x)b.GBCEnabled?(v=Ua(m&7,r,!0),r=fa(0,v),u=fa(1,v),v=fa(2,v),ea(g,a,0,r),ea(g,a,1,u),ea(g,a,2,v)):(u=t.memoryLocationSpritePaletteOne,q(4,m)&&(u=t.memoryLocationSpritePaletteTwo),r=Ta(r,u),ea(g,a,0,r),ea(g,a,1,r),ea(g,a,2,r))}}}}}function ea(a,b,e,d){k[Ca+3*(160*b+a)+e]=d}function Y(a,b){return k[a-d.videoRamLocation+2048+8192*(b&1)]}function tb(a){var c=
d.videoRamLocation;return a<c||a>=c&&a<d.cartridgeRamLocation?-1:a>=d.echoRamLocation&&a<d.spriteInformationTableLocation?y(a-8192):a>=d.spriteInformationTableLocation&&a<=d.spriteInformationTableLocationEnd?2>B.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=y(b.memoryLocationSpeedSwitch),q(0,c)||(a=H(0,a)),b.GBCDoubleSpeed||(a=H(7,a)),a):a===t.memoryLocationScanlineRegister?(h(a,t.scanlineRegister),t.scanlineRegister):65296<=a&&65318>=a?(Xa(),a=a===f.memoryLocationNR52?y(f.memoryLocationNR52)&
128|112:-1,a):65328<=a&&65343>=a?(Xa(),-1):a===n.memoryLocationDividerRegister?(c=F(n.dividerRegister),h(a,c),c):a===n.memoryLocationTimerCounter?(h(a,n.timerCounter),n.timerCounter):a===p.memoryLocationInterruptRequest?224|p.interruptsRequestedValue:a===A.memoryLocationJoypadRegister?(a=A.joypadRegisterFlipped,A.isDpadType?(a=A.up?H(2,a):a|4,a=A.right?H(0,a):a|1,a=A.down?H(3,a):a|8,a=A.left?H(1,a):a|2):A.isButtonType&&(a=A.a?H(0,a):a|1,a=A.b?H(1,a):a|2,a=A.select?H(2,a):a|4,a=A.start?H(3,a):a|8),
a|240):-1}function y(a){return k[rb(a)]}function pb(a){a===aa.readGbMemory&&(aa.reachedBreakpoint=!0);var b=tb(a);switch(b){case -1:return y(a);default:return b}}function S(a){return 0<k[a]?!0:!1}function ka(a){T(b.registerA,a);eb(b.registerA,a);b.registerA=b.registerA+a&255;0===b.registerA?l(1):l(0);u(0)}function la(a){var c=b.registerA+a+V()&255;0!=((b.registerA^a^c)&16)?D(1):D(0);0<(b.registerA+a+V()&256)?v(1):v(0);b.registerA=c;0===b.registerA?l(1):l(0);u(0)}function ma(a){var c=-1*a;T(b.registerA,
c);eb(b.registerA,c);b.registerA=b.registerA-a&255;0===b.registerA?l(1):l(0);u(1)}function na(a){var c=b.registerA-a-V()&255;0!=((b.registerA^a^c)&16)?D(1):D(0);0<(b.registerA-a-V()&256)?v(1):v(0);b.registerA=c;0===b.registerA?l(1):l(0);u(1)}function oa(a){b.registerA&=a;0===b.registerA?l(1):l(0);u(0);D(1);v(0)}function pa(a){b.registerA=(b.registerA^a)&255;0===b.registerA?l(1):l(0);u(0);D(0);v(0)}function qa(a){b.registerA|=a;0===b.registerA?l(1):l(0);u(0);D(0);v(0)}function ra(a){a*=-1;T(b.registerA,
a);eb(b.registerA,a);0===b.registerA+a?l(1):l(0);u(1)}function va(a,b){0===(b&1<<a)?l(1):l(0);u(0);D(1);return b}function ba(a,b,e){return 0<b?e|1<<a:e&~(1<<a)}function La(a){a=db(a);b.programCounter=b.programCounter+a&65535;b.programCounter=b.programCounter+1&65535}function Sb(a){b.programCounter=b.programCounter+1&65535;b.isHaltBug&&(b.programCounter=b.programCounter-1&65535);switch((a&240)>>4){case 0:return cc(a);case 1:return dc(a);case 2:return ec(a);case 3:return fc(a);case 4:return gc(a);case 5:return hc(a);
case 6:return ic(a);case 7:return jc(a);case 8:return kc(a);case 9:return lc(a);case 10:return mc(a);case 11:return nc(a);case 12:return oc(a);case 13:return pc(a);case 14:return qc(a);default:return rc(a)}}function J(a){sa(4);return pb(a)}function U(a,b){sa(4);Mb(a,b)}function ha(a){sa(8);var b=tb(a);switch(b){case -1:b=y(a)}a+=1;var e=tb(a);switch(e){case -1:a=y(a);break;default:a=e}return r(a,b)}function W(a,b){sa(8);var c=F(b);b&=255;var d=a+1;qb(a,b)&&h(a,b);qb(d,c)&&h(d,c)}function G(){sa(4);
return y(b.programCounter)}function Z(){sa(4);var a=y(b.programCounter+1&65535);return r(a,G())}function cc(a){switch(a){case 0:return 4;case 1:return a=Z(),b.registerB=F(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return U(r(b.registerB,b.registerC),b.registerA),4;case 3:return a=r(b.registerB,b.registerC),a++,b.registerB=F(a),b.registerC=a&255,8;case 4:return T(b.registerB,1),b.registerB=b.registerB+1&255,0===b.registerB?l(1):l(0),u(0),4;case 5:return T(b.registerB,-1),
b.registerB=b.registerB-1&255,0===b.registerB?l(1):l(0),u(1),4;case 6:return b.registerB=G(),b.programCounter=b.programCounter+1&65535,4;case 7:return 128===(b.registerA&128)?v(1):v(0),a=b.registerA,b.registerA=(a<<1|a>>7)&255,l(0),u(0),D(0),4;case 8:return W(Z(),b.stackPointer),b.programCounter=b.programCounter+2&65535,4;case 9:a=r(b.registerH,b.registerL);var c=r(b.registerB,b.registerC);wa(a,c,!1);a=a+c&65535;b.registerH=F(a);b.registerL=a&255;u(0);return 8;case 10:return b.registerA=J(r(b.registerB,
b.registerC)),4;case 11:return a=r(b.registerB,b.registerC),a=a-1&65535,b.registerB=F(a),b.registerC=a&255,8;case 12:return T(b.registerC,1),b.registerC=b.registerC+1&255,0===b.registerC?l(1):l(0),u(0),4;case 13:return T(b.registerC,-1),b.registerC=b.registerC-1&255,0===b.registerC?l(1):l(0),u(1),4;case 14:return b.registerC=G(),b.programCounter=b.programCounter+1&65535,4;case 15:return 0<(b.registerA&1)?v(1):v(0),a=b.registerA,b.registerA=(a>>1|a<<7)&255,l(0),u(0),D(0),4}return-1}function dc(a){switch(a){case 16:if(b.GBCEnabled&&
(a=J(b.memoryLocationSpeedSwitch),q(0,a)))return a=H(0,a),q(7,a)?(b.GBCDoubleSpeed=!1,a=H(7,a)):(b.GBCDoubleSpeed=!0,a|=128),U(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=Z(),b.registerD=F(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return U(r(b.registerD,b.registerE),b.registerA),4;case 19:return a=r(b.registerD,b.registerE),a=a+1&65535,b.registerD=F(a),b.registerE=a&255,8;case 20:return T(b.registerD,
1),b.registerD=b.registerD+1&255,0===b.registerD?l(1):l(0),u(0),4;case 21:return T(b.registerD,-1),b.registerD=b.registerD-1&255,0===b.registerD?l(1):l(0),u(1),4;case 22:return b.registerD=G(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=!1,128===(b.registerA&128)&&(a=!0),b.registerA=(b.registerA<<1|V())&255,a?v(1):v(0),l(0),u(0),D(0),4;case 24:return La(G()),8;case 25:a=r(b.registerH,b.registerL);var c=r(b.registerD,b.registerE);wa(a,c,!1);a=a+c&65535;b.registerH=F(a);b.registerL=
a&255;u(0);return 8;case 26:return a=r(b.registerD,b.registerE),b.registerA=J(a),4;case 27:return a=r(b.registerD,b.registerE),a=a-1&65535,b.registerD=F(a),b.registerE=a&255,8;case 28:return T(b.registerE,1),b.registerE=b.registerE+1&255,0===b.registerE?l(1):l(0),u(0),4;case 29:return T(b.registerE,-1),b.registerE=b.registerE-1&255,0===b.registerE?l(1):l(0),u(1),4;case 30:return b.registerE=G(),b.programCounter=b.programCounter+1&65535,4;case 31:return a=!1,1===(b.registerA&1)&&(a=!0),b.registerA=
(b.registerA>>1|V()<<7)&255,a?v(1):v(0),l(0),u(0),D(0),4}return-1}function ec(a){switch(a){case 32:return 0===ta()?La(G()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=Z(),b.registerH=F(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=r(b.registerH,b.registerL),U(a,b.registerA),a=a+1&65535,b.registerH=F(a),b.registerL=a&255,4;case 35:return a=r(b.registerH,b.registerL),a=a+1&65535,b.registerH=F(a),b.registerL=a&255,8;case 36:return T(b.registerH,1),
b.registerH=b.registerH+1&255,0===b.registerH?l(1):l(0),u(0),4;case 37:return T(b.registerH,-1),b.registerH=b.registerH-1&255,0===b.registerH?l(1):l(0),u(1),4;case 38:return b.registerH=G(),b.programCounter=b.programCounter+1&65535,4;case 39:var c=0;0<(b.registerF>>5&1)&&(c|=6);0<V()&&(c|=96);0<(b.registerF>>6&1)?a=b.registerA-c&255:(9<(b.registerA&15)&&(c|=6),153<b.registerA&&(c|=96),a=b.registerA+c&255);0===a?l(1):l(0);0!==(c&96)?v(1):v(0);D(0);b.registerA=a;return 4;case 40:return 0<ta()?La(G()):
b.programCounter=b.programCounter+1&65535,8;case 41:return a=r(b.registerH,b.registerL),wa(a,a,!1),a=2*a&65535,b.registerH=F(a),b.registerL=a&255,u(0),8;case 42:return a=r(b.registerH,b.registerL),b.registerA=J(a),a=a+1&65535,b.registerH=F(a),b.registerL=a&255,4;case 43:return a=r(b.registerH,b.registerL),a=a-1&65535,b.registerH=F(a),b.registerL=a&255,8;case 44:return T(b.registerL,1),b.registerL=b.registerL+1&255,0===b.registerL?l(1):l(0),u(0),4;case 45:return T(b.registerL,-1),b.registerL=b.registerL-
1&255,0===b.registerL?l(1):l(0),u(1),4;case 46:return b.registerL=G(),b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=~b.registerA,u(1),D(1),4}return-1}function fc(a){switch(a){case 48:return 0===V()?La(G()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=Z(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=r(b.registerH,b.registerL),U(a,b.registerA),a=a-1&65535,b.registerH=F(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+
1&65535,8;case 52:a=r(b.registerH,b.registerL);var c=J(a);T(c,1);c=c+1&255;0===c?l(1):l(0);u(0);U(a,c);return 4;case 53:return a=r(b.registerH,b.registerL),c=J(a),T(c,-1),c=c-1&255,0===c?l(1):l(0),u(1),U(a,c),4;case 54:return U(r(b.registerH,b.registerL),G()),b.programCounter=b.programCounter+1&65535,4;case 55:return u(0),D(0),v(1),4;case 56:return 1===V()?La(G()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=r(b.registerH,b.registerL),wa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,
b.registerH=F(a),b.registerL=a&255,u(0),8;case 58:return a=r(b.registerH,b.registerL),b.registerA=J(a),a=a-1&65535,b.registerH=F(a),b.registerL=a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return T(b.registerA,1),b.registerA=b.registerA+1&255,0===b.registerA?l(1):l(0),u(0),4;case 61:return T(b.registerA,-1),b.registerA=b.registerA-1&255,0===b.registerA?l(1):l(0),u(1),4;case 62:return b.registerA=G(),b.programCounter=b.programCounter+1&65535,4;case 63:return u(0),D(0),0<V()?
v(0):v(1),4}return-1}function gc(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=J(r(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,
4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=J(r(b.registerH,b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function hc(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=J(r(b.registerH,b.registerL)),4;case 87:return b.registerD=
b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=J(r(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function ic(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=
b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=J(r(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=J(r(b.registerH,b.registerL)),
4;case 111:return b.registerL=b.registerA,4}return-1}function jc(a){switch(a){case 112:return U(r(b.registerH,b.registerL),b.registerB),4;case 113:return U(r(b.registerH,b.registerL),b.registerC),4;case 114:return U(r(b.registerH,b.registerL),b.registerD),4;case 115:return U(r(b.registerH,b.registerL),b.registerE),4;case 116:return U(r(b.registerH,b.registerL),b.registerH),4;case 117:return U(r(b.registerH,b.registerL),b.registerL),4;case 118:return d.isHblankHdmaActive||b.enableHalt(),4;case 119:return U(r(b.registerH,
b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=J(r(b.registerH,b.registerL)),4;case 127:return 4}return-1}function kc(a){switch(a){case 128:return ka(b.registerB),4;case 129:return ka(b.registerC),4;case 130:return ka(b.registerD),4;case 131:return ka(b.registerE),
4;case 132:return ka(b.registerH),4;case 133:return ka(b.registerL),4;case 134:return a=J(r(b.registerH,b.registerL)),ka(a),4;case 135:return ka(b.registerA),4;case 136:return la(b.registerB),4;case 137:return la(b.registerC),4;case 138:return la(b.registerD),4;case 139:return la(b.registerE),4;case 140:return la(b.registerH),4;case 141:return la(b.registerL),4;case 142:return a=J(r(b.registerH,b.registerL)),la(a),4;case 143:return la(b.registerA),4}return-1}function lc(a){switch(a){case 144:return ma(b.registerB),
4;case 145:return ma(b.registerC),4;case 146:return ma(b.registerD),4;case 147:return ma(b.registerE),4;case 148:return ma(b.registerH),4;case 149:return ma(b.registerL),4;case 150:return a=J(r(b.registerH,b.registerL)),ma(a),4;case 151:return ma(b.registerA),4;case 152:return na(b.registerB),4;case 153:return na(b.registerC),4;case 154:return na(b.registerD),4;case 155:return na(b.registerE),4;case 156:return na(b.registerH),4;case 157:return na(b.registerL),4;case 158:return a=J(r(b.registerH,b.registerL)),
na(a),4;case 159:return na(b.registerA),4}return-1}function mc(a){switch(a){case 160:return oa(b.registerB),4;case 161:return oa(b.registerC),4;case 162:return oa(b.registerD),4;case 163:return oa(b.registerE),4;case 164:return oa(b.registerH),4;case 165:return oa(b.registerL),4;case 166:return a=J(r(b.registerH,b.registerL)),oa(a),4;case 167:return oa(b.registerA),4;case 168:return pa(b.registerB),4;case 169:return pa(b.registerC),4;case 170:return pa(b.registerD),4;case 171:return pa(b.registerE),
4;case 172:return pa(b.registerH),4;case 173:return pa(b.registerL),4;case 174:return a=J(r(b.registerH,b.registerL)),pa(a),4;case 175:return pa(b.registerA),4}return-1}function nc(a){switch(a){case 176:return qa(b.registerB),4;case 177:return qa(b.registerC),4;case 178:return qa(b.registerD),4;case 179:return qa(b.registerE),4;case 180:return qa(b.registerH),4;case 181:return qa(b.registerL),4;case 182:return a=J(r(b.registerH,b.registerL)),qa(a),4;case 183:return qa(b.registerA),4;case 184:return ra(b.registerB),
4;case 185:return ra(b.registerC),4;case 186:return ra(b.registerD),4;case 187:return ra(b.registerE),4;case 188:return ra(b.registerH),4;case 189:return ra(b.registerL),4;case 190:return a=J(r(b.registerH,b.registerL)),ra(a),4;case 191:return ra(b.registerA),4}return-1}function oc(a){switch(a){case 192:return 0===ta()?(b.programCounter=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 193:return a=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=F(a),b.registerC=
a&255,4;case 194:if(0===ta())return b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 195:return b.programCounter=Z(),8;case 196:if(0===ta())return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter+2&65535),b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,r(b.registerB,b.registerC)),8;case 198:return ka(G()),b.programCounter=b.programCounter+1&65535,
4;case 199:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=0,8;case 200:return 1===ta()?(b.programCounter=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 201:return b.programCounter=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,8;case 202:if(1===ta())return b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=G();a=-1;var e=!1,d=0,m=0,f=c%8;switch(f){case 0:d=b.registerB;break;case 1:d=
b.registerC;break;case 2:d=b.registerD;break;case 3:d=b.registerE;break;case 4:d=b.registerH;break;case 5:d=b.registerL;break;case 6:d=J(r(b.registerH,b.registerL));break;case 7:d=b.registerA}var h=(c&240)>>4;switch(h){case 0:7>=c?(c=d,128===(c&128)?v(1):v(0),c=(c<<1|c>>7)&255,0===c?l(1):l(0),u(0),D(0),m=c,e=!0):15>=c&&(c=d,0<(c&1)?v(1):v(0),c=(c>>1|c<<7)&255,0===c?l(1):l(0),u(0),D(0),m=c,e=!0);break;case 1:23>=c?(c=d,e=!1,128===(c&128)&&(e=!0),c=(c<<1|V())&255,e?v(1):v(0),0===c?l(1):l(0),u(0),D(0),
m=c,e=!0):31>=c&&(c=d,e=!1,1===(c&1)&&(e=!0),c=(c>>1|V()<<7)&255,e?v(1):v(0),0===c?l(1):l(0),u(0),D(0),m=c,e=!0);break;case 2:39>=c?(c=d,e=!1,128===(c&128)&&(e=!0),c=c<<1&255,e?v(1):v(0),0===c?l(1):l(0),u(0),D(0),m=c,e=!0):47>=c&&(c=d,e=!1,128===(c&128)&&(e=!0),d=!1,1===(c&1)&&(d=!0),c=c>>1&255,e&&(c|=128),0===c?l(1):l(0),u(0),D(0),d?v(1):v(0),m=c,e=!0);break;case 3:55>=c?(c=d,c=((c&15)<<4|(c&240)>>4)&255,0===c?l(1):l(0),u(0),D(0),v(0),m=c,e=!0):63>=c&&(c=d,e=!1,1===(c&1)&&(e=!0),c=c>>1&255,0===c?
l(1):l(0),u(0),D(0),e?v(1):v(0),m=c,e=!0);break;case 4:71>=c?(m=va(0,d),e=!0):79>=c&&(m=va(1,d),e=!0);break;case 5:87>=c?(m=va(2,d),e=!0):95>=c&&(m=va(3,d),e=!0);break;case 6:103>=c?(m=va(4,d),e=!0):111>=c&&(m=va(5,d),e=!0);break;case 7:119>=c?(m=va(6,d),e=!0):127>=c&&(m=va(7,d),e=!0);break;case 8:135>=c?(m=ba(0,0,d),e=!0):143>=c&&(m=ba(1,0,d),e=!0);break;case 9:151>=c?(m=ba(2,0,d),e=!0):159>=c&&(m=ba(3,0,d),e=!0);break;case 10:167>=c?(m=ba(4,0,d),e=!0):175>=c&&(m=ba(5,0,d),e=!0);break;case 11:183>=
c?(m=ba(6,0,d),e=!0):191>=c&&(m=ba(7,0,d),e=!0);break;case 12:199>=c?(m=ba(0,1,d),e=!0):207>=c&&(m=ba(1,1,d),e=!0);break;case 13:215>=c?(m=ba(2,1,d),e=!0):223>=c&&(m=ba(3,1,d),e=!0);break;case 14:231>=c?(m=ba(4,1,d),e=!0):239>=c&&(m=ba(5,1,d),e=!0);break;case 15:247>=c?(m=ba(6,1,d),e=!0):255>=c&&(m=ba(7,1,d),e=!0)}switch(f){case 0:b.registerB=m;break;case 1:b.registerC=m;break;case 2:b.registerD=m;break;case 3:b.registerE=m;break;case 4:b.registerH=m;break;case 5:b.registerL=m;break;case 6:(4>h||
7<h)&&U(r(b.registerH,b.registerL),m);break;case 7:b.registerA=m}e&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===ta())return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter+2),b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter+2&65535),b.programCounter=Z(),8;case 206:return la(G()),b.programCounter=b.programCounter+1&65535,4;case 207:return b.stackPointer=
b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=8}return-1}function pc(a){switch(a){case 208:return 0===V()?(b.programCounter=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 209:return a=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerD=F(a),b.registerE=a&255,4;case 210:if(0===V())return b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===V())return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,
b.programCounter+2),b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,r(b.registerD,b.registerE)),8;case 214:return ma(G()),b.programCounter=b.programCounter+1&65535,4;case 215:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=16,8;case 216:return 1===V()?(b.programCounter=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 217:return b.programCounter=
ha(b.stackPointer),Ya(!0),b.stackPointer=b.stackPointer+2&65535,8;case 218:if(1===V())return b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===V())return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter+2&65535),b.programCounter=Z(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return na(G()),b.programCounter=b.programCounter+1&65535,4;case 223:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),
b.programCounter=24,8}return-1}function qc(a){switch(a){case 224:return a=G(),U(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:return a=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerH=F(a),b.registerL=a&255,4;case 226:return U(65280+b.registerC,b.registerA),4;case 229:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,r(b.registerH,b.registerL)),8;case 230:return oa(G()),b.programCounter=b.programCounter+1&65535,4;case 231:return b.stackPointer=
b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=32,8;case 232:return a=db(G()),wa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,l(0),u(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=r(b.registerH,b.registerL),4;case 234:return U(Z(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return pa(G()),b.programCounter=b.programCounter+1&65535,4;case 239:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,
b.programCounter),b.programCounter=40,8}return-1}function rc(a){switch(a){case 240:return a=G(),b.registerA=J(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:return a=ha(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerA=F(a),b.registerF=a&255,4;case 242:return b.registerA=J(65280+b.registerC)&255,4;case 243:return Ya(!1),4;case 245:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,r(b.registerA,b.registerF)),8;case 246:return qa(G()),b.programCounter=
b.programCounter+1&65535,4;case 247:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=48,8;case 248:return a=db(G()),l(0),u(0),wa(b.stackPointer,a,!0),a=b.stackPointer+a&65535,b.registerH=F(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=r(b.registerH,b.registerL),8;case 250:return b.registerA=J(Z()),b.programCounter=b.programCounter+2&65535,4;case 251:return Ya(!0),4;case 254:return ra(G()),b.programCounter=
b.programCounter+1&65535,4;case 255:return b.stackPointer=b.stackPointer-2&65535,W(b.stackPointer,b.programCounter),b.programCounter=56,8}return-1}function sa(a){0<d.DMACycles&&(a+=d.DMACycles,d.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(Q.graphicsBatchProcessing){if(t.currentCycles+=a,!(t.currentCycles<t.batchProcessCycles()))for(;t.currentCycles>=t.batchProcessCycles();)Rb(t.batchProcessCycles()),t.currentCycles-=t.batchProcessCycles()}else Rb(a);Q.audioBatchProcessing?f.currentCycles+=
a:Ib(a);var c=a;if(M.transferStartFlag)for(var e=0;e<c;){var w=M.currentCycles;e+=4;M.currentCycles+=4;65535<M.currentCycles&&(M.currentCycles-=65536);var m=M.currentCycles;var k=M.isClockSpeedFast?2:7;q(k,w)&&!q(k,m)&&(w=y(M.memoryLocationSerialTransferData),w=(w<<1)+1,w&=255,h(M.memoryLocationSerialTransferData,w),M.numberOfBitsTransferred+=1,8===M.numberOfBitsTransferred&&(M.numberOfBitsTransferred=0,p.isSerialInterruptRequested=!0,Ba(p.bitPositionSerialInterrupt),w=y(M.memoryLocationSerialTransferControl),
h(M.memoryLocationSerialTransferControl,H(7,w)),M.transferStartFlag=!1))}}Q.timersBatchProcessing?(n.currentCycles+=a,mb(n.currentCycles),n.currentCycles=0):mb(a);X.cycles+=a;X.cycles>=X.cyclesPerCycleSet&&(X.cycleSets+=1,X.cycles-=X.cyclesPerCycleSet)}function ub(){return vb(!0,-1)}function vb(a,c){void 0===c&&(c=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var e=!1,d=!1,m=!1;!(e||d||m||aa.reachedBreakpoint);)c=wb(),0>c?e=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?d=!0:-1<a&&kb()>=a&&(m=!0);if(d)return b.currentCycles-=
b.MAX_CYCLES_PER_FRAME(),P.RESPONSE_CONDITION_FRAME;if(m)return P.RESPONSE_CONDITION_AUDIO;if(aa.reachedBreakpoint)return aa.reachedBreakpoint=!1,P.RESPONSE_CONDITION_BREAKPOINT;b.programCounter=b.programCounter-1&65535;return-1}function wb(){Ma=!0;if(b.isHaltBug){var a=y(b.programCounter);a=Sb(a);sa(a);b.exitHaltAndStop()}p.masterInterruptSwitchDelay&&(p.masterInterruptSwitch=!0,p.masterInterruptSwitchDelay=!1);if(0<(p.interruptsEnabledValue&p.interruptsRequestedValue&31)){a=!1;p.masterInterruptSwitch&&
!b.isHaltNoJump&&(p.isVBlankInterruptEnabled&&p.isVBlankInterruptRequested?(Ia(p.bitPositionVBlankInterrupt),a=!0):p.isLcdInterruptEnabled&&p.isLcdInterruptRequested?(Ia(p.bitPositionLcdInterrupt),a=!0):p.isTimerInterruptEnabled&&p.isTimerInterruptRequested?(Ia(p.bitPositionTimerInterrupt),a=!0):p.isSerialInterruptEnabled&&p.isSerialInterruptRequested?(Ia(p.bitPositionSerialInterrupt),a=!0):p.isJoypadInterruptEnabled&&p.isJoypadInterruptRequested&&(Ia(p.bitPositionJoypadInterrupt),a=!0));var c=0;
a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;0<a&&sa(a);a=4;b.isHalted()||b.isStopped||(a=y(b.programCounter),a=Sb(a));b.registerF&=240;if(0>=a)return a;sa(a);P.steps+=1;P.steps>=P.stepsPerStepSet&&(P.stepSets+=1,P.steps-=P.stepsPerStepSet);b.programCounter===aa.programCounter&&(aa.reachedBreakpoint=!0);return a}function sc(a){const b="undefined"!==typeof window?performance.now():Date.now();for(;a.fpsTimeStamps[0]<b-1E3;)a.fpsTimeStamps.shift();
a.fpsTimeStamps.push(b);a.timeStampsUntilReady--;0>a.timeStampsUntilReady&&(a.timeStampsUntilReady=0);return b}function xb(a){a.timeStampsUntilReady=90>=a.options.gameboyFrameRate?1.25*Math.floor(a.options.gameboyFrameRate):120}function Tb(a){const b=a.wasmByteMemory.slice(a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION,a.WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION+a.WASMBOY_CURRENT_FRAME_SIZE).buffer;a.graphicsWorkerPort.postMessage(N({type:C.UPDATED,graphicsFrameBuffer:b}),[b])}function Ub(a){var b=("undefined"!==
typeof window?performance.now():Date.now())-a.fpsTimeStamps[a.fpsTimeStamps.length-1];b=Vb-b;0>b&&(b=0);a.speed&&0<a.speed&&(b/=a.speed);a.updateId=setTimeout(()=>{Wb(a)},Math.floor(b))}function Wb(a,b){if(a.paused)return!0;void 0!==b&&(Vb=b);Na=a.getFPS();$a=a.options.gameboyFrameRate+1;a.speed&&0<a.speed&&($a*=a.speed);if(Na>$a)return a.fpsTimeStamps.shift(),Ub(a),!0;sc(a);const c=!a.options.headless&&!a.pauseFpsThrottle&&a.options.isAudioEnabled;(new Promise((b)=>{let e;c?yb(a,b):(e=a.wasmInstance.exports.executeFrame(),
b(e))})).then((b)=>{if(0<=b){ca(N({type:C.UPDATED,fps:Na}));let c=!1;a.options.frameSkip&&0<a.options.frameSkip&&(a.frameSkipCounter++,a.frameSkipCounter<=a.options.frameSkip?c=!0:a.frameSkipCounter=0);c||Tb(a);const e={type:C.UPDATED};e[E.CARTRIDGE_RAM]=Cb(a).buffer;e[E.GAMEBOY_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_INTERNAL_MEMORY_LOCATION,a.WASMBOY_INTERNAL_MEMORY_LOCATION+a.WASMBOY_INTERNAL_MEMORY_SIZE).buffer;e[E.PALETTE_MEMORY]=a.wasmByteMemory.slice(a.WASMBOY_PALETTE_MEMORY_LOCATION,a.WASMBOY_PALETTE_MEMORY_LOCATION+
a.WASMBOY_PALETTE_MEMORY_SIZE).buffer;e[E.INTERNAL_STATE]=Db(a).buffer;Object.keys(e).forEach((a)=>{void 0===e[a]&&(e[a]=(new Uint8Array).buffer)});a.memoryWorkerPort.postMessage(N(e),[e[E.CARTRIDGE_RAM],e[E.GAMEBOY_MEMORY],e[E.PALETTE_MEMORY],e[E.INTERNAL_STATE]]);2===b?ca(N({type:C.BREAKPOINT})):Ub(a)}else ca(N({type:C.CRASHED})),a.paused=!0})}function yb(a,b){var c=-1;c=a.wasmInstance.exports.executeFrameAndCheckAudio(1024);1!==c&&b(c);if(1===c){c=a.wasmInstance.exports.getAudioQueueIndex();const e=
Na>=$a;.25<a.currentAudioLatencyInSeconds&&e?(Xb(a,c),setTimeout(()=>{xb(a);yb(a,b)},Math.floor(Math.floor(1E3*(a.currentAudioLatencyInSeconds-.25))/10))):(Xb(a,c),yb(a,b))}}function Xb(a,b){var c=a.wasmByteMemory.slice(a.WASMBOY_SOUND_OUTPUT_LOCATION,a.WASMBOY_SOUND_OUTPUT_LOCATION+2*b).buffer;const d={type:C.UPDATED,audioBuffer:c,numberOfSamples:b,fps:Na,allowFastSpeedStretching:60<a.options.gameboyFrameRate};c=[c];if(a.options&&a.options.enableAudioDebugging){var f=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION,
a.WASMBOY_CHANNEL_1_OUTPUT_LOCATION+2*b).buffer;d.channel1Buffer=f;c.push(f);f=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_2_OUTPUT_LOCATION+2*b).buffer;d.channel2Buffer=f;c.push(f);f=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_3_OUTPUT_LOCATION+2*b).buffer;d.channel3Buffer=f;c.push(f);b=a.wasmByteMemory.slice(a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION,a.WASMBOY_CHANNEL_4_OUTPUT_LOCATION+2*b).buffer;d.channel4Buffer=b;c.push(b)}a.audioWorkerPort.postMessage(N(d),
c);a.wasmInstance.exports.resetAudioQueue()}const Qa="undefined"!==typeof self;let cb;Qa||(cb=require("worker_threads").parentPort);const C={CONNECT:"CONNECT",INSTANTIATE_WASM:"INSTANTIATE_WASM",CLEAR_MEMORY:"CLEAR_MEMORY",CLEAR_MEMORY_DONE:"CLEAR_MEMORY_DONE",GET_MEMORY:"GET_MEMORY",SET_MEMORY:"SET_MEMORY",SET_MEMORY_DONE:"SET_MEMORY_DONE",GET_CONSTANTS:"GET_CONSTANTS",GET_CONSTANTS_DONE:"GET_CONSTANTS_DONE",CONFIG:"CONFIG",RESET_AUDIO_QUEUE:"RESET_AUDIO_QUEUE",PLAY:"PLAY",BREAKPOINT:"BREAKPOINT",
PAUSE:"PAUSE",UPDATED:"UPDATED",CRASHED:"CRASHED",SET_JOYPAD_STATE:"SET_JOYPAD_STATE",AUDIO_LATENCY:"AUDIO_LATENCY",RUN_WASM_EXPORT:"RUN_WASM_EXPORT",GET_WASM_MEMORY_SECTION:"GET_WASM_MEMORY_SECTION",GET_WASM_CONSTANT:"GET_WASM_CONSTANT",FORCE_OUTPUT_FRAME:"FORCE_OUTPUT_FRAME",SET_SPEED:"SET_SPEED",IS_GBC:"IS_GBC"},E={CARTRIDGE_RAM:"CARTRIDGE_RAM",CARTRIDGE_ROM:"CARTRIDGE_ROM",CARTRIDGE_HEADER:"CARTRIDGE_HEADER",GAMEBOY_MEMORY:"GAMEBOY_MEMORY",PALETTE_MEMORY:"PALETTE_MEMORY",INTERNAL_STATE:"INTERNAL_STATE"};
let Ra=0;const k=new Uint8ClampedArray(9109504),Oa={size:()=>9109504,grow:()=>{},wasmByteMemory:k};var Ca=91264,Pa=Ca+93184,ab=Pa+196608,bb=ab+147456,Ob=bb-67584+15360,gb=bb+15360,hb=gb+131072,ib=hb+131072,jb=ib+131072,Ha=jb+131072,Za=Ha+131072,Ka=Za+131072,zb=Ka+8258560,Ab=zb+65535+1,Bb=Math.ceil(Ab/1024/64)+1,Q=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=
!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=!1;return a}(),Ja=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;return a}(),ja=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),z=function(){function a(){}a.updateNRx0=function(b){a.NRx0SweepPeriod=(b&112)>>
4;a.NRx0Negate=q(3,b);a.NRx0SweepShift=b&7};a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=q(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=q(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};
a.saveState=function(){R(1024+50*a.saveStateSlot,a.isEnabled);k[1025+50*a.saveStateSlot]=a.frequencyTimer;k[1029+50*a.saveStateSlot]=a.envelopeCounter;k[1033+50*a.saveStateSlot]=a.lengthCounter;k[1038+50*a.saveStateSlot]=a.volume;k[1043+50*a.saveStateSlot]=a.dutyCycle;k[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;R(1049+50*a.saveStateSlot,a.isSweepEnabled);k[1050+50*a.saveStateSlot]=a.sweepCounter;k[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};a.loadState=function(){a.isEnabled=S(1024+50*
a.saveStateSlot);a.frequencyTimer=k[1025+50*a.saveStateSlot];a.envelopeCounter=k[1029+50*a.saveStateSlot];a.lengthCounter=k[1033+50*a.saveStateSlot];a.volume=k[1038+50*a.saveStateSlot];a.dutyCycle=k[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=k[1044+50*a.saveStateSlot];a.isSweepEnabled=S(1049+50*a.saveStateSlot);a.sweepCounter=k[1050+50*a.saveStateSlot];a.sweepShadowFrequency=k[1055+50*a.saveStateSlot]};a.initialize=function(){h(a.memoryLocationNRx0,128);h(a.memoryLocationNRx1,191);h(a.memoryLocationNRx2,
243);h(a.memoryLocationNRx3,193);h(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=
a.volume;else return 15;var c=1;Fb(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&0<a.NRx0SweepShift?!0:!1;0<a.NRx0SweepShift&&Gb();a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<
a.frequencyTimer-a.cycleCounter?!1:!0};a.updateSweep=function(){--a.sweepCounter;0>=a.sweepCounter&&(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&0<a.NRx0SweepPeriod&&Gb())};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&
0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=y(a.memoryLocationNRx4)&248|c;h(a.memoryLocationNRx3,b);h(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=
0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=7;return a}(),K=function(){function a(){}a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};
a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=q(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=q(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){R(1024+50*a.saveStateSlot,a.isEnabled);k[1025+50*a.saveStateSlot]=a.frequencyTimer;k[1029+50*a.saveStateSlot]=a.envelopeCounter;
k[1033+50*a.saveStateSlot]=a.lengthCounter;k[1038+50*a.saveStateSlot]=a.volume;k[1043+50*a.saveStateSlot]=a.dutyCycle;k[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.isEnabled=S(1024+50*a.saveStateSlot);a.frequencyTimer=k[1025+50*a.saveStateSlot];a.envelopeCounter=k[1029+50*a.saveStateSlot];a.lengthCounter=k[1033+50*a.saveStateSlot];a.volume=k[1038+50*a.saveStateSlot];a.dutyCycle=k[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=k[1044+50*a.saveStateSlot]};a.initialize=
function(){h(a.memoryLocationNRx1-1,255);h(a.memoryLocationNRx1,63);h(a.memoryLocationNRx2,0);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=
1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;Fb(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateLength=function(){0<
a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=y(a.memoryLocationNRx4)&248|c;h(a.memoryLocationNRx3,b);h(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;
a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=
0;a.saveStateSlot=8;return a}(),I=function(){function a(){}a.updateNRx0=function(b){a.isDacEnabled=q(7,b)};a.updateNRx1=function(b){a.NRx1LengthLoad=b;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2VolumeCode=b>>5&15};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=q(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){R(1024+50*
a.saveStateSlot,a.isEnabled);k[1025+50*a.saveStateSlot]=a.frequencyTimer;k[1029+50*a.saveStateSlot]=a.lengthCounter;k[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=S(1024+50*a.saveStateSlot);a.frequencyTimer=k[1025+50*a.saveStateSlot];a.lengthCounter=k[1029+50*a.saveStateSlot];a.waveTablePosition=k[1033+50*a.saveStateSlot]};a.initialize=function(){h(a.memoryLocationNRx0,127);h(a.memoryLocationNRx1,255);h(a.memoryLocationNRx2,159);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,
184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveTablePosition+=1,32<=a.waveTablePosition&&(a.waveTablePosition=0));b=0;var c=a.volumeCode;if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&
(c=y(a.memoryLocationNRx2),c=c>>5&15,a.volumeCode=c,a.volumeCodeChanged=!1);else return 15;var d=y(a.memoryLocationWaveTable+(a.waveTablePosition/2|0));d=0===a.waveTablePosition%2?d>>4&15:d&15;switch(c){case 0:d>>=4;break;case 1:b=1;break;case 2:d>>=1;b=2;break;default:d>>=2,b=4}return(0<b?d/b:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;
return 0<a.frequencyTimer-a.cycleCounter&&!a.volumeCodeChanged?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=
!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=9;return a}(),L=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=q(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3ClockShift=b>>4;a.NRx3WidthMode=q(3,b);a.NRx3DivisorCode=b&7;switch(a.NRx3DivisorCode){case 0:a.divisor=
8;break;case 1:a.divisor=16;break;case 2:a.divisor=32;break;case 3:a.divisor=48;break;case 4:a.divisor=64;break;case 5:a.divisor=80;break;case 6:a.divisor=96;break;case 7:a.divisor=112}};a.updateNRx4=function(b){a.NRx4LengthEnabled=q(6,b)};a.saveState=function(){R(1024+50*a.saveStateSlot,a.isEnabled);k[1025+50*a.saveStateSlot]=a.frequencyTimer;k[1029+50*a.saveStateSlot]=a.envelopeCounter;k[1033+50*a.saveStateSlot]=a.lengthCounter;k[1038+50*a.saveStateSlot]=a.volume;k[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};
a.loadState=function(){a.isEnabled=S(1024+50*a.saveStateSlot);a.frequencyTimer=k[1025+50*a.saveStateSlot];a.envelopeCounter=k[1029+50*a.saveStateSlot];a.lengthCounter=k[1033+50*a.saveStateSlot];a.volume=k[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=k[1043+50*a.saveStateSlot]};a.initialize=function(){h(a.memoryLocationNRx1-1,255);h(a.memoryLocationNRx1,255);h(a.memoryLocationNRx2,0);h(a.memoryLocationNRx3,0);h(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;
a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.frequencyTimer=a.getNoiseChannelFrequencyPeriod(),a.frequencyTimer-=b,b=a.linearFeedbackShiftRegister&1^a.linearFeedbackShiftRegister>>1&1,a.linearFeedbackShiftRegister>>=1,a.linearFeedbackShiftRegister|=b<<14,a.NRx3WidthMode&&(a.linearFeedbackShiftRegister&=-65,a.linearFeedbackShiftRegister|=b<<6));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=
q(0,a.linearFeedbackShiftRegister)?-1:1;return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.getNoiseChannelFrequencyPeriod=function(){var c=a.divisor<<a.NRx3ClockShift;b.GBCDoubleSpeed&&
(c*=2);return c};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=
!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),x=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=
!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),f=function(){function a(){}a.batchProcessCycles=function(){return b.GBCDoubleSpeed?174:87};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=q(7,b);a.NR51IsChannel3EnabledOnLeftOutput=q(6,b);a.NR51IsChannel2EnabledOnLeftOutput=
q(5,b);a.NR51IsChannel1EnabledOnLeftOutput=q(4,b);a.NR51IsChannel4EnabledOnRightOutput=q(3,b);a.NR51IsChannel3EnabledOnRightOutput=q(2,b);a.NR51IsChannel2EnabledOnRightOutput=q(1,b);a.NR51IsChannel1EnabledOnRightOutput=q(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=q(7,b)};a.maxFrameSequenceCycles=function(){return b.GBCDoubleSpeed?16384:8192};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){k[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;k[1028+50*a.saveStateSlot]=
a.downSampleCycleCounter;k[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=k[1024+50*a.saveStateSlot];a.downSampleCycleCounter=k[1028+50*a.saveStateSlot];a.frameSequencer=k[1029+50*a.saveStateSlot];lb()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=
!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),p=function(){function a(){}a.updateInterruptEnabled=
function(b){a.isVBlankInterruptEnabled=q(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=q(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=q(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=q(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=q(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=q(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=q(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=
q(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=q(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=q(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){R(1024+50*a.saveStateSlot,a.masterInterruptSwitch);R(1025+50*a.saveStateSlot,a.masterInterruptSwitchDelay)};a.loadState=function(){a.masterInterruptSwitch=S(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=
S(1025+50*a.saveStateSlot);a.updateInterruptEnabled(y(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(y(a.memoryLocationInterruptRequest))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=
!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),n=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(b){b=a.dividerRegister;a.dividerRegister=0;h(a.memoryLocationDividerRegister,0);
a.timerEnabled&&Kb(b,a.dividerRegister)&&nb()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=a.timerModulo,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=q(2,b);b&=3;if(!c){c=ob(a.timerInputClock);var d=ob(b);(a.timerEnabled?q(c,
a.dividerRegister):q(c,a.dividerRegister)&&q(d,a.dividerRegister))&&nb()}a.timerInputClock=b};a.saveState=function(){k[1024+50*a.saveStateSlot]=a.currentCycles;k[1028+50*a.saveStateSlot]=a.dividerRegister;R(1032+50*a.saveStateSlot,a.timerCounterOverflowDelay);R(1035+50*a.saveStateSlot,a.timerCounterWasReset);h(a.memoryLocationTimerCounter,a.timerCounter)};a.loadState=function(){a.currentCycles=k[1024+50*a.saveStateSlot];a.dividerRegister=k[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=S(1032+
50*a.saveStateSlot);a.timerCounterWasReset=S(1035+50*a.saveStateSlot);a.timerCounter=y(a.memoryLocationTimerCounter);a.timerModulo=y(a.memoryLocationTimerModulo);a.timerInputClock=y(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;
a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),M=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=q(0,b);a.isClockSpeedFast=q(1,b);a.transferStartFlag=q(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=65282;a.numberOfBitsTransferred=0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}(),A=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=
b^255;a.isDpadType=q(4,a.joypadRegisterFlipped);a.isButtonType=q(5,a.joypadRegisterFlipped)};a.saveState=function(){};a.loadState=function(){a.updateJoypad(y(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),aa=function(){function a(){}a.programCounter=-1;a.readGbMemory=-1;a.writeGbMemory=-1;a.reachedBreakpoint=!1;
return a}(),B=function(){function a(){}a.updateLcdStatus=function(b){var c=y(a.memoryLocationLcdStatus);b=b&248|c&7|128;h(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=q(7,b);a.windowTileMapDisplaySelect=q(6,b);a.windowDisplayEnabled=q(5,b);a.bgWindowTileDataSelect=q(4,b);a.bgTileMapDisplaySelect=q(3,b);a.tallSpriteSize=q(2,b);a.spriteDisplayEnable=q(1,b);a.bgDisplayEnabled=q(0,b);c&&!a.enabled&&Nb(!0);!c&&a.enabled&&Nb(!1)};a.memoryLocationLcdStatus=65345;
a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),t=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return b.GBCDoubleSpeed?153===a.scanlineRegister?
8:912:153===a.scanlineRegister?4:456};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return b.GBCDoubleSpeed?752:376};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return b.GBCDoubleSpeed?498:249};a.saveState=function(){k[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;k[1028+50*a.saveStateSlot]=B.currentLcdMode;h(a.memoryLocationScanlineRegister,a.scanlineRegister)};a.loadState=function(){a.scanlineCycleCounter=k[1024+50*a.saveStateSlot];B.currentLcdMode=k[1028+50*a.saveStateSlot];a.scanlineRegister=
y(a.memoryLocationScanlineRegister);B.updateLcdControl(y(B.memoryLocationLcdControl))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=
34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),d=function(){function a(){}a.saveState=function(){k[1024+50*a.saveStateSlot]=a.currentRomBank;k[1026+50*a.saveStateSlot]=a.currentRamBank;R(1028+50*a.saveStateSlot,a.isRamBankingEnabled);R(1029+50*a.saveStateSlot,a.isMBC1RomModeEnabled);R(1030+50*a.saveStateSlot,
a.isRomOnly);R(1031+50*a.saveStateSlot,a.isMBC1);R(1032+50*a.saveStateSlot,a.isMBC2);R(1033+50*a.saveStateSlot,a.isMBC3);R(1034+50*a.saveStateSlot,a.isMBC5)};a.loadState=function(){a.currentRomBank=k[1024+50*a.saveStateSlot];a.currentRamBank=k[1026+50*a.saveStateSlot];a.isRamBankingEnabled=S(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=S(1029+50*a.saveStateSlot);a.isRomOnly=S(1030+50*a.saveStateSlot);a.isMBC1=S(1031+50*a.saveStateSlot);a.isMBC2=S(1032+50*a.saveStateSlot);a.isMBC3=S(1033+50*a.saveStateSlot);
a.isMBC5=S(1034+50*a.saveStateSlot)};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=
!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return a.GBCDoubleSpeed?
8388608:4194304};a.MAX_CYCLES_PER_FRAME=function(){return a.GBCDoubleSpeed?140448:70224};a.enableHalt=function(){p.masterInterruptSwitch?a.isHaltNormal=!0:0===(p.interruptsEnabledValue&p.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump?!0:!1};a.saveState=function(){k[1024+50*a.saveStateSlot]=a.registerA;k[1025+50*a.saveStateSlot]=
a.registerB;k[1026+50*a.saveStateSlot]=a.registerC;k[1027+50*a.saveStateSlot]=a.registerD;k[1028+50*a.saveStateSlot]=a.registerE;k[1029+50*a.saveStateSlot]=a.registerH;k[1030+50*a.saveStateSlot]=a.registerL;k[1031+50*a.saveStateSlot]=a.registerF;k[1032+50*a.saveStateSlot]=a.stackPointer;k[1034+50*a.saveStateSlot]=a.programCounter;k[1036+50*a.saveStateSlot]=a.currentCycles;R(1041+50*a.saveStateSlot,a.isHaltNormal);R(1042+50*a.saveStateSlot,a.isHaltNoJump);R(1043+50*a.saveStateSlot,a.isHaltBug);R(1044+
50*a.saveStateSlot,a.isStopped)};a.loadState=function(){a.registerA=k[1024+50*a.saveStateSlot];a.registerB=k[1025+50*a.saveStateSlot];a.registerC=k[1026+50*a.saveStateSlot];a.registerD=k[1027+50*a.saveStateSlot];a.registerE=k[1028+50*a.saveStateSlot];a.registerH=k[1029+50*a.saveStateSlot];a.registerL=k[1030+50*a.saveStateSlot];a.registerF=k[1031+50*a.saveStateSlot];a.stackPointer=k[1032+50*a.saveStateSlot];a.programCounter=k[1034+50*a.saveStateSlot];a.currentCycles=k[1036+50*a.saveStateSlot];a.isHaltNormal=
S(1041+50*a.saveStateSlot);a.isHaltNoJump=S(1042+50*a.saveStateSlot);a.isHaltBug=S(1043+50*a.saveStateSlot);a.isStopped=S(1044+50*a.saveStateSlot)};a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),X=function(){function a(){}
a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}(),P=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();Oa.size()<Bb&&Oa.grow(Bb-Oa.size());var Ma=!1,tc=Object.freeze({memory:Oa,config:function(a,c,e,k,m,g,q,l,r,u){Q.enableBootRom=0<a?!0:!1;Q.useGbcWhenAvailable=0<c?!0:!1;Q.audioBatchProcessing=0<e?!0:!1;Q.graphicsBatchProcessing=0<k?!0:
!1;Q.timersBatchProcessing=0<m?!0:!1;Q.graphicsDisableScanlineRendering=0<g?!0:!1;Q.audioAccumulateSamples=0<q?!0:!1;Q.tileRendering=0<l?!0:!1;Q.tileCaching=0<r?!0:!1;Q.enableAudioDebugging=0<u?!0:!1;a=y(323);b.GBCEnabled=192===a||Q.useGbcWhenAvailable&&128===a?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=!1;b.isHaltNoJump=!1;b.isHaltBug=
!1;b.isStopped=!1;b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77);b.programCounter=256;b.stackPointer=65534;d.isRamBankingEnabled=!1;d.isMBC1RomModeEnabled=!0;a=y(327);d.isRomOnly=!1;d.isMBC1=!1;d.isMBC2=!1;d.isMBC3=!1;d.isMBC5=!1;0===a?d.isRomOnly=!0:1<=a&&3>=a?d.isMBC1=!0:5<=a&&6>=a?d.isMBC2=
!0:15<=a&&19>=a?d.isMBC3=!0:25<=a&&30>=a&&(d.isMBC5=!0);d.currentRomBank=1;d.currentRamBank=0;h(65361,255);h(65362,255);h(65363,255);h(65364,255);h(65365,255);t.currentCycles=0;t.scanlineCycleCounter=0;t.scanlineRegister=0;t.scrollX=0;t.scrollY=0;t.windowX=0;t.windowY=0;b.GBCEnabled?(t.scanlineRegister=144,h(65344,145),h(65345,129),h(65348,144),h(65351,252)):(t.scanlineRegister=144,h(65344,145),h(65345,133),h(65350,255),h(65351,252),h(65352,255),h(65353,255));h(65359,0);h(65392,1);b.GBCEnabled?(h(65384,
192),h(65385,255),h(65386,193),h(65387,13)):(h(65384,255),h(65385,255),h(65386,255),h(65387,255));f.currentCycles=0;f.NR50LeftMixerVolume=0;f.NR50RightMixerVolume=0;f.NR51IsChannel1EnabledOnLeftOutput=!0;f.NR51IsChannel2EnabledOnLeftOutput=!0;f.NR51IsChannel3EnabledOnLeftOutput=!0;f.NR51IsChannel4EnabledOnLeftOutput=!0;f.NR51IsChannel1EnabledOnRightOutput=!0;f.NR51IsChannel2EnabledOnRightOutput=!0;f.NR51IsChannel3EnabledOnRightOutput=!0;f.NR51IsChannel4EnabledOnRightOutput=!0;f.NR52IsSoundEnabled=
!0;f.frameSequenceCycleCounter=0;f.downSampleCycleCounter=0;f.frameSequencer=0;f.audioQueueIndex=0;z.initialize();K.initialize();I.initialize();L.initialize();h(f.memoryLocationNR50,119);h(f.memoryLocationNR51,243);h(f.memoryLocationNR52,241);x.channel1Sample=15;x.channel2Sample=15;x.channel3Sample=15;x.channel4Sample=15;x.channel1DacEnabled=!1;x.channel2DacEnabled=!1;x.channel3DacEnabled=!1;x.channel4DacEnabled=!1;x.leftChannelSampleUnsignedByte=127;x.rightChannelSampleUnsignedByte=127;x.mixerVolumeChanged=
!0;x.mixerEnabledChanged=!0;x.needToRemixSamples=!1;p.updateInterruptEnabled(0);h(p.memoryLocationInterruptEnabled,p.interruptsEnabledValue);p.updateInterruptRequested(225);h(p.memoryLocationInterruptRequest,p.interruptsRequestedValue);n.currentCycles=0;n.dividerRegister=0;n.timerCounter=0;n.timerModulo=0;n.timerEnabled=!1;n.timerInputClock=0;n.timerCounterOverflowDelay=!1;n.timerCounterWasReset=!1;b.GBCEnabled?(h(65284,30),n.dividerRegister=7840):(h(65284,171),n.dividerRegister=43980);h(65287,248);
n.timerInputClock=248;M.currentCycles=0;M.numberOfBitsTransferred=0;b.GBCEnabled?(h(65282,124),M.updateTransferControl(124)):(h(65282,126),M.updateTransferControl(126));b.GBCEnabled?(h(65392,248),h(65359,254),h(65357,126),h(65280,207),h(65295,225),h(65388,254),h(65397,143)):(h(65392,255),h(65359,255),h(65357,255),h(65280,207),h(65295,225));Ma=!1;X.cyclesPerCycleSet=2E9;X.cycleSets=0;X.cycles=0;P.stepsPerStepSet=2E9;P.stepSets=0;P.steps=0},hasCoreStarted:function(){return Ma?1:0},saveState:function(){b.saveState();
t.saveState();p.saveState();A.saveState();d.saveState();n.saveState();f.saveState();z.saveState();K.saveState();I.saveState();L.saveState();Ma=!1},loadState:function(){b.loadState();t.loadState();p.loadState();A.loadState();d.loadState();n.loadState();f.loadState();z.loadState();K.loadState();I.loadState();L.loadState();Ma=!1;X.cyclesPerCycleSet=2E9;X.cycleSets=0;X.cycles=0;P.stepsPerStepSet=2E9;P.stepSets=0;P.steps=0},isGBC:function(){return b.GBCEnabled?1:0},getStepsPerStepSet:function(){return P.stepsPerStepSet},
getStepSets:function(){return P.stepSets},getSteps:function(){return P.steps},executeMultipleFrames:function(a){for(var b=0,d=0;d<a&&0<=b;)b=ub(),d+=1;return 0>b?b:0},executeFrame:ub,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return vb(!0,a)},executeUntilCondition:vb,executeStep:wb,getCyclesPerCycleSet:function(){return X.cyclesPerCycleSet},getCycleSets:function(){return X.cycleSets},getCycles:function(){return X.cycles},setJoypadState:function(a,b,d,f,m,k,h,g){0<a?ua(0):ia(0,!1);0<b?
ua(1):ia(1,!1);0<d?ua(2):ia(2,!1);0<f?ua(3):ia(3,!1);0<m?ua(4):ia(4,!1);0<k?ua(5):ia(5,!1);0<h?ua(6):ia(6,!1);0<g?ua(7):ia(7,!1)},getNumberOfSamplesInAudioBuffer:kb,clearAudioBuffer:lb,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:Ab,WASMBOY_WASM_PAGES:Bb,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,GAMEBOY_INTERNAL_MEMORY_SIZE:65536,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,
WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:67584,GRAPHICS_OUTPUT_SIZE:Ob,GBC_PALETTE_LOCATION:67584,GBC_PALETTE_SIZE:128,BG_PRIORITY_MAP_LOCATION:67712,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:Ca,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:Pa,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:ab,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:bb,OAM_TILES_SIZE:15360,AUDIO_BUFFER_LOCATION:Ha,AUDIO_BUFFER_SIZE:131072,CHANNEL_1_BUFFER_LOCATION:gb,
CHANNEL_1_BUFFER_SIZE:131072,CHANNEL_2_BUFFER_LOCATION:hb,CHANNEL_2_BUFFER_SIZE:131072,CHANNEL_3_BUFFER_LOCATION:ib,CHANNEL_3_BUFFER_SIZE:131072,CHANNEL_4_BUFFER_LOCATION:jb,CHANNEL_4_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:Za,CARTRIDGE_RAM_SIZE:131072,CARTRIDGE_ROM_LOCATION:Ka,CARTRIDGE_ROM_SIZE:8258560,DEBUG_GAMEBOY_MEMORY_LOCATION:zb,DEBUG_GAMEBOY_MEMORY_SIZE:65535,getWasmBoyOffsetFromGameBoyOffset:rb,setProgramCounterBreakpoint:function(a){aa.programCounter=a},resetProgramCounterBreakpoint:function(){aa.programCounter=
-1},setReadGbMemoryBreakpoint:function(a){aa.readGbMemory=a},resetReadGbMemoryBreakpoint:function(){aa.readGbMemory=-1},setWriteGbMemoryBreakpoint:function(a){aa.writeGbMemory=a},resetWriteGbMemoryBreakpoint:function(){aa.writeGbMemory=-1},getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},
getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return y(b.programCounter)},getLY:function(){return t.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){var c=t.memoryLocationTileDataSelectZeroStart;B.bgWindowTileDataSelect&&(c=t.memoryLocationTileDataSelectOneStart);var d=t.memoryLocationTileMapSelectZeroStart;
B.bgTileMapDisplaySelect&&(d=t.memoryLocationTileMapSelectOneStart);for(var f=0;256>f;f++)for(var m=0;256>m;m++){var h=f,g=m,l=d+32*(h>>3)+(g>>3),n=Y(l,0);n=Ga(c,n);var p=h%8;h=g%8;h=7-h;g=0;b.GBCEnabled&&0<a&&(g=Y(l,1));q(6,g)&&(p=7-p);var r=0;q(3,g)&&(r=1);l=Y(n+2*p,r);n=Y(n+2*p+1,r);p=0;q(h,n)&&(p+=1,p<<=1);q(h,l)&&(p+=1);n=3*(256*f+m);if(b.GBCEnabled&&0<a)g=Ua(g&7,p,!1),h=fa(0,g),l=fa(1,g),p=fa(2,g),g=Pa+n,k[g]=h,k[g+1]=l,k[g+2]=p;else for(h=Ta(p,t.memoryLocationBackgroundPalette),l=0;3>l;l++)g=
Pa+n+l,k[g]=h}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var c=0;31>c;c++){var d=0;15<c&&(d=1);var f=a;15<a&&(f-=15);f<<=4;f=15<c?f+(c-15):f+c;var h=t.memoryLocationTileDataSelectOneStart;15<a&&(h=t.memoryLocationTileDataSelectZeroStart);for(var g=t.memoryLocationBackgroundPalette,k=-1,l=-1,n=0;8>n;n++)for(var p=0;5>p;p++){var r=4*(8*p+n),u=y(t.memoryLocationSpriteAttributesTable+r+2);f===u&&(r=y(t.memoryLocationSpriteAttributesTable+r+3),u=0,b.GBCEnabled&&q(3,r)&&(u=1),u===d&&
(l=r,n=8,p=5,g=t.memoryLocationSpritePaletteOne,q(4,l)&&(g=t.memoryLocationSpritePaletteTwo)))}if(b.GBCEnabled&&0>l){n=t.memoryLocationTileMapSelectZeroStart;B.bgTileMapDisplaySelect&&(n=t.memoryLocationTileMapSelectOneStart);p=-1;for(r=0;32>r;r++)for(u=0;32>u;u++){var v=n+32*u+r,x=Y(v,0);f===x&&(p=v,u=r=32)}0<=p&&(k=Y(p,1))}for(n=0;8>n;n++)fb(f,h,d,0,7,n,8*c,8*a+n,248,ab,!1,g,k,l)}},drawOamToWasmMemory:function(){for(var a=0;8>a;a++)for(var c=0;5>c;c++){var d=4*(8*c+a);y(t.memoryLocationSpriteAttributesTable+
d);y(t.memoryLocationSpriteAttributesTable+d+1);var f=y(t.memoryLocationSpriteAttributesTable+d+2),g=1;B.tallSpriteSize&&(1===f%2&&--f,g+=1);d=y(t.memoryLocationSpriteAttributesTable+d+3);var h=0;b.GBCEnabled&&q(3,d)&&(h=1);var k=t.memoryLocationSpritePaletteOne;q(4,d)&&(k=t.memoryLocationSpritePaletteTwo);for(var l=0;l<g;l++)for(var n=0;8>n;n++)fb(f+l,t.memoryLocationTileDataSelectOneStart,h,0,7,n,8*a,16*c+n+8*l,64,bb,!1,k,-1,d)}},getDIV:function(){return n.dividerRegister},getTIMA:function(){return n.timerCounter},
getTMA:function(){return n.timerModulo},getTAC:function(){var a=n.timerInputClock;n.timerEnabled&&(a|=4);return a},updateDebugGBMemory:function(){for(var a=0;65535>a;a++){var b=pb(a);k[zb+a]=b}aa.reachedBreakpoint=!1},update:ub,emulationStep:wb,getAudioQueueIndex:kb,resetAudioQueue:lb,wasmMemorySize:Ab,wasmBoyInternalStateLocation:1024,wasmBoyInternalStateSize:1024,gameBoyInternalMemoryLocation:2048,gameBoyInternalMemorySize:65536,videoOutputLocation:67584,frameInProgressVideoOutputLocation:Ca,gameboyColorPaletteLocation:67584,
gameboyColorPaletteSize:128,backgroundMapLocation:Pa,tileDataMap:ab,soundOutputLocation:Ha,gameBytesLocation:Ka,gameRamBanksLocation:Za});const uc=async()=>({instance:{exports:tc},byteMemory:Oa.wasmByteMemory,type:"TypeScript"});let Na,$a,Vb,g;g={graphicsWorkerPort:void 0,memoryWorkerPort:void 0,controllerWorkerPort:void 0,audioWorkerPort:void 0,wasmInstance:void 0,wasmByteMemory:void 0,options:void 0,WASMBOY_GAME_BYTES_LOCATION:0,WASMBOY_GAME_RAM_BANKS_LOCATION:0,WASMBOY_INTERNAL_STATE_SIZE:0,WASMBOY_INTERNAL_STATE_LOCATION:0,
WASMBOY_INTERNAL_MEMORY_SIZE:0,WASMBOY_INTERNAL_MEMORY_LOCATION:0,WASMBOY_PALETTE_MEMORY_SIZE:0,WASMBOY_PALETTE_MEMORY_LOCATION:0,WASMBOY_CURRENT_FRAME_OUTPUT_LOCATION:0,WASMBOY_CURRENT_FRAME_SIZE:0,WASMBOY_SOUND_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_1_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_2_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_3_OUTPUT_LOCATION:0,WASMBOY_CHANNEL_4_OUTPUT_LOCATION:0,paused:!0,updateId:void 0,timeStampsUntilReady:0,fpsTimeStamps:[],speed:0,frameSkipCounter:0,currentAudioLatencyInSeconds:0,messageHandler:(a)=>
{const b=Da(a);switch(b.message.type){case C.CONNECT:"GRAPHICS"===b.message.workerId?(g.graphicsWorkerPort=b.message.ports[0],Ea(Yb.bind(void 0,g),g.graphicsWorkerPort)):"MEMORY"===b.message.workerId?(g.memoryWorkerPort=b.message.ports[0],Ea(ac.bind(void 0,g),g.memoryWorkerPort)):"CONTROLLER"===b.message.workerId?(g.controllerWorkerPort=b.message.ports[0],Ea($b.bind(void 0,g),g.controllerWorkerPort)):"AUDIO"===b.message.workerId&&(g.audioWorkerPort=b.message.ports[0],Ea(Zb.bind(void 0,g),g.audioWorkerPort));
ca(N(void 0,b.messageId));break;case C.INSTANTIATE_WASM:(async()=>{let a;a=await uc();g.wasmInstance=a.instance;g.wasmByteMemory=a.byteMemory;ca(N({type:a.type},b.messageId))})();break;case C.CONFIG:g.wasmInstance.exports.config.apply(g,b.message.config);g.options=b.message.options;ca(N(void 0,b.messageId));break;case C.RESET_AUDIO_QUEUE:g.wasmInstance.exports.resetAudioQueue();ca(N(void 0,b.messageId));break;case C.PLAY:if(!g.paused||!g.wasmInstance||!g.wasmByteMemory){ca(N({error:!0},b.messageId));
break}g.paused=!1;g.fpsTimeStamps=[];xb(g);g.frameSkipCounter=0;g.currentAudioLatencyInSeconds=0;Wb(g,1E3/g.options.gameboyFrameRate);ca(N(void 0,b.messageId));break;case C.PAUSE:g.paused=!0;g.updateId&&(clearTimeout(g.updateId),g.updateId=void 0);ca(N(void 0,b.messageId));break;case C.RUN_WASM_EXPORT:a=b.message.parameters?g.wasmInstance.exports[b.message.export].apply(void 0,b.message.parameters):g.wasmInstance.exports[b.message.export]();ca(N({type:C.RUN_WASM_EXPORT,response:a},b.messageId));break;
case C.GET_WASM_MEMORY_SECTION:{a=0;let c=g.wasmByteMemory.length;b.message.start&&(a=b.message.start);b.message.end&&(c=b.message.end);a=g.wasmByteMemory.slice(a,c).buffer;ca(N({type:C.RUN_WASM_EXPORT,response:a},b.messageId),[a]);break}case C.GET_WASM_CONSTANT:ca(N({type:C.GET_WASM_CONSTANT,response:g.wasmInstance.exports[b.message.constant].valueOf()},b.messageId));break;case C.FORCE_OUTPUT_FRAME:Tb(g);break;case C.SET_SPEED:g.speed=b.message.speed;g.fpsTimeStamps=[];g.timeStampsUntilReady=60;
xb(g);g.frameSkipCounter=0;g.currentAudioLatencyInSeconds=0;g.wasmInstance.exports.resetAudioQueue();break;case C.IS_GBC:a=0<g.wasmInstance.exports.isGBC();ca(N({type:C.IS_GBC,response:a},b.messageId));break;default:console.log("Unknown WasmBoy Worker message:",b)}},getFPS:()=>0<g.timeStampsUntilReady?g.speed&&0<g.speed?g.options.gameboyFrameRate*g.speed:g.options.gameboyFrameRate:g.fpsTimeStamps?g.fpsTimeStamps.length:0};Ea(g.messageHandler)})();
