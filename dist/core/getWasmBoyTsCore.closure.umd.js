'use strict';(function(m,z){"object"===typeof exports&&"undefined"!==typeof module?module.exports=z():"function"===typeof define&&define.amd?define(z):m.WasmBoyTsCore=z()})(this,function(){function m(a,b){return(a&255)<<8|b&255}function z(a){return(a&65280)>>8}function G(a,b){return b&~(1<<a)}function n(a,b){return 0!=(b&1<<a)}function Ia(a){var b=a;n(7,b)&&(b=-1*(256-a));return b}function ya(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function l(a){ya(7,a)}
function q(a){ya(6,a)}function B(a){ya(5,a)}function t(a){ya(4,a)}function la(){return b.registerF>>7&1}function O(){return b.registerF>>4&1}function M(a,b){0<=b?0!==((a&15)+(b&15)&16)?B(1):B(0):(Math.abs(b)&15)>(a&15)?B(1):B(0)}function Ja(a,b){0<=b?a>(a+b&255)?t(1):t(0):Math.abs(b)>a?t(1):t(0)}function pa(a,b,f){f?(a=a^b^a+b,0!==(a&16)?B(1):B(0),0!==(a&256)?t(1):t(0)):(f=a+b&65535,f<a?t(1):t(0),0!==((a^b^f)&4096)?B(1):B(0))}function za(a,b,f){void 0===f&&(f=!1);var c=a;f||(c=x(b)>>2*a&3);a=242;
switch(c){case 1:a=160;break;case 2:a=88;break;case 3:a=8}return a}function Aa(a,b,f){b=8*a+2*b;a=Ua(b+1,f);f=Ua(b,f);return m(a,f)}function X(a,b){return 8*((b&31<<5*a)>>5*a)}function Ua(a,b){a&=63;b&&(a+=64);return h[67584+a]}function Ba(a,b,f,w){void 0===f&&(f=0);void 0===w&&(w=!1);f&=3;w&&(f|=4);h[69632+(160*b+a)]=f}function Va(a,b,f,w,d,g,e,l,m,p,k,ra,ma){void 0===k&&(k=!1);void 0===ra&&(ra=0);void 0===ma&&(ma=-1);var c=0;b=sa(b,a);a=V(b+2*g,f);f=V(b+2*g+1,f);for(g=w;g<=d;g++)if(b=e+(g-w),b<
m){var J=g;if(0>ma||!n(5,ma))J=7-J;var C=0;n(J,f)&&(C+=1,C<<=1);n(J,a)&&(C+=1);if(0<=ma){var qa=Aa(ma&7,C,!1);J=X(0,qa);var q=X(1,qa);qa=X(2,qa)}else 0>=ra&&(ra=r.memoryLocationBackgroundPalette),q=J=qa=za(C,ra,k);var x=3*(l*m+b);h[p+x]=J;h[p+x+1]=q;h[p+x+2]=qa;J=!1;0<=ma&&(J=n(7,ma));Ba(b,l,C,J);c++}return c}function sa(a,b){if(a===r.memoryLocationTileDataSelectZeroStart){var c=b+128;n(7,b)&&(c=b-128);return a+16*c}return a+16*b}function Wa(a,b){switch(a){case 1:return n(b,129);case 2:return n(b,
135);case 3:return n(b,126);default:return n(b,1)}}function Xa(){var a=Ya();2047>=a&&0<u.NRx0SweepShift&&(u.sweepShadowFrequency=a,u.setFrequency(a),a=Ya());2047<a&&(u.isEnabled=!1)}function Ya(){var a=u.sweepShadowFrequency;a>>=u.NRx0SweepShift;return a=u.NRx0Negate?u.sweepShadowFrequency-a:u.sweepShadowFrequency+a}function Ca(a){switch(a){case u.channelNumber:if(v.channel1DacEnabled!==u.isDacEnabled)return v.channel1DacEnabled=u.isDacEnabled,!0;break;case H.channelNumber:if(v.channel2DacEnabled!==
H.isDacEnabled)return v.channel2DacEnabled=H.isDacEnabled,!0;break;case E.channelNumber:if(v.channel3DacEnabled!==E.isDacEnabled)return v.channel3DacEnabled=E.isDacEnabled,!0;break;case I.channelNumber:if(v.channel4DacEnabled!==I.isDacEnabled)return v.channel4DacEnabled=I.isDacEnabled,!0}return!1}function Da(){if(!(e.currentCycles<e.batchProcessCycles()))for(;e.currentCycles>=e.batchProcessCycles();)Za(e.batchProcessCycles()),e.currentCycles-=e.batchProcessCycles()}function Za(a){e.frameSequenceCycleCounter+=
a;if(e.frameSequenceCycleCounter>=e.maxFrameSequenceCycles()){e.frameSequenceCycleCounter-=e.maxFrameSequenceCycles();switch(e.frameSequencer){case 0:u.updateLength();H.updateLength();E.updateLength();I.updateLength();break;case 2:u.updateLength();H.updateLength();E.updateLength();I.updateLength();u.updateSweep();break;case 4:u.updateLength();H.updateLength();E.updateLength();I.updateLength();break;case 6:u.updateLength();H.updateLength();E.updateLength();I.updateLength();u.updateSweep();break;case 7:u.updateEnvelope(),
H.updateEnvelope(),I.updateEnvelope()}e.frameSequencer+=1;8<=e.frameSequencer&&(e.frameSequencer=0);var b=!0}else b=!1;if(P.audioAccumulateSamples&&!b){b=u.willChannelUpdate(a)||Ca(u.channelNumber);var f=H.willChannelUpdate(a)||Ca(H.channelNumber),w=E.willChannelUpdate(a)||Ca(E.channelNumber),J=I.willChannelUpdate(a)||Ca(I.channelNumber);b&&(v.channel1Sample=u.getSampleFromCycleCounter());f&&(v.channel2Sample=H.getSampleFromCycleCounter());w&&(v.channel3Sample=E.getSampleFromCycleCounter());J&&(v.channel4Sample=
I.getSampleFromCycleCounter());if(b||f||w||J)v.needToRemixSamples=!0;e.downSampleCycleCounter+=a*e.downSampleCycleMultiplier;e.downSampleCycleCounter>=e.maxDownSampleCycles()&&(e.downSampleCycleCounter-=e.maxDownSampleCycles(),(v.needToRemixSamples||v.mixerVolumeChanged||v.mixerEnabledChanged)&&$a(v.channel1Sample,v.channel2Sample,v.channel3Sample,v.channel4Sample),a=v.rightChannelSampleUnsignedByte+1,b=588800+2*e.audioQueueIndex,h[b]=v.leftChannelSampleUnsignedByte+1+1,h[b+1]=a+1,e.audioQueueIndex+=
1,e.audioQueueIndex>=(e.wasmBoyMemoryMaxBufferSize/2|0)-1&&--e.audioQueueIndex)}else b=u.getSample(a)|0,f=H.getSample(a)|0,w=E.getSample(a)|0,J=I.getSample(a)|0,v.channel1Sample=b,v.channel2Sample=f,v.channel3Sample=w,v.channel4Sample=J,e.downSampleCycleCounter+=a*e.downSampleCycleMultiplier,e.downSampleCycleCounter>=e.maxDownSampleCycles()&&(e.downSampleCycleCounter-=e.maxDownSampleCycles(),a=$a(b,f,w,J),b=z(a),f=588800+2*e.audioQueueIndex,h[f]=b+1+1,h[f+1]=(a&255)+2,e.audioQueueIndex+=1,e.audioQueueIndex>=
(e.wasmBoyMemoryMaxBufferSize/2|0)-1&&--e.audioQueueIndex)}function Ka(){return e.audioQueueIndex}function La(){e.audioQueueIndex=0}function $a(a,b,f,w){void 0===a&&(a=15);void 0===b&&(b=15);void 0===f&&(f=15);void 0===w&&(w=15);v.mixerVolumeChanged=!1;var c=0,d=0;c=e.NR51IsChannel1EnabledOnLeftOutput?c+a:c+15;c=e.NR51IsChannel2EnabledOnLeftOutput?c+b:c+15;c=e.NR51IsChannel3EnabledOnLeftOutput?c+f:c+15;c=e.NR51IsChannel4EnabledOnLeftOutput?c+w:c+15;d=e.NR51IsChannel1EnabledOnRightOutput?d+a:d+15;
d=e.NR51IsChannel2EnabledOnRightOutput?d+b:d+15;d=e.NR51IsChannel3EnabledOnRightOutput?d+f:d+15;d=e.NR51IsChannel4EnabledOnRightOutput?d+w:d+15;v.mixerEnabledChanged=!1;v.needToRemixSamples=!1;a=ab(c,e.NR50LeftMixerVolume+1);d=ab(d,e.NR50RightMixerVolume+1);v.leftChannelSampleUnsignedByte=a;v.rightChannelSampleUnsignedByte=d;return m(a,d)}function ab(a,b){if(60===a)return 127;a=1E5*(a-60)*b/8|0;a=a/1E5|0;a+=60;a=1E5*a/(12E6/254|0)|0;return a|=0}function Ea(a){Fa(!1);var c=x(p.memoryLocationInterruptRequest);
c=G(a,c);p.interruptsRequestedValue=c;g(p.memoryLocationInterruptRequest,c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var f=b.programCounter,w=z(f),d=c+1;g(c,f&255);g(d,w);switch(a){case p.bitPositionVBlankInterrupt:p.isVBlankInterruptRequested=!1;b.programCounter=64;break;case p.bitPositionLcdInterrupt:p.isLcdInterruptRequested=!1;b.programCounter=72;break;case p.bitPositionTimerInterrupt:p.isTimerInterruptRequested=!1;b.programCounter=80;break;case p.bitPositionJoypadInterrupt:p.isJoypadInterruptRequested=
!1,b.programCounter=96}}function ta(a){var b=x(p.memoryLocationInterruptRequest);b|=1<<a;p.interruptsRequestedValue=b;g(p.memoryLocationInterruptRequest,b)}function Fa(a){a?p.masterInterruptSwitchDelay=!0:p.masterInterruptSwitch=!1}function Ma(a){for(var b=0;b<a;){var f=k.dividerRegister;b+=4;k.dividerRegister+=4;65535<k.dividerRegister&&(k.dividerRegister-=65536);k.timerEnabled&&(k.timerCounterOverflowDelay?(k.timerCounter=k.timerModulo,p.isTimerInterruptRequested=!0,ta(p.bitPositionTimerInterrupt),
k.timerCounterOverflowDelay=!1,k.timerCounterWasReset=!0):k.timerCounterWasReset&&(k.timerCounterWasReset=!1),bb(f,k.dividerRegister)&&Na())}}function Na(){k.timerCounter+=1;255<k.timerCounter&&(k.timerCounterOverflowDelay=!0,k.timerCounter=0)}function bb(a,b){var c=Oa(k.timerInputClock);return n(c,a)&&!n(c,b)?!0:!1}function Oa(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function na(a){var c=b.isStopped=!1;hb(a)||(c=!0);Z(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,
y.isDpadType&&c&&(a=!0),y.isButtonType&&!c&&(a=!0),a&&(p.isJoypadInterruptRequested=!0,ta(p.bitPositionJoypadInterrupt)))}function hb(a){switch(a){case 0:return y.up;case 1:return y.right;case 2:return y.down;case 3:return y.left;case 4:return y.a;case 5:return y.b;case 6:return y.select;case 7:return y.start;default:return!1}}function Z(a,b){switch(a){case 0:y.up=b;break;case 1:y.right=b;break;case 2:y.down=b;break;case 3:y.left=b;break;case 4:y.a=b;break;case 5:y.b=b;break;case 6:y.select=b;break;
case 7:y.start=b}}function cb(a,c,f){for(var w=0;w<f;w++){for(var h=db(a+w),n=c+w;40959<n;)n-=8192;Ga(n,h)&&g(n,h)}a=32;b.GBCDoubleSpeed&&(a=64);d.DMACycles+=f/16*a}function Ga(a,c){if(a===b.memoryLocationSpeedSwitch)return g(b.memoryLocationSpeedSwitch,c&1),!1;var f=d.videoRamLocation,w=d.spriteInformationTableLocation;if(a<f){if(!d.isRomOnly)if(8191>=a){if(!d.isMBC2||n(4,c))c&=15,0===c?d.isRamBankingEnabled=!1:10===c&&(d.isRamBankingEnabled=!0)}else 16383>=a?!d.isMBC5||12287>=a?(d.isMBC2&&(d.currentRomBank=
c&15),d.isMBC1?(c&=31,d.currentRomBank&=224):d.isMBC3?(c&=127,d.currentRomBank&=128):d.isMBC5&&(d.currentRomBank&=0),d.currentRomBank|=c):(a=0,f=d.currentRomBank&255,0<c&&(a=1),d.currentRomBank=m(a,f)):!d.isMBC2&&24575>=a?d.isMBC1&&d.isMBC1RomModeEnabled?(d.currentRomBank&=31,d.currentRomBank|=c&224):(c=d.isMBC5?c&15:c&3,d.currentRamBank=c):!d.isMBC2&&32767>=a&&d.isMBC1&&(n(0,c)?d.isMBC1RomModeEnabled=!0:d.isMBC1RomModeEnabled=!1);return!1}if(a>=f&&a<d.cartridgeRamLocation)return!0;if(a>=d.echoRamLocation&&
a<w)return g(a-8192,c),!0;if(a>=w&&a<=d.spriteInformationTableLocationEnd)return 2>A.currentLcdMode?!1:!0;if(a>=d.unusableMemoryLocation&&a<=d.unusableMemoryEndLocation)return!1;if(65296<=a&&65318>=a){Da();if(a===e.memoryLocationNR52||e.NR52IsSoundEnabled){switch(a){case u.memoryLocationNRx0:u.updateNRx0(c);break;case E.memoryLocationNRx0:E.updateNRx0(c);break;case u.memoryLocationNRx1:u.updateNRx1(c);break;case H.memoryLocationNRx1:H.updateNRx1(c);break;case E.memoryLocationNRx1:E.updateNRx1(c);
break;case I.memoryLocationNRx1:I.updateNRx1(c);break;case u.memoryLocationNRx2:u.updateNRx2(c);break;case H.memoryLocationNRx2:H.updateNRx2(c);break;case E.memoryLocationNRx2:E.volumeCodeChanged=!0;E.updateNRx2(c);break;case I.memoryLocationNRx2:I.updateNRx2(c);break;case u.memoryLocationNRx3:u.updateNRx3(c);break;case H.memoryLocationNRx3:H.updateNRx3(c);break;case E.memoryLocationNRx3:E.updateNRx3(c);break;case I.memoryLocationNRx3:I.updateNRx3(c);break;case u.memoryLocationNRx4:n(7,c)&&(u.updateNRx4(c),
u.trigger());break;case H.memoryLocationNRx4:n(7,c)&&(H.updateNRx4(c),H.trigger());break;case E.memoryLocationNRx4:n(7,c)&&(E.updateNRx4(c),E.trigger());break;case I.memoryLocationNRx4:n(7,c)&&(I.updateNRx4(c),I.trigger());break;case e.memoryLocationNR50:e.updateNR50(c);v.mixerVolumeChanged=!0;break;case e.memoryLocationNR51:e.updateNR51(c);v.mixerEnabledChanged=!0;break;case e.memoryLocationNR52:if(e.updateNR52(c),!n(7,c))for(c=65296;65318>c;c++)g(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&
Da();if(a>=A.memoryLocationLcdControl&&a<=r.memoryLocationWindowX){if(a===A.memoryLocationLcdControl)return A.updateLcdControl(c),!0;if(a===A.memoryLocationLcdStatus)return A.updateLcdStatus(c),!1;if(a===r.memoryLocationScanlineRegister)return r.scanlineRegister=0,g(a,0),!1;if(a===A.memoryLocationCoincidenceCompare)return A.coincidenceCompare=c,!0;if(a===r.memoryLocationDmaTransfer){c<<=8;for(a=0;159>=a;a++)f=x(c+a),g(d.spriteInformationTableLocation+a,f);d.DMACycles=644;return!0}switch(a){case r.memoryLocationScrollX:r.scrollX=
c;break;case r.memoryLocationScrollY:r.scrollY=c;break;case r.memoryLocationWindowX:r.windowX=c;break;case r.memoryLocationWindowY:r.windowY=c}return!0}if(a===d.memoryLocationHdmaTrigger)return b.GBCEnabled&&(d.isHblankHdmaActive&&!n(7,c)?(d.isHblankHdmaActive=!1,c=x(d.memoryLocationHdmaTrigger),g(d.memoryLocationHdmaTrigger,c|128)):(a=x(d.memoryLocationHdmaSourceHigh),f=x(d.memoryLocationHdmaSourceLow),a=m(a,f)&65520,f=x(d.memoryLocationHdmaDestinationHigh),w=x(d.memoryLocationHdmaDestinationLow),
f=m(f,w),f=(f&8176)+d.videoRamLocation,w=G(7,c),w=16*(w+1),n(7,c)?(d.isHblankHdmaActive=!0,d.hblankHdmaTransferLengthRemaining=w,d.hblankHdmaSource=a,d.hblankHdmaDestination=f,g(d.memoryLocationHdmaTrigger,G(7,c))):(cb(a,f,w),g(d.memoryLocationHdmaTrigger,255)))),!1;if((a===d.memoryLocationGBCWRAMBank||a===d.memoryLocationGBCVRAMBank)&&d.isHblankHdmaActive&&(16384<=d.hblankHdmaSource&&32767>=d.hblankHdmaSource||53248<=d.hblankHdmaSource&&57343>=d.hblankHdmaSource))return!1;if(a>=ua.memoryLocationBackgroundPaletteIndex&&
a<=ua.memoryLocationSpritePaletteData){if(a===ua.memoryLocationBackgroundPaletteData||a===ua.memoryLocationSpritePaletteData){f=x(a-1);f=G(6,f);w=!1;a===ua.memoryLocationSpritePaletteData&&(w=!0);var J=f&63;w&&(J+=64);h[67584+J]=c;c=f;--a;n(7,c)&&g(a,c+1|128)}return!0}if(a>=k.memoryLocationDividerRegister&&a<=k.memoryLocationTimerControl){Ma(k.currentCycles);k.currentCycles=0;switch(a){case k.memoryLocationDividerRegister:return k.updateDividerRegister(c),!1;case k.memoryLocationTimerCounter:k.updateTimerCounter(c);
break;case k.memoryLocationTimerModulo:k.updateTimerModulo(c);break;case k.memoryLocationTimerControl:k.updateTimerControl(c)}return!0}a===y.memoryLocationJoypadRegister&&y.updateJoypad(c);if(a===p.memoryLocationInterruptRequest)return p.updateInterruptRequested(c),!0;a===p.memoryLocationInterruptEnabled&&p.updateInterruptEnabled(c);return!0}function Pa(a){switch(a>>12){case 0:case 1:case 2:case 3:return a+850944;case 4:case 5:case 6:case 7:var c=d.currentRomBank;d.isMBC5||0!==c||(c=1);return 16384*
c+(a-d.switchableCartridgeRomLocation)+850944;case 8:case 9:return c=0,b.GBCEnabled&&(c=x(d.memoryLocationGBCVRAMBank)&1),a-d.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*d.currentRamBank+(a-d.cartridgeRamLocation)+719872;case 12:return a-d.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=x(d.memoryLocationGBCWRAMBank)&7),1>c&&(c=1),a-d.internalRamBankZeroLocation+18432+4096*(c-1);default:return a-d.echoRamLocation+51200}}function g(a,b){a=Pa(a);h[a]=b}function K(a,
b){h[a]=b?1:0}function eb(a,c,f,w,d,g){for(var J=w>>3;160>d;d++){var e=d+g;256<=e&&(e-=256);var l=f+32*J+(e>>3),m=V(l,0),p=!1;if(P.tileCaching){var k=d;var C=a,q=e,v=l,t=m,u=0;if(0<C&&8<k&&t===aa.tileId&&k===aa.nextXIndexToPerformCacheCheck){var y=t=!1;n(5,x(v-1))&&(t=!0);n(5,x(v))&&(y=!0);for(v=0;8>v;v++)if(t!==y&&(v=7-v),160>=k+v){for(var A=k-(8-v),B=93184+3*(160*C+(k+v)),z=0;3>z;z++)W(k+v,C,z,h[B+z]);A=h[69632+(160*C+A)];Ba(k+v,C,G(2,A),n(2,A));u++}}else aa.tileId=t;k>=aa.nextXIndexToPerformCacheCheck&&
(aa.nextXIndexToPerformCacheCheck=k+8,C=q%8,k<C&&(aa.nextXIndexToPerformCacheCheck+=C));k=u;0<k&&(d+=k-1,p=!0)}P.tileRendering&&!p?(p=d,k=a,u=c,C=w%8,q=0,0==p&&(q=e-e/8*8),e=7,160<p+8&&(e=160-p),t=-1,y=0,b.GBCEnabled&&(t=V(l,1),n(3,t)&&(y=1),n(6,t)&&(C=7-C)),k=Va(m,u,y,q,e,C,p,k,160,93184,!1,0,t),0<k&&(d+=k-1)):p||(b.GBCEnabled?(p=d,k=a,C=w,u=sa(c,m),l=V(l,1),C%=8,n(6,l)&&(C=7-C),q=0,n(3,l)&&(q=1),m=V(u+2*C,q),u=V(u+2*C+1,q),C=e%8,n(5,l)||(C=7-C),e=0,n(C,u)&&(e=e+1<<1),n(C,m)&&(e+=1),C=Aa(l&7,e,!1),
m=X(0,C),u=X(1,C),C=X(2,C),W(p,k,0,m),W(p,k,1,u),W(p,k,2,C),Ba(p,k,e,n(7,l))):(l=d,p=a,u=w,k=sa(c,m),u%=8,m=V(k+2*u,0),k=V(k+2*u+1,0),u=7-e%8,e=0,n(u,k)&&(e=e+1<<1),n(u,m)&&(e+=1),m=za(e,r.memoryLocationBackgroundPalette),W(l,p,0,m),W(l,p,1,m),W(l,p,2,m),Ba(l,p,e)))}}function fb(a){if(A.enabled)for(r.scanlineCycleCounter+=a;r.scanlineCycleCounter>=r.MAX_CYCLES_PER_SCANLINE();){r.scanlineCycleCounter-=r.MAX_CYCLES_PER_SCANLINE();a=r.scanlineRegister;if(144===a){if(P.graphicsDisableScanlineRendering)for(var b=
0;144>=b;b++)Qa(b);else Qa(a);for(b=0;144>b;b++)for(var f=0;160>f;f++)h[69632+(160*b+f)]=0;aa.tileId=-1;aa.nextXIndexToPerformCacheCheck=-1}else 144>a&&(P.graphicsDisableScanlineRendering||Qa(a));a=153<a?0:a+1;r.scanlineRegister=a}if(A.enabled){if(a=r.scanlineRegister,f=A.currentLcdMode,b=0,144<=a?b=1:r.scanlineCycleCounter>=r.MIN_CYCLES_SPRITES_LCD_MODE()?b=2:r.scanlineCycleCounter>=r.MIN_CYCLES_TRANSFER_DATA_LCD_MODE()&&(b=3),f!==b){f=x(A.memoryLocationLcdStatus);A.currentLcdMode=b;var w=!1;switch(b){case 0:f=
G(0,f);f=G(1,f);w=n(3,f);break;case 1:f=G(1,f);f|=1;w=n(4,f);break;case 2:f=G(0,f);f|=2;w=n(5,f);break;case 3:f|=3}w&&(p.isLcdInterruptRequested=!0,ta(p.bitPositionLcdInterrupt));0===b&&d.isHblankHdmaActive&&(w=16,d.hblankHdmaTransferLengthRemaining<w&&(w=d.hblankHdmaTransferLengthRemaining),cb(d.hblankHdmaSource,d.hblankHdmaDestination,w),d.hblankHdmaSource+=w,d.hblankHdmaDestination+=w,d.hblankHdmaTransferLengthRemaining-=w,0>=d.hblankHdmaTransferLengthRemaining?(d.isHblankHdmaActive=!1,g(d.memoryLocationHdmaTrigger,
255)):g(d.memoryLocationHdmaTrigger,G(7,d.hblankHdmaTransferLengthRemaining/16-1)));1===b&&(p.isVBlankInterruptRequested=!0,ta(p.bitPositionVBlankInterrupt));w=A.coincidenceCompare;0!==b&&1!==b||a!==w?f=G(2,f):(f|=4,n(6,f)&&(p.isLcdInterruptRequested=!0,ta(p.bitPositionLcdInterrupt)));g(A.memoryLocationLcdStatus,f)}}else r.scanlineCycleCounter=0,r.scanlineRegister=0,g(r.memoryLocationScanlineRegister,0),f=x(A.memoryLocationLcdStatus),f=G(1,f),f=G(0,f),A.currentLcdMode=0,g(A.memoryLocationLcdStatus,
f)}function Qa(a){var c=r.memoryLocationTileDataSelectZeroStart;A.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);if(b.GBCEnabled||A.bgDisplayEnabled){var f=r.memoryLocationTileMapSelectZeroStart;A.bgTileMapDisplaySelect&&(f=r.memoryLocationTileMapSelectOneStart);var d=r.scrollX,e=a+r.scrollY;256<=e&&(e-=256);eb(a,c,f,e,0,d)}A.windowDisplayEnabled&&(f=r.memoryLocationTileMapSelectZeroStart,A.windowTileMapDisplaySelect&&(f=r.memoryLocationTileMapSelectOneStart),d=r.windowX,e=r.windowY,
a<e||(d-=7,eb(a,c,f,a-e,d,-1*d)));if(A.spriteDisplayEnable)for(c=A.tallSpriteSize,f=39;0<=f;f--){e=4*f;var g=x(r.memoryLocationSpriteAttributesTable+e);d=x(r.memoryLocationSpriteAttributesTable+e+1);var l=x(r.memoryLocationSpriteAttributesTable+e+2);g-=16;d-=8;var k=8;c&&(k=16,1===l%2&&--l);if(a>=g&&a<g+k){e=x(r.memoryLocationSpriteAttributesTable+e+3);var p=n(7,e),m=n(6,e),v=n(5,e);g=a-g;m&&(g-=k,g*=-1,--g);g*=2;l=sa(r.memoryLocationTileDataSelectOneStart,l);k=l+=g;g=0;b.GBCEnabled&&n(3,e)&&(g=1);
l=V(k,g);k=V(k+1,g);for(g=7;0<=g;g--){m=g;v&&(m-=7,m*=-1);var q=0;n(m,k)&&(q+=1,q<<=1);n(m,l)&&(q+=1);if(0!==q&&(m=d+(7-g),0<=m&&160>=m)){var u=!1,t=!1,y=!1;b.GBCEnabled&&!A.bgDisplayEnabled&&(u=!0);if(!u){var z=h[69632+(160*a+m)],B=z&3;p&&0<B?t=!0:b.GBCEnabled&&n(2,z)&&0<B&&(y=!0)}if(u||!t&&!y)b.GBCEnabled?(t=Aa(e&7,q,!0),q=X(0,t),u=X(1,t),t=X(2,t),W(m,a,0,q),W(m,a,1,u),W(m,a,2,t)):(u=r.memoryLocationSpritePaletteOne,n(4,e)&&(u=r.memoryLocationSpritePaletteTwo),q=za(q,u),W(m,a,0,q),W(m,a,1,q),W(m,
a,2,q))}}}}}function W(a,b,f,d){h[93184+3*(160*b+a)+f]=d}function V(a,b){return h[a-d.videoRamLocation+2048+8192*(b&1)]}function Ra(a){var c=d.videoRamLocation;return a<c||a>=c&&a<d.cartridgeRamLocation?-1:a>=d.echoRamLocation&&a<d.spriteInformationTableLocation?x(a-8192):a>=d.spriteInformationTableLocation&&a<=d.spriteInformationTableLocationEnd?2>A.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=x(b.memoryLocationSpeedSwitch),n(0,c)||(a=G(0,a)),b.GBCDoubleSpeed||(a=G(7,a)),a):a===
r.memoryLocationScanlineRegister?(g(a,r.scanlineRegister),r.scanlineRegister):65296<=a&&65318>=a?(Da(),a=a===e.memoryLocationNR52?x(e.memoryLocationNR52)&128|112:-1,a):65328<=a&&65343>=a?(Da(),-1):a===k.memoryLocationDividerRegister?(c=z(k.dividerRegister),g(a,c),c):a===k.memoryLocationTimerCounter?(g(a,k.timerCounter),k.timerCounter):a===p.memoryLocationInterruptRequest?224|p.interruptsRequestedValue:a===y.memoryLocationJoypadRegister?(a=y.joypadRegisterFlipped,y.isDpadType?(a=y.up?G(2,a):a|4,a=
y.right?G(0,a):a|1,a=y.down?G(3,a):a|8,a=y.left?G(1,a):a|2):y.isButtonType&&(a=y.a?G(0,a):a|1,a=y.b?G(1,a):a|2,a=y.select?G(2,a):a|4,a=y.start?G(3,a):a|8),a|240):-1}function x(a){return h[Pa(a)]}function db(a){var b=Ra(a);switch(b){case -1:return x(a);default:return b}}function L(a){return 0<h[a]?!0:!1}function ba(a){M(b.registerA,a);Ja(b.registerA,a);b.registerA=b.registerA+a&255;0===b.registerA?l(1):l(0);q(0)}function ca(a){var c=b.registerA+a+O()&255;0!=((b.registerA^a^c)&16)?B(1):B(0);0<(b.registerA+
a+O()&256)?t(1):t(0);b.registerA=c;0===b.registerA?l(1):l(0);q(0)}function da(a){var c=-1*a;M(b.registerA,c);Ja(b.registerA,c);b.registerA=b.registerA-a&255;0===b.registerA?l(1):l(0);q(1)}function ea(a){var c=b.registerA-a-O()&255;0!=((b.registerA^a^c)&16)?B(1):B(0);0<(b.registerA-a-O()&256)?t(1):t(0);b.registerA=c;0===b.registerA?l(1):l(0);q(1)}function fa(a){b.registerA&=a;0===b.registerA?l(1):l(0);q(0);B(1);t(0)}function ha(a){b.registerA=(b.registerA^a)&255;0===b.registerA?l(1):l(0);q(0);B(0);
t(0)}function ia(a){b.registerA|=a;0===b.registerA?l(1):l(0);q(0);B(0);t(0)}function ja(a){a*=-1;M(b.registerA,a);Ja(b.registerA,a);0===b.registerA+a?l(1):l(0);q(1)}function oa(a,b){0===(b&1<<a)?l(1):l(0);q(0);B(1);return b}function U(a,b,f){return 0<b?f|1<<a:f&~(1<<a)}function va(a){a=Ia(a);b.programCounter=b.programCounter+a&65535;b.programCounter=b.programCounter+1&65535}function gb(a){b.programCounter=b.programCounter+1&65535;b.isHaltBug&&(b.programCounter=b.programCounter-1&65535);switch((a&
240)>>4){case 0:return ib(a);case 1:return jb(a);case 2:return kb(a);case 3:return lb(a);case 4:return mb(a);case 5:return nb(a);case 6:return ob(a);case 7:return pb(a);case 8:return qb(a);case 9:return rb(a);case 10:return sb(a);case 11:return tb(a);case 12:return ub(a);case 13:return vb(a);case 14:return wb(a);default:return xb(a)}}function F(a){ka(4);return db(a)}function N(a,b){ka(4);Ga(a,b)&&g(a,b)}function Y(a){ka(8);var b=Ra(a);switch(b){case -1:b=x(a)}a+=1;var f=Ra(a);switch(f){case -1:a=
x(a);break;default:a=f}return m(a,b)}function Q(a,b){ka(8);var c=z(b);b&=255;var d=a+1;Ga(a,b)&&g(a,b);Ga(d,c)&&g(d,c)}function D(){ka(4);return x(b.programCounter)}function T(){ka(4);var a=x(b.programCounter+1&65535);return m(a,D())}function ib(a){switch(a){case 0:return 4;case 1:return a=T(),b.registerB=z(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return N(m(b.registerB,b.registerC),b.registerA),4;case 3:return a=m(b.registerB,b.registerC),a++,b.registerB=z(a),b.registerC=
a&255,8;case 4:return M(b.registerB,1),b.registerB=b.registerB+1&255,0===b.registerB?l(1):l(0),q(0),4;case 5:return M(b.registerB,-1),b.registerB=b.registerB-1&255,0===b.registerB?l(1):l(0),q(1),4;case 6:return b.registerB=D(),b.programCounter=b.programCounter+1&65535,4;case 7:128===(b.registerA&128)?t(1):t(0);a=b;var c=b.registerA;a.registerA=(c<<1|c>>7)&255;l(0);q(0);B(0);return 4;case 8:return Q(T(),b.stackPointer),b.programCounter=b.programCounter+2&65535,4;case 9:return a=m(b.registerH,b.registerL),
c=m(b.registerB,b.registerC),pa(a,c,!1),a=a+c&65535,b.registerH=z(a),b.registerL=a&255,q(0),8;case 10:return b.registerA=F(m(b.registerB,b.registerC)),4;case 11:return a=m(b.registerB,b.registerC),a=a-1&65535,b.registerB=z(a),b.registerC=a&255,8;case 12:return M(b.registerC,1),b.registerC=b.registerC+1&255,0===b.registerC?l(1):l(0),q(0),4;case 13:return M(b.registerC,-1),b.registerC=b.registerC-1&255,0===b.registerC?l(1):l(0),q(1),4;case 14:return b.registerC=D(),b.programCounter=b.programCounter+
1&65535,4;case 15:return 0<(b.registerA&1)?t(1):t(0),a=b,c=b.registerA,a.registerA=(c>>1|c<<7)&255,l(0),q(0),B(0),4}return-1}function jb(a){switch(a){case 16:if(b.GBCEnabled&&(a=F(b.memoryLocationSpeedSwitch),n(0,a)))return a=G(0,a),n(7,a)?(b.GBCDoubleSpeed=!1,a=G(7,a)):(b.GBCDoubleSpeed=!0,a|=128),N(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=T(),b.registerD=z(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;
case 18:return N(m(b.registerD,b.registerE),b.registerA),4;case 19:return a=m(b.registerD,b.registerE),a=a+1&65535,b.registerD=z(a),b.registerE=a&255,8;case 20:return M(b.registerD,1),b.registerD=b.registerD+1&255,0===b.registerD?l(1):l(0),q(0),4;case 21:return M(b.registerD,-1),b.registerD=b.registerD-1&255,0===b.registerD?l(1):l(0),q(1),4;case 22:return b.registerD=D(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=!1,128===(b.registerA&128)&&(a=!0),b.registerA=(b.registerA<<1|O())&
255,a?t(1):t(0),l(0),q(0),B(0),4;case 24:return va(D()),8;case 25:a=m(b.registerH,b.registerL);var c=m(b.registerD,b.registerE);pa(a,c,!1);a=a+c&65535;b.registerH=z(a);b.registerL=a&255;q(0);return 8;case 26:return a=m(b.registerD,b.registerE),b.registerA=F(a),4;case 27:return a=m(b.registerD,b.registerE),a=a-1&65535,b.registerD=z(a),b.registerE=a&255,8;case 28:return M(b.registerE,1),b.registerE=b.registerE+1&255,0===b.registerE?l(1):l(0),q(0),4;case 29:return M(b.registerE,-1),b.registerE=b.registerE-
1&255,0===b.registerE?l(1):l(0),q(1),4;case 30:return b.registerE=D(),b.programCounter=b.programCounter+1&65535,4;case 31:return a=!1,1===(b.registerA&1)&&(a=!0),b.registerA=(b.registerA>>1|O()<<7)&255,a?t(1):t(0),l(0),q(0),B(0),4}return-1}function kb(a){switch(a){case 32:return 0===la()?va(D()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=T(),b.registerH=z(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=m(b.registerH,b.registerL),N(a,b.registerA),
a=a+1&65535,b.registerH=z(a),b.registerL=a&255,4;case 35:return a=m(b.registerH,b.registerL),a=a+1&65535,b.registerH=z(a),b.registerL=a&255,8;case 36:return M(b.registerH,1),b.registerH=b.registerH+1&255,0===b.registerH?l(1):l(0),q(0),4;case 37:return M(b.registerH,-1),b.registerH=b.registerH-1&255,0===b.registerH?l(1):l(0),q(1),4;case 38:return b.registerH=D(),b.programCounter=b.programCounter+1&65535,4;case 39:var c=0;0<(b.registerF>>5&1)&&(c|=6);0<O()&&(c|=96);0<(b.registerF>>6&1)?a=b.registerA-
c&255:(9<(b.registerA&15)&&(c|=6),153<b.registerA&&(c|=96),a=b.registerA+c&255);0===a?l(1):l(0);0!==(c&96)?t(1):t(0);B(0);b.registerA=a;return 4;case 40:return 0<la()?va(D()):b.programCounter=b.programCounter+1&65535,8;case 41:return a=m(b.registerH,b.registerL),pa(a,a,!1),a=2*a&65535,b.registerH=z(a),b.registerL=a&255,q(0),8;case 42:return a=m(b.registerH,b.registerL),b.registerA=F(a),a=a+1&65535,b.registerH=z(a),b.registerL=a&255,4;case 43:return a=m(b.registerH,b.registerL),a=a-1&65535,b.registerH=
z(a),b.registerL=a&255,8;case 44:return M(b.registerL,1),b.registerL=b.registerL+1&255,0===b.registerL?l(1):l(0),q(0),4;case 45:return M(b.registerL,-1),b.registerL=b.registerL-1&255,0===b.registerL?l(1):l(0),q(1),4;case 46:return b.registerL=D(),b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=~b.registerA,q(1),B(1),4}return-1}function lb(a){switch(a){case 48:return 0===O()?va(D()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=T(),b.programCounter=
b.programCounter+2&65535,4;case 50:return a=m(b.registerH,b.registerL),N(a,b.registerA),a=a-1&65535,b.registerH=z(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=m(b.registerH,b.registerL);var c=F(a);M(c,1);c=c+1&255;0===c?l(1):l(0);q(0);N(a,c);return 4;case 53:return a=m(b.registerH,b.registerL),c=F(a),M(c,-1),c=c-1&255,0===c?l(1):l(0),q(1),N(a,c),4;case 54:return N(m(b.registerH,b.registerL),D()),b.programCounter=b.programCounter+1&65535,4;case 55:return q(0),
B(0),t(1),4;case 56:return 1===O()?va(D()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=m(b.registerH,b.registerL),pa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=z(a),b.registerL=a&255,q(0),8;case 58:return a=m(b.registerH,b.registerL),b.registerA=F(a),a=a-1&65535,b.registerH=z(a),b.registerL=a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return M(b.registerA,1),b.registerA=b.registerA+1&255,0===b.registerA?l(1):l(0),q(0),4;case 61:return M(b.registerA,
-1),b.registerA=b.registerA-1&255,0===b.registerA?l(1):l(0),q(1),4;case 62:return b.registerA=D(),b.programCounter=b.programCounter+1&65535,4;case 63:return q(0),B(0),0<O()?t(0):t(1),4}return-1}function mb(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=b.registerD,4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=F(m(b.registerH,b.registerL)),4;case 71:return b.registerB=
b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=F(m(b.registerH,b.registerL)),4;case 79:return b.registerC=b.registerA,4}return-1}function nb(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,
4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=F(m(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=F(m(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,
4}return-1}function ob(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=F(m(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,
4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=F(m(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,4}return-1}function pb(a){switch(a){case 112:return N(m(b.registerH,b.registerL),b.registerB),4;case 113:return N(m(b.registerH,b.registerL),b.registerC),4;case 114:return N(m(b.registerH,b.registerL),b.registerD),4;case 115:return N(m(b.registerH,b.registerL),b.registerE),
4;case 116:return N(m(b.registerH,b.registerL),b.registerH),4;case 117:return N(m(b.registerH,b.registerL),b.registerL),4;case 118:return d.isHblankHdmaActive||b.enableHalt(),4;case 119:return N(m(b.registerH,b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=
F(m(b.registerH,b.registerL)),4;case 127:return 4}return-1}function qb(a){switch(a){case 128:return ba(b.registerB),4;case 129:return ba(b.registerC),4;case 130:return ba(b.registerD),4;case 131:return ba(b.registerE),4;case 132:return ba(b.registerH),4;case 133:return ba(b.registerL),4;case 134:return a=F(m(b.registerH,b.registerL)),ba(a),4;case 135:return ba(b.registerA),4;case 136:return ca(b.registerB),4;case 137:return ca(b.registerC),4;case 138:return ca(b.registerD),4;case 139:return ca(b.registerE),
4;case 140:return ca(b.registerH),4;case 141:return ca(b.registerL),4;case 142:return a=F(m(b.registerH,b.registerL)),ca(a),4;case 143:return ca(b.registerA),4}return-1}function rb(a){switch(a){case 144:return da(b.registerB),4;case 145:return da(b.registerC),4;case 146:return da(b.registerD),4;case 147:return da(b.registerE),4;case 148:return da(b.registerH),4;case 149:return da(b.registerL),4;case 150:return a=F(m(b.registerH,b.registerL)),da(a),4;case 151:return da(b.registerA),4;case 152:return ea(b.registerB),
4;case 153:return ea(b.registerC),4;case 154:return ea(b.registerD),4;case 155:return ea(b.registerE),4;case 156:return ea(b.registerH),4;case 157:return ea(b.registerL),4;case 158:return a=F(m(b.registerH,b.registerL)),ea(a),4;case 159:return ea(b.registerA),4}return-1}function sb(a){switch(a){case 160:return fa(b.registerB),4;case 161:return fa(b.registerC),4;case 162:return fa(b.registerD),4;case 163:return fa(b.registerE),4;case 164:return fa(b.registerH),4;case 165:return fa(b.registerL),4;case 166:return a=
F(m(b.registerH,b.registerL)),fa(a),4;case 167:return fa(b.registerA),4;case 168:return ha(b.registerB),4;case 169:return ha(b.registerC),4;case 170:return ha(b.registerD),4;case 171:return ha(b.registerE),4;case 172:return ha(b.registerH),4;case 173:return ha(b.registerL),4;case 174:return a=F(m(b.registerH,b.registerL)),ha(a),4;case 175:return ha(b.registerA),4}return-1}function tb(a){switch(a){case 176:return ia(b.registerB),4;case 177:return ia(b.registerC),4;case 178:return ia(b.registerD),4;
case 179:return ia(b.registerE),4;case 180:return ia(b.registerH),4;case 181:return ia(b.registerL),4;case 182:return a=F(m(b.registerH,b.registerL)),ia(a),4;case 183:return ia(b.registerA),4;case 184:return ja(b.registerB),4;case 185:return ja(b.registerC),4;case 186:return ja(b.registerD),4;case 187:return ja(b.registerE),4;case 188:return ja(b.registerH),4;case 189:return ja(b.registerL),4;case 190:return a=F(m(b.registerH,b.registerL)),ja(a),4;case 191:return ja(b.registerA),4}return-1}function ub(a){switch(a){case 192:return 0===
la()?(b.programCounter=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 193:return a=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=z(a),b.registerC=a&255,4;case 194:if(0===la())return b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 195:return b.programCounter=T(),8;case 196:if(0===la())return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter+2&65535),b.programCounter=T(),8;b.programCounter=b.programCounter+
2&65535;return 12;case 197:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,m(b.registerB,b.registerC)),8;case 198:return ba(D()),b.programCounter=b.programCounter+1&65535,4;case 199:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=0,8;case 200:return 1===la()?(b.programCounter=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 201:return b.programCounter=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,8;case 202:if(1===
la())return b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=D();a=-1;var f=!1,d=0,e=0,g=c%8;switch(g){case 0:d=b.registerB;break;case 1:d=b.registerC;break;case 2:d=b.registerD;break;case 3:d=b.registerE;break;case 4:d=b.registerH;break;case 5:d=b.registerL;break;case 6:d=F(m(b.registerH,b.registerL));break;case 7:d=b.registerA}var h=(c&240)>>4;switch(h){case 0:7>=c?(c=d,128===(c&128)?t(1):t(0),c=(c<<1|c>>7)&255,0===c?l(1):l(0),q(0),B(0),e=c,f=!0):15>=c&&
(c=d,0<(c&1)?t(1):t(0),c=(c>>1|c<<7)&255,0===c?l(1):l(0),q(0),B(0),e=c,f=!0);break;case 1:23>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=(c<<1|O())&255,f?t(1):t(0),0===c?l(1):l(0),q(0),B(0),e=c,f=!0):31>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=(c>>1|O()<<7)&255,f?t(1):t(0),0===c?l(1):l(0),q(0),B(0),e=c,f=!0);break;case 2:39>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=c<<1&255,f?t(1):t(0),0===c?l(1):l(0),q(0),B(0),e=c,f=!0):47>=c&&(c=d,f=!1,128===(c&128)&&(f=!0),d=!1,1===(c&1)&&(d=!0),c=c>>1&255,f&&(c|=128),0===c?l(1):
l(0),q(0),B(0),d?t(1):t(0),e=c,f=!0);break;case 3:55>=c?(c=d,c=((c&15)<<4|(c&240)>>4)&255,0===c?l(1):l(0),q(0),B(0),t(0),e=c,f=!0):63>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=c>>1&255,0===c?l(1):l(0),q(0),B(0),f?t(1):t(0),e=c,f=!0);break;case 4:71>=c?(e=oa(0,d),f=!0):79>=c&&(e=oa(1,d),f=!0);break;case 5:87>=c?(e=oa(2,d),f=!0):95>=c&&(e=oa(3,d),f=!0);break;case 6:103>=c?(e=oa(4,d),f=!0):111>=c&&(e=oa(5,d),f=!0);break;case 7:119>=c?(e=oa(6,d),f=!0):127>=c&&(e=oa(7,d),f=!0);break;case 8:135>=c?(e=U(0,0,d),
f=!0):143>=c&&(e=U(1,0,d),f=!0);break;case 9:151>=c?(e=U(2,0,d),f=!0):159>=c&&(e=U(3,0,d),f=!0);break;case 10:167>=c?(e=U(4,0,d),f=!0):175>=c&&(e=U(5,0,d),f=!0);break;case 11:183>=c?(e=U(6,0,d),f=!0):191>=c&&(e=U(7,0,d),f=!0);break;case 12:199>=c?(e=U(0,1,d),f=!0):207>=c&&(e=U(1,1,d),f=!0);break;case 13:215>=c?(e=U(2,1,d),f=!0):223>=c&&(e=U(3,1,d),f=!0);break;case 14:231>=c?(e=U(4,1,d),f=!0):239>=c&&(e=U(5,1,d),f=!0);break;case 15:247>=c?(e=U(6,1,d),f=!0):255>=c&&(e=U(7,1,d),f=!0)}switch(g){case 0:b.registerB=
e;break;case 1:b.registerC=e;break;case 2:b.registerD=e;break;case 3:b.registerE=e;break;case 4:b.registerH=e;break;case 5:b.registerL=e;break;case 6:(4>h||7<h)&&N(m(b.registerH,b.registerL),e);break;case 7:b.registerA=e}f&&(a=4);b.programCounter=b.programCounter+1&65535;return a;case 204:if(1===la())return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter+2),b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return b.stackPointer=b.stackPointer-
2&65535,Q(b.stackPointer,b.programCounter+2&65535),b.programCounter=T(),8;case 206:return ca(D()),b.programCounter=b.programCounter+1&65535,4;case 207:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=8}return-1}function vb(a){switch(a){case 208:return 0===O()?(b.programCounter=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 209:return a=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerD=z(a),b.registerE=a&255,4;case 210:if(0===
O())return b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===O())return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter+2),b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,m(b.registerD,b.registerE)),8;case 214:return da(D()),b.programCounter=b.programCounter+1&65535,4;case 215:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,
b.programCounter),b.programCounter=16,8;case 216:return 1===O()?(b.programCounter=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 217:return b.programCounter=Y(b.stackPointer),Fa(!0),b.stackPointer=b.stackPointer+2&65535,8;case 218:if(1===O())return b.programCounter=T(),8;b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===O())return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter+2&65535),b.programCounter=T(),8;b.programCounter=b.programCounter+
2&65535;return 12;case 222:return ea(D()),b.programCounter=b.programCounter+1&65535,4;case 223:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=24,8}return-1}function wb(a){switch(a){case 224:return a=D(),N(65280+a,b.registerA),b.programCounter=b.programCounter+1&65535,4;case 225:return a=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerH=z(a),b.registerL=a&255,4;case 226:return N(65280+b.registerC,b.registerA),4;case 229:return b.stackPointer=
b.stackPointer-2&65535,Q(b.stackPointer,m(b.registerH,b.registerL)),8;case 230:return fa(D()),b.programCounter=b.programCounter+1&65535,4;case 231:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=32,8;case 232:return a=Ia(D()),pa(b.stackPointer,a,!0),b.stackPointer=b.stackPointer+a&65535,l(0),q(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=m(b.registerH,b.registerL),4;case 234:return N(T(),b.registerA),b.programCounter=
b.programCounter+2&65535,4;case 238:return ha(D()),b.programCounter=b.programCounter+1&65535,4;case 239:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=40,8}return-1}function xb(a){switch(a){case 240:return a=D(),b.registerA=F(65280+a)&255,b.programCounter=b.programCounter+1&65535,4;case 241:return a=Y(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerA=z(a),b.registerF=a&255,4;case 242:return b.registerA=F(65280+b.registerC)&255,4;case 243:return Fa(!1),
4;case 245:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,m(b.registerA,b.registerF)),8;case 246:return ia(D()),b.programCounter=b.programCounter+1&65535,4;case 247:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=48,8;case 248:return a=Ia(D()),l(0),q(0),pa(b.stackPointer,a,!0),a=b.stackPointer+a&65535,b.registerH=z(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=m(b.registerH,b.registerL),
8;case 250:return b.registerA=F(T()),b.programCounter=b.programCounter+2&65535,4;case 251:return Fa(!0),4;case 254:return ja(D()),b.programCounter=b.programCounter+1&65535,4;case 255:return b.stackPointer=b.stackPointer-2&65535,Q(b.stackPointer,b.programCounter),b.programCounter=56,8}return-1}function ka(a){0<d.DMACycles&&(a+=d.DMACycles,d.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(P.graphicsBatchProcessing){if(r.currentCycles+=a,!(r.currentCycles<r.batchProcessCycles()))for(;r.currentCycles>=
r.batchProcessCycles();)fb(r.batchProcessCycles()),r.currentCycles-=r.batchProcessCycles()}else fb(a);P.audioBatchProcessing?e.currentCycles+=a:Za(a)}P.timersBatchProcessing?(k.currentCycles+=a,Ma(k.currentCycles),k.currentCycles=0):Ma(a);R.cycles+=a;R.cycles>=R.cyclesPerCycleSet&&(R.cycleSets+=1,R.cycles-=R.cyclesPerCycleSet)}function Sa(){return Ha(!0,-1,-1)}function Ha(a,c,f){void 0===c&&(c=-1);void 0===f&&(f=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var d=!1,e=!1,g=!1,h=!1;!(d||e||g||h);)c=Ta(),0>c?
d=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?e=!0:-1<a&&Ka()>=a?g=!0:-1<f&&b.programCounter===f&&(h=!0);if(e)return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),0;if(g)return 1;if(h)return 2;b.programCounter=b.programCounter-1&65535;return-1}function Ta(){wa=!0;if(b.isHaltBug){var a=x(b.programCounter);a=gb(a);ka(a);b.exitHaltAndStop()}p.masterInterruptSwitchDelay&&(p.masterInterruptSwitch=!0,p.masterInterruptSwitchDelay=!1);if(0<(p.interruptsEnabledValue&p.interruptsRequestedValue&31)){a=!1;p.masterInterruptSwitch&&
!b.isHaltNoJump&&(p.isVBlankInterruptEnabled&&p.isVBlankInterruptRequested?(Ea(p.bitPositionVBlankInterrupt),a=!0):p.isLcdInterruptEnabled&&p.isLcdInterruptRequested?(Ea(p.bitPositionLcdInterrupt),a=!0):p.isTimerInterruptEnabled&&p.isTimerInterruptRequested?(Ea(p.bitPositionTimerInterrupt),a=!0):p.isJoypadInterruptEnabled&&p.isJoypadInterruptRequested&&(Ea(p.bitPositionJoypadInterrupt),a=!0));var c=0;a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;
0<a&&ka(a);a=4;b.isHalted()||b.isStopped||(a=x(b.programCounter),a=gb(a));b.registerF&=240;if(0>=a)return a;ka(a);S.steps+=1;S.steps>=S.stepsPerStepSet&&(S.stepSets+=1,S.steps-=S.stepsPerStepSet);return a}const h=new Uint8ClampedArray(9109504),xa={size:()=>9109504,grow:()=>{},wasmByteMemory:h};var P=function(){function a(){}a.enableBootRom=!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=
!1;a.tileRendering=!1;a.tileCaching=!1;return a}(),ua=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;return a}(),aa=function(){function a(){}a.tileId=-1;a.horizontalFlip=!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),u=function(){function a(){}a.updateNRx0=function(b){a.NRx0SweepPeriod=(b&112)>>4;a.NRx0Negate=n(3,b);a.NRx0SweepShift=b&7};a.updateNRx1=
function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){K(1024+50*a.saveStateSlot,
a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;h[1038+50*a.saveStateSlot]=a.volume;h[1043+50*a.saveStateSlot]=a.dutyCycle;h[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;K(1049+50*a.saveStateSlot,a.isSweepEnabled);h[1050+50*a.saveStateSlot]=a.sweepCounter;h[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};a.loadState=function(){a.isEnabled=L(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];
a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.dutyCycle=h[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=h[1044+50*a.saveStateSlot];a.isSweepEnabled=L(1049+50*a.saveStateSlot);a.sweepCounter=h[1050+50*a.saveStateSlot];a.sweepShadowFrequency=h[1055+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx0,128);g(a.memoryLocationNRx1,191);g(a.memoryLocationNRx2,243);g(a.memoryLocationNRx3,193);g(a.memoryLocationNRx4,
191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;Wa(a.NRx1Duty,
a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&0<a.NRx0SweepShift?!0:!1;0<a.NRx0SweepShift&&Xa();a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateSweep=
function(){--a.sweepCounter;0>=a.sweepCounter&&(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&0<a.NRx0SweepPeriod&&Xa())};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=
b>>8;b&=255;var d=x(a.memoryLocationNRx4)&248|c;g(a.memoryLocationNRx3,b);g(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=
65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=7;return a}(),H=function(){function a(){}a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=
n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){K(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;h[1038+50*a.saveStateSlot]=
a.volume;h[1043+50*a.saveStateSlot]=a.dutyCycle;h[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.isEnabled=L(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.dutyCycle=h[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=h[1044+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx1-1,255);g(a.memoryLocationNRx1,63);
g(a.memoryLocationNRx2,0);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));
if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;Wa(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;
0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=x(a.memoryLocationNRx4)&248|c;g(a.memoryLocationNRx3,b);g(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=
0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),E=function(){function a(){}
a.updateNRx0=function(b){a.isDacEnabled=n(7,b)};a.updateNRx1=function(b){a.NRx1LengthLoad=b;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2VolumeCode=b>>5&15};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){K(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;
h[1029+50*a.saveStateSlot]=a.lengthCounter;h[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=L(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.lengthCounter=h[1029+50*a.saveStateSlot];a.waveTablePosition=h[1033+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx0,127);g(a.memoryLocationNRx1,255);g(a.memoryLocationNRx2,159);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=
function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveTablePosition+=1,32<=a.waveTablePosition&&(a.waveTablePosition=0));b=0;var c=a.volumeCode;if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&(c=x(a.memoryLocationNRx2),c=c>>5&15,a.volumeCode=
c,a.volumeCodeChanged=!1);else return 15;var d=x(a.memoryLocationWaveTable+(a.waveTablePosition/2|0));d=0===a.waveTablePosition%2?d>>4&15:d&15;switch(c){case 0:d>>=4;break;case 1:b=1;break;case 2:d>>=1;b=2;break;default:d>>=2,b=4}return(0<b?d/b:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter&&!a.volumeCodeChanged?
!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;
a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=9;return a}(),I=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3ClockShift=b>>4;a.NRx3WidthMode=n(3,b);a.NRx3DivisorCode=b&7;switch(a.NRx3DivisorCode){case 0:a.divisor=8;break;case 1:a.divisor=
16;break;case 2:a.divisor=32;break;case 3:a.divisor=48;break;case 4:a.divisor=64;break;case 5:a.divisor=80;break;case 6:a.divisor=96;break;case 7:a.divisor=112}};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b)};a.saveState=function(){K(1024+50*a.saveStateSlot,a.isEnabled);h[1025+50*a.saveStateSlot]=a.frequencyTimer;h[1029+50*a.saveStateSlot]=a.envelopeCounter;h[1033+50*a.saveStateSlot]=a.lengthCounter;h[1038+50*a.saveStateSlot]=a.volume;h[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};
a.loadState=function(){a.isEnabled=L(1024+50*a.saveStateSlot);a.frequencyTimer=h[1025+50*a.saveStateSlot];a.envelopeCounter=h[1029+50*a.saveStateSlot];a.lengthCounter=h[1033+50*a.saveStateSlot];a.volume=h[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=h[1043+50*a.saveStateSlot]};a.initialize=function(){g(a.memoryLocationNRx1-1,255);g(a.memoryLocationNRx1,255);g(a.memoryLocationNRx2,0);g(a.memoryLocationNRx3,0);g(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;
a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.frequencyTimer=a.getNoiseChannelFrequencyPeriod(),a.frequencyTimer-=b,b=a.linearFeedbackShiftRegister&1^a.linearFeedbackShiftRegister>>1&1,a.linearFeedbackShiftRegister>>=1,a.linearFeedbackShiftRegister|=b<<14,a.NRx3WidthMode&&(a.linearFeedbackShiftRegister&=-65,a.linearFeedbackShiftRegister|=b<<6));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=
n(0,a.linearFeedbackShiftRegister)?-1:1;return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.getNoiseChannelFrequencyPeriod=function(){var c=a.divisor<<a.NRx3ClockShift;b.GBCDoubleSpeed&&
(c*=2);return c};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=
!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=10;return a}(),v=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=
!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),e=function(){function a(){}a.batchProcessCycles=function(){return b.GBCDoubleSpeed?174:87};a.updateNR50=function(b){a.NR50LeftMixerVolume=b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=n(7,b);a.NR51IsChannel3EnabledOnLeftOutput=n(6,b);a.NR51IsChannel2EnabledOnLeftOutput=
n(5,b);a.NR51IsChannel1EnabledOnLeftOutput=n(4,b);a.NR51IsChannel4EnabledOnRightOutput=n(3,b);a.NR51IsChannel3EnabledOnRightOutput=n(2,b);a.NR51IsChannel2EnabledOnRightOutput=n(1,b);a.NR51IsChannel1EnabledOnRightOutput=n(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=n(7,b)};a.maxFrameSequenceCycles=function(){return b.GBCDoubleSpeed?16384:8192};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;h[1028+50*a.saveStateSlot]=
a.downSampleCycleCounter;h[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=h[1024+50*a.saveStateSlot];a.downSampleCycleCounter=h[1028+50*a.saveStateSlot];a.frameSequencer=h[1029+50*a.saveStateSlot];La()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=
!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),p=function(){function a(){}a.updateInterruptEnabled=
function(b){a.isVBlankInterruptEnabled=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=n(a.bitPositionTimerInterrupt,b);a.isJoypadInterruptEnabled=n(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=n(a.bitPositionTimerInterrupt,b);a.isJoypadInterruptRequested=
n(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){K(1024+50*a.saveStateSlot,a.masterInterruptSwitch);K(1025+50*a.saveStateSlot,a.masterInterruptSwitchDelay)};a.loadState=function(){a.masterInterruptSwitch=L(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=L(1025+50*a.saveStateSlot);a.updateInterruptEnabled(x(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(x(a.memoryLocationInterruptRequest))};
a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=2;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=
!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=2;return a}(),k=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(b){b=a.dividerRegister;a.dividerRegister=0;g(a.memoryLocationDividerRegister,0);a.timerEnabled&&bb(b,a.dividerRegister)&&Na()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=
b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=a.timerModulo,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=n(2,b);b&=3;if(!c){c=Oa(a.timerInputClock);var d=Oa(b);(a.timerEnabled?n(c,a.dividerRegister):n(c,a.dividerRegister)&&n(d,a.dividerRegister))&&Na()}a.timerInputClock=b};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.currentCycles;h[1028+50*a.saveStateSlot]=a.dividerRegister;K(1032+50*a.saveStateSlot,a.timerCounterOverflowDelay);
K(1035+50*a.saveStateSlot,a.timerCounterWasReset);g(a.memoryLocationTimerCounter,a.timerCounter)};a.loadState=function(){a.currentCycles=h[1024+50*a.saveStateSlot];a.dividerRegister=h[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=L(1032+50*a.saveStateSlot);a.timerCounterWasReset=L(1035+50*a.saveStateSlot);a.timerCounter=x(a.memoryLocationTimerCounter);a.timerModulo=x(a.memoryLocationTimerModulo);a.timerInputClock=x(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=
65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),y=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=n(4,a.joypadRegisterFlipped);a.isButtonType=n(5,a.joypadRegisterFlipped)};a.saveState=function(){};
a.loadState=function(){a.updateJoypad(x(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),A=function(){function a(){}a.updateLcdStatus=function(b){var c=x(a.memoryLocationLcdStatus);b=b&248|c&7|128;g(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){a.enabled=n(7,b);a.windowTileMapDisplaySelect=n(6,b);
a.windowDisplayEnabled=n(5,b);a.bgWindowTileDataSelect=n(4,b);a.bgTileMapDisplaySelect=n(3,b);a.tallSpriteSize=n(2,b);a.spriteDisplayEnable=n(1,b);a.bgDisplayEnabled=n(0,b)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=
!1;return a}(),r=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return b.GBCDoubleSpeed?153===a.scanlineRegister?8:912:153===a.scanlineRegister?4:456};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return b.GBCDoubleSpeed?752:376};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return b.GBCDoubleSpeed?498:249};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;h[1028+50*a.saveStateSlot]=A.currentLcdMode;
g(a.memoryLocationScanlineRegister,a.scanlineRegister)};a.loadState=function(){a.scanlineCycleCounter=h[1024+50*a.saveStateSlot];A.currentLcdMode=h[1028+50*a.saveStateSlot];a.scanlineRegister=x(a.memoryLocationScanlineRegister);A.updateLcdControl(x(A.memoryLocationLcdControl))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=
65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),d=function(){function a(){}a.saveState=function(){h[1024+50*a.saveStateSlot]=
a.currentRomBank;h[1026+50*a.saveStateSlot]=a.currentRamBank;K(1028+50*a.saveStateSlot,a.isRamBankingEnabled);K(1029+50*a.saveStateSlot,a.isMBC1RomModeEnabled);K(1030+50*a.saveStateSlot,a.isRomOnly);K(1031+50*a.saveStateSlot,a.isMBC1);K(1032+50*a.saveStateSlot,a.isMBC2);K(1033+50*a.saveStateSlot,a.isMBC3);K(1034+50*a.saveStateSlot,a.isMBC5)};a.loadState=function(){a.currentRomBank=h[1024+50*a.saveStateSlot];a.currentRamBank=h[1026+50*a.saveStateSlot];a.isRamBankingEnabled=L(1028+50*a.saveStateSlot);
a.isMBC1RomModeEnabled=L(1029+50*a.saveStateSlot);a.isRomOnly=L(1030+50*a.saveStateSlot);a.isMBC1=L(1031+50*a.saveStateSlot);a.isMBC2=L(1032+50*a.saveStateSlot);a.isMBC3=L(1033+50*a.saveStateSlot);a.isMBC5=L(1034+50*a.saveStateSlot)};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=
65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=
0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return a.GBCDoubleSpeed?8388608:4194304};a.MAX_CYCLES_PER_FRAME=function(){return a.GBCDoubleSpeed?140448:70224};a.enableHalt=function(){p.masterInterruptSwitch?a.isHaltNormal=!0:0===(p.interruptsEnabledValue&p.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=
!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump?!0:!1};a.saveState=function(){h[1024+50*a.saveStateSlot]=a.registerA;h[1025+50*a.saveStateSlot]=a.registerB;h[1026+50*a.saveStateSlot]=a.registerC;h[1027+50*a.saveStateSlot]=a.registerD;h[1028+50*a.saveStateSlot]=a.registerE;h[1029+50*a.saveStateSlot]=a.registerH;h[1030+50*a.saveStateSlot]=a.registerL;h[1031+50*a.saveStateSlot]=a.registerF;h[1032+50*a.saveStateSlot]=a.stackPointer;h[1034+50*a.saveStateSlot]=
a.programCounter;h[1036+50*a.saveStateSlot]=a.currentCycles;K(1041+50*a.saveStateSlot,a.isHaltNormal);K(1042+50*a.saveStateSlot,a.isHaltNoJump);K(1043+50*a.saveStateSlot,a.isHaltBug);K(1044+50*a.saveStateSlot,a.isStopped)};a.loadState=function(){a.registerA=h[1024+50*a.saveStateSlot];a.registerB=h[1025+50*a.saveStateSlot];a.registerC=h[1026+50*a.saveStateSlot];a.registerD=h[1027+50*a.saveStateSlot];a.registerE=h[1028+50*a.saveStateSlot];a.registerH=h[1029+50*a.saveStateSlot];a.registerL=h[1030+50*
a.saveStateSlot];a.registerF=h[1031+50*a.saveStateSlot];a.stackPointer=h[1032+50*a.saveStateSlot];a.programCounter=h[1034+50*a.saveStateSlot];a.currentCycles=h[1036+50*a.saveStateSlot];a.isHaltNormal=L(1041+50*a.saveStateSlot);a.isHaltNoJump=L(1042+50*a.saveStateSlot);a.isHaltBug=L(1043+50*a.saveStateSlot);a.isStopped=L(1044+50*a.saveStateSlot)};a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;
a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),R=function(){function a(){}a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}(),S=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;return a}();139>xa.size()&&xa.grow(139-xa.size());var wa=!1,yb=Object.freeze({memory:xa,config:function(a,c,f,h,n,l,m,q,t){P.enableBootRom=0<a?!0:!1;P.useGbcWhenAvailable=
0<c?!0:!1;P.audioBatchProcessing=0<f?!0:!1;P.graphicsBatchProcessing=0<h?!0:!1;P.timersBatchProcessing=0<n?!0:!1;P.graphicsDisableScanlineRendering=0<l?!0:!1;P.audioAccumulateSamples=0<m?!0:!1;P.tileRendering=0<q?!0:!1;P.tileCaching=0<t?!0:!1;a=x(323);b.GBCEnabled=192===a||P.useGbcWhenAvailable&&128===a?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=
!1;b.isHaltNoJump=!1;b.isHaltBug=!1;b.isStopped=!1;b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77);b.programCounter=256;b.stackPointer=65534;d.isRamBankingEnabled=!1;d.isMBC1RomModeEnabled=!0;a=x(327);d.isRomOnly=!1;d.isMBC1=!1;d.isMBC2=!1;d.isMBC3=!1;d.isMBC5=!1;0===a?d.isRomOnly=!0:1<=a&&3>=a?
d.isMBC1=!0:5<=a&&6>=a?d.isMBC2=!0:15<=a&&19>=a?d.isMBC3=!0:25<=a&&30>=a&&(d.isMBC5=!0);d.currentRomBank=1;d.currentRamBank=0;g(65361,255);g(65362,255);g(65363,255);g(65364,255);g(65365,255);r.currentCycles=0;r.scanlineCycleCounter=0;r.scanlineRegister=0;r.scrollX=0;r.scrollY=0;r.windowX=0;r.windowY=0;b.GBCEnabled?(r.scanlineRegister=144,g(65344,145),g(65345,129),g(65348,144),g(65351,252)):(r.scanlineRegister=144,g(65344,145),g(65345,133),g(65350,255),g(65351,252),g(65352,255),g(65353,255));g(65359,
0);g(65392,1);b.GBCEnabled?(g(65384,192),g(65385,255),g(65386,193),g(65387,13)):(g(65384,255),g(65385,255),g(65386,255),g(65387,255));e.currentCycles=0;e.NR50LeftMixerVolume=0;e.NR50RightMixerVolume=0;e.NR51IsChannel1EnabledOnLeftOutput=!0;e.NR51IsChannel2EnabledOnLeftOutput=!0;e.NR51IsChannel3EnabledOnLeftOutput=!0;e.NR51IsChannel4EnabledOnLeftOutput=!0;e.NR51IsChannel1EnabledOnRightOutput=!0;e.NR51IsChannel2EnabledOnRightOutput=!0;e.NR51IsChannel3EnabledOnRightOutput=!0;e.NR51IsChannel4EnabledOnRightOutput=
!0;e.NR52IsSoundEnabled=!0;e.frameSequenceCycleCounter=0;e.downSampleCycleCounter=0;e.frameSequencer=0;e.audioQueueIndex=0;u.initialize();H.initialize();E.initialize();I.initialize();g(e.memoryLocationNR50,119);g(e.memoryLocationNR51,243);g(e.memoryLocationNR52,241);v.channel1Sample=15;v.channel2Sample=15;v.channel3Sample=15;v.channel4Sample=15;v.channel1DacEnabled=!1;v.channel2DacEnabled=!1;v.channel3DacEnabled=!1;v.channel4DacEnabled=!1;v.leftChannelSampleUnsignedByte=127;v.rightChannelSampleUnsignedByte=
127;v.mixerVolumeChanged=!0;v.mixerEnabledChanged=!0;v.needToRemixSamples=!1;p.updateInterruptEnabled(0);g(p.memoryLocationInterruptEnabled,p.interruptsEnabledValue);p.updateInterruptRequested(225);g(p.memoryLocationInterruptRequest,p.interruptsRequestedValue);k.currentCycles=0;k.dividerRegister=0;k.timerCounter=0;k.timerModulo=0;k.timerEnabled=!1;k.timerInputClock=0;k.timerCounterOverflowDelay=!1;k.timerCounterWasReset=!1;b.GBCEnabled?(g(65284,30),k.dividerRegister=7840):(g(65284,171),k.dividerRegister=
43980);g(65287,248);k.timerInputClock=248;b.GBCEnabled?(g(65392,248),g(65359,254),g(65357,126),g(65280,207),g(65282,124),g(65295,225),g(65388,254),g(65397,143)):(g(65392,255),g(65359,255),g(65357,255),g(65280,207),g(65282,126),g(65295,225));wa=!1;R.cyclesPerCycleSet=2E9;R.cycleSets=0;R.cycles=0;S.stepsPerStepSet=2E9;S.stepSets=0;S.steps=0},hasCoreStarted:function(){return wa?1:0},saveState:function(){b.saveState();r.saveState();p.saveState();y.saveState();d.saveState();k.saveState();e.saveState();
u.saveState();H.saveState();E.saveState();I.saveState();wa=!1},loadState:function(){b.loadState();r.loadState();p.loadState();y.loadState();d.loadState();k.loadState();e.loadState();u.loadState();H.loadState();E.loadState();I.loadState();wa=!1;R.cyclesPerCycleSet=2E9;R.cycleSets=0;R.cycles=0;S.stepsPerStepSet=2E9;S.stepSets=0;S.steps=0},getStepsPerStepSet:function(){return S.stepsPerStepSet},getStepSets:function(){return S.stepSets},getSteps:function(){return S.steps},executeMultipleFrames:function(a){for(var b=
0,d=0;d<a&&0<=b;)b=Sa(),d+=1;return 0>b?b:0},executeFrame:Sa,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return Ha(!0,a,-1)},executeFrameUntilBreakpoint:function(a){a=Ha(!0,-1,a);return 2===a?1:a},executeUntilCondition:Ha,executeStep:Ta,getCyclesPerCycleSet:function(){return R.cyclesPerCycleSet},getCycleSets:function(){return R.cycleSets},getCycles:function(){return R.cycles},setJoypadState:function(a,b,d,e,g,h,n,l){0<a?na(0):Z(0,!1);0<b?na(1):Z(1,!1);0<d?na(2):Z(2,!1);0<e?na(3):Z(3,!1);
0<g?na(4):Z(4,!1);0<h?na(5):Z(5,!1);0<n?na(6):Z(6,!1);0<l?na(7):Z(7,!1)},getNumberOfSamplesInAudioBuffer:Ka,clearAudioBuffer:La,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:9109504,WASMBOY_WASM_PAGES:139,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,GAMEBOY_INTERNAL_MEMORY_SIZE:65535,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,
OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:67584,GRAPHICS_OUTPUT_SIZE:521216,GBC_PALETTE_LOCATION:67584,GBC_PALETTE_SIZE:512,BG_PRIORITY_MAP_LOCATION:69632,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:93184,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:232448,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:429056,TILE_DATA_SIZE:147456,OAM_TILES_LOCATION:576512,OAM_TILES_SIZE:12288,AUDIO_BUFFER_LOCATION:588800,AUDIO_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:719872,CARTRIDGE_RAM_SIZE:131072,
CARTRIDGE_ROM_LOCATION:850944,CARTRIDGE_ROM_SIZE:8258560,getWasmBoyOffsetFromGameBoyOffset:Pa,getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},
getOpcodeAtProgramCounter:function(){return x(b.programCounter)},getLY:function(){return r.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){void 0===a&&(a=0);var c=r.memoryLocationTileDataSelectZeroStart;A.bgWindowTileDataSelect&&(c=r.memoryLocationTileDataSelectOneStart);var d=r.memoryLocationTileMapSelectZeroStart;A.bgTileMapDisplaySelect&&(d=r.memoryLocationTileMapSelectOneStart);for(var e=0;256>e;e++)for(var g=0;256>g;g++){var l=e,k=g,m=d+32*(l>>3)+(k>>3),p=V(m,0);p=sa(c,p);var q=l%
8;l=k%8;l=7-l;k=0;b.GBCEnabled&&0<a&&(k=V(m,1));n(6,k)&&(q=7-q);var t=0;n(3,k)&&(t=1);m=V(p+2*q,t);p=V(p+2*q+1,t);q=0;n(l,p)&&(q+=1,q<<=1);n(l,m)&&(q+=1);p=3*(256*e+g);if(b.GBCEnabled&&0<a)k=Aa(k&7,q,!1),l=X(0,k),m=X(1,k),q=X(2,k),k=232448+p,h[k]=l,h[k+1]=m,h[k+2]=q;else for(l=za(q,r.memoryLocationBackgroundPalette),m=0;3>m;m++)k=232448+p+m,h[k]=l}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var b=0;31>b;b++){var d=0;15<b&&(d=1);var e=a;15<a&&(e-=15);e<<=4;e=15<b?e+(b-15):e+b;var g=
r.memoryLocationTileDataSelectOneStart;15<a&&(g=r.memoryLocationTileDataSelectZeroStart);for(var h=0;8>h;h++)Va(e,g,d,0,7,h,8*b,8*a+h,248,429056,!0)}},getDIV:function(){return k.dividerRegister},getTIMA:function(){return k.timerCounter},getTMA:function(){return k.timerModulo},getTAC:function(){var a=k.timerInputClock;k.timerEnabled&&(a|=4);return a},update:Sa,emulationStep:Ta,getAudioQueueIndex:Ka,resetAudioQueue:La,wasmMemorySize:9109504,wasmBoyInternalStateLocation:1024,wasmBoyInternalStateSize:1024,
gameBoyInternalMemoryLocation:2048,gameBoyInternalMemorySize:65535,videoOutputLocation:67584,frameInProgressVideoOutputLocation:93184,gameboyColorPaletteLocation:67584,gameboyColorPaletteSize:512,backgroundMapLocation:232448,tileDataMap:429056,soundOutputLocation:588800,gameBytesLocation:850944,gameRamBanksLocation:719872});return async()=>({instance:{exports:yb},byteMemory:xa.wasmByteMemory,type:"TypeScript"})});
