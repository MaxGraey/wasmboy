'use strict';var WasmBoyTsCore=function(){function l(a,b){return(a&255)<<8|b&255}function A(a){return(a&65280)>>8}function F(a,b){return b&~(1<<a)}function n(a,b){return 0!=(b&1<<a)}function Ta(a){var b=a;n(7,b)&&(b=-1*(256-a));return b}function Ia(a,c){a=1<<a&255;b.registerF=0<c?b.registerF|a:b.registerF&(255^a);return b.registerF}function m(a){Ia(7,a)}function v(a){Ia(6,a)}function B(a){Ia(5,a)}function t(a){Ia(4,a)}function ma(){return b.registerF>>7&1}function R(){return b.registerF>>4&1}function P(a,
b){0<=b?0!==((a&15)+(b&15)&16)?B(1):B(0):(Math.abs(b)&15)>(a&15)?B(1):B(0)}function Ua(a,b){0<=b?a>(a+b&255)?t(1):t(0):Math.abs(b)>a?t(1):t(0)}function pa(a,b,f){f?(a=a^b^a+b,0!==(a&16)?B(1):B(0),0!==(a&256)?t(1):t(0)):(f=a+b&65535,f<a?t(1):t(0),0!==((a^b^f)&4096)?B(1):B(0))}function Ja(a,b,f){void 0===f&&(f=!1);var c=a;f||(c=w(b)>>2*a&3);a=242;switch(c){case 1:a=160;break;case 2:a=88;break;case 3:a=8}return a}function Ka(a,b,f){b=8*a+2*b;a=ob(b+1,f);f=ob(b,f);return l(a,f)}function Y(a,b){return 8*
((b&31<<5*a)>>5*a)}function ob(a,b){a&=63;b&&(a+=64);return g[67584+a]}function La(a,b,f,z){void 0===f&&(f=0);void 0===z&&(z=!1);f&=3;z&&(f|=4);g[67712+(160*b+a)]=f}function Va(a,c,f,z,d,e,h,m,k,l,p,w,sa,v){var D=0;c=ya(c,a);a=U(c+2*e,f);f=U(c+2*e+1,f);for(e=z;e<=d;e++)if(c=h+(e-z),c<k){var C=e;if(0>sa||!n(5,sa))C=7-C;var qa=0;n(C,f)&&(qa+=1,qa<<=1);n(C,a)&&(qa+=1);if(b.GBCEnabled&&(0<=sa||0<=v)){C=0<=v;var xa=sa&7;C&&(xa=v&7);var ra=Ka(xa,qa,C);C=Y(0,ra);xa=Y(1,ra);ra=Y(2,ra)}else 0>=w&&(w=q.memoryLocationBackgroundPalette),
xa=C=ra=Ja(qa,w,p);var Wa=3*(m*k+c);g[l+Wa]=C;g[l+Wa+1]=xa;g[l+Wa+2]=ra;C=!1;0<=sa&&(C=n(7,sa));La(c,m,qa,C);D++}return D}function ya(a,b){if(a===q.memoryLocationTileDataSelectZeroStart){var c=b+128;n(7,b)&&(c=b-128);return a+16*c}return a+16*b}function pb(a,b){switch(a){case 1:return n(b,129);case 2:return n(b,135);case 3:return n(b,126);default:return n(b,1)}}function qb(){var a=rb();2047>=a&&0<u.NRx0SweepShift&&(u.sweepShadowFrequency=a,u.setFrequency(a),a=rb());2047<a&&(u.isEnabled=!1)}function rb(){var a=
u.sweepShadowFrequency;a>>=u.NRx0SweepShift;return a=u.NRx0Negate?u.sweepShadowFrequency-a:u.sweepShadowFrequency+a}function Ma(a){switch(a){case u.channelNumber:if(r.channel1DacEnabled!==u.isDacEnabled)return r.channel1DacEnabled=u.isDacEnabled,!0;break;case I.channelNumber:if(r.channel2DacEnabled!==I.isDacEnabled)return r.channel2DacEnabled=I.isDacEnabled,!0;break;case G.channelNumber:if(r.channel3DacEnabled!==G.isDacEnabled)return r.channel3DacEnabled=G.isDacEnabled,!0;break;case J.channelNumber:if(r.channel4DacEnabled!==
J.isDacEnabled)return r.channel4DacEnabled=J.isDacEnabled,!0}return!1}function Na(){if(!(h.currentCycles<h.batchProcessCycles()))for(;h.currentCycles>=h.batchProcessCycles();)sb(h.batchProcessCycles()),h.currentCycles-=h.batchProcessCycles()}function sb(a){h.frameSequenceCycleCounter+=a;if(h.frameSequenceCycleCounter>=h.maxFrameSequenceCycles()){h.frameSequenceCycleCounter-=h.maxFrameSequenceCycles();switch(h.frameSequencer){case 0:u.updateLength();I.updateLength();G.updateLength();J.updateLength();
break;case 2:u.updateLength();I.updateLength();G.updateLength();J.updateLength();u.updateSweep();break;case 4:u.updateLength();I.updateLength();G.updateLength();J.updateLength();break;case 6:u.updateLength();I.updateLength();G.updateLength();J.updateLength();u.updateSweep();break;case 7:u.updateEnvelope(),I.updateEnvelope(),J.updateEnvelope()}h.frameSequencer+=1;8<=h.frameSequencer&&(h.frameSequencer=0);var b=!0}else b=!1;if(M.audioAccumulateSamples&&!b){b=u.willChannelUpdate(a)||Ma(u.channelNumber);
var f=I.willChannelUpdate(a)||Ma(I.channelNumber),z=G.willChannelUpdate(a)||Ma(G.channelNumber),d=J.willChannelUpdate(a)||Ma(J.channelNumber);b&&(r.channel1Sample=u.getSampleFromCycleCounter());f&&(r.channel2Sample=I.getSampleFromCycleCounter());z&&(r.channel3Sample=G.getSampleFromCycleCounter());d&&(r.channel4Sample=J.getSampleFromCycleCounter());if(b||f||z||d)r.needToRemixSamples=!0;h.downSampleCycleCounter+=a*h.downSampleCycleMultiplier;h.downSampleCycleCounter>=h.maxDownSampleCycles()&&(h.downSampleCycleCounter-=
h.maxDownSampleCycles(),(r.needToRemixSamples||r.mixerVolumeChanged||r.mixerEnabledChanged)&&ta(r.channel1Sample,r.channel2Sample,r.channel3Sample,r.channel4Sample),ua(r.leftChannelSampleUnsignedByte+1,r.rightChannelSampleUnsignedByte+1,za),h.audioQueueIndex+=1,h.audioQueueIndex>=(h.wasmBoyMemoryMaxBufferSize/2|0)-1&&--h.audioQueueIndex)}else if(b=u.getSample(a)|0,f=I.getSample(a)|0,z=G.getSample(a)|0,d=J.getSample(a)|0,r.channel1Sample=b,r.channel2Sample=f,r.channel3Sample=z,r.channel4Sample=d,h.downSampleCycleCounter+=
a*h.downSampleCycleMultiplier,h.downSampleCycleCounter>=h.maxDownSampleCycles()){h.downSampleCycleCounter-=h.maxDownSampleCycles();a=ta(b,f,z,d);var e=A(a);ua(e+1,(a&255)+1,za);M.enableAudioDebugging&&(a=ta(b,15,15,15),e=A(a),ua(e+1,(a&255)+1,Xa),a=ta(15,f,15,15),e=A(a),ua(e+1,(a&255)+1,Ya),a=ta(15,15,z,15),e=A(a),ua(e+1,(a&255)+1,Za),a=ta(15,15,15,d),e=A(a),ua(e+1,(a&255)+1,$a));h.audioQueueIndex+=1;h.audioQueueIndex>=(h.wasmBoyMemoryMaxBufferSize/2|0)-1&&--h.audioQueueIndex}}function ab(){return h.audioQueueIndex}
function bb(){h.audioQueueIndex=0}function ta(a,b,f,z){void 0===a&&(a=15);void 0===b&&(b=15);void 0===f&&(f=15);void 0===z&&(z=15);r.mixerVolumeChanged=!1;var c=0,d=0;c=h.NR51IsChannel1EnabledOnLeftOutput?c+a:c+15;c=h.NR51IsChannel2EnabledOnLeftOutput?c+b:c+15;c=h.NR51IsChannel3EnabledOnLeftOutput?c+f:c+15;c=h.NR51IsChannel4EnabledOnLeftOutput?c+z:c+15;d=h.NR51IsChannel1EnabledOnRightOutput?d+a:d+15;d=h.NR51IsChannel2EnabledOnRightOutput?d+b:d+15;d=h.NR51IsChannel3EnabledOnRightOutput?d+f:d+15;d=
h.NR51IsChannel4EnabledOnRightOutput?d+z:d+15;r.mixerEnabledChanged=!1;r.needToRemixSamples=!1;a=tb(c,h.NR50LeftMixerVolume+1);d=tb(d,h.NR50RightMixerVolume+1);r.leftChannelSampleUnsignedByte=a;r.rightChannelSampleUnsignedByte=d;return l(a,d)}function tb(a,b){if(60===a)return 127;a=1E5*(a-60)*b/8|0;a=a/1E5|0;a+=60;a=1E5*a/(12E6/254|0)|0;return a|=0}function ua(a,b,f){f+=2*h.audioQueueIndex;g[f]=a+1;g[f+1]=b+1}function Aa(a){Oa(!1);var c=w(k.memoryLocationInterruptRequest);c=F(a,c);k.interruptsRequestedValue=
c;e(k.memoryLocationInterruptRequest,c);b.stackPointer-=2;b.isHalted();c=b.stackPointer;var f=b.programCounter,z=A(f),d=c+1;e(c,f&255);e(d,z);switch(a){case k.bitPositionVBlankInterrupt:k.isVBlankInterruptRequested=!1;b.programCounter=64;break;case k.bitPositionLcdInterrupt:k.isLcdInterruptRequested=!1;b.programCounter=72;break;case k.bitPositionTimerInterrupt:k.isTimerInterruptRequested=!1;b.programCounter=80;break;case k.bitPositionSerialInterrupt:k.isSerialInterruptRequested=!1;b.programCounter=
88;break;case k.bitPositionJoypadInterrupt:k.isJoypadInterruptRequested=!1,b.programCounter=96}}function va(a){var b=w(k.memoryLocationInterruptRequest);b|=1<<a;k.interruptsRequestedValue=b;e(k.memoryLocationInterruptRequest,b)}function Oa(a){a?k.masterInterruptSwitchDelay=!0:k.masterInterruptSwitch=!1}function cb(a){for(var b=0;b<a;){var f=p.dividerRegister;b+=4;p.dividerRegister+=4;65535<p.dividerRegister&&(p.dividerRegister-=65536);p.timerEnabled&&(p.timerCounterOverflowDelay?(p.timerCounter=p.timerModulo,
k.isTimerInterruptRequested=!0,va(k.bitPositionTimerInterrupt),p.timerCounterOverflowDelay=!1,p.timerCounterWasReset=!0):p.timerCounterWasReset&&(p.timerCounterWasReset=!1),ub(f,p.dividerRegister)&&db())}}function db(){p.timerCounter+=1;255<p.timerCounter&&(p.timerCounterOverflowDelay=!0,p.timerCounter=0)}function ub(a,b){var c=eb(p.timerInputClock);return n(c,a)&&!n(c,b)?!0:!1}function eb(a){switch(a){case 0:return 9;case 1:return 3;case 2:return 5;case 3:return 7}return 0}function na(a){var c=b.isStopped=
!1;Cb(a)||(c=!0);aa(a,!0);c&&(c=!1,3>=a&&(c=!0),a=!1,y.isDpadType&&c&&(a=!0),y.isButtonType&&!c&&(a=!0),a&&(k.isJoypadInterruptRequested=!0,va(k.bitPositionJoypadInterrupt)))}function Cb(a){switch(a){case 0:return y.up;case 1:return y.right;case 2:return y.down;case 3:return y.left;case 4:return y.a;case 5:return y.b;case 6:return y.select;case 7:return y.start;default:return!1}}function aa(a,b){switch(a){case 0:y.up=b;break;case 1:y.right=b;break;case 2:y.down=b;break;case 3:y.left=b;break;case 4:y.a=
b;break;case 5:y.b=b;break;case 6:y.select=b;break;case 7:y.start=b}}function vb(a,c,f){for(var z=0;z<f;z++){for(var g=fb(a+z),n=c+z;40959<n;)n-=8192;Pa(n,g)&&e(n,g)}a=32;b.GBCDoubleSpeed&&(a=64);d.DMACycles+=f/16*a}function Pa(a,c){if(a===b.memoryLocationSpeedSwitch)return e(b.memoryLocationSpeedSwitch,c&1),!1;var f=d.videoRamLocation,z=d.spriteInformationTableLocation;if(a<f){if(!d.isRomOnly)if(8191>=a){if(!d.isMBC2||n(4,c))c&=15,0===c?d.isRamBankingEnabled=!1:10===c&&(d.isRamBankingEnabled=!0)}else 16383>=
a?!d.isMBC5||12287>=a?(d.isMBC2&&(d.currentRomBank=c&15),d.isMBC1?(c&=31,d.currentRomBank&=224):d.isMBC3?(c&=127,d.currentRomBank&=128):d.isMBC5&&(d.currentRomBank&=0),d.currentRomBank|=c):(a=0,f=d.currentRomBank&255,0<c&&(a=1),d.currentRomBank=l(a,f)):!d.isMBC2&&24575>=a?d.isMBC1&&d.isMBC1RomModeEnabled?(d.currentRomBank&=31,d.currentRomBank|=c&224):(c=d.isMBC5?c&15:c&3,d.currentRamBank=c):!d.isMBC2&&32767>=a&&d.isMBC1&&(n(0,c)?d.isMBC1RomModeEnabled=!0:d.isMBC1RomModeEnabled=!1);return!1}if(a>=
f&&a<d.cartridgeRamLocation)return!0;if(a>=d.echoRamLocation&&a<z)return e(a-8192,c),!0;if(a>=z&&a<=d.spriteInformationTableLocationEnd)return 2>x.currentLcdMode?!1:!0;if(a>=d.unusableMemoryLocation&&a<=d.unusableMemoryEndLocation)return!1;if(a===K.memoryLocationSerialTransferControl)return K.updateTransferControl(c);if(65296<=a&&65318>=a){Na();if(a===h.memoryLocationNR52||h.NR52IsSoundEnabled){switch(a){case u.memoryLocationNRx0:u.updateNRx0(c);break;case G.memoryLocationNRx0:G.updateNRx0(c);break;
case u.memoryLocationNRx1:u.updateNRx1(c);break;case I.memoryLocationNRx1:I.updateNRx1(c);break;case G.memoryLocationNRx1:G.updateNRx1(c);break;case J.memoryLocationNRx1:J.updateNRx1(c);break;case u.memoryLocationNRx2:u.updateNRx2(c);break;case I.memoryLocationNRx2:I.updateNRx2(c);break;case G.memoryLocationNRx2:G.volumeCodeChanged=!0;G.updateNRx2(c);break;case J.memoryLocationNRx2:J.updateNRx2(c);break;case u.memoryLocationNRx3:u.updateNRx3(c);break;case I.memoryLocationNRx3:I.updateNRx3(c);break;
case G.memoryLocationNRx3:G.updateNRx3(c);break;case J.memoryLocationNRx3:J.updateNRx3(c);break;case u.memoryLocationNRx4:n(7,c)&&(u.updateNRx4(c),u.trigger());break;case I.memoryLocationNRx4:n(7,c)&&(I.updateNRx4(c),I.trigger());break;case G.memoryLocationNRx4:n(7,c)&&(G.updateNRx4(c),G.trigger());break;case J.memoryLocationNRx4:n(7,c)&&(J.updateNRx4(c),J.trigger());break;case h.memoryLocationNR50:h.updateNR50(c);r.mixerVolumeChanged=!0;break;case h.memoryLocationNR51:h.updateNR51(c);r.mixerEnabledChanged=
!0;break;case h.memoryLocationNR52:if(h.updateNR52(c),!n(7,c))for(c=65296;65318>c;c++)e(c,0)}c=!0}else c=!1;return c}65328<=a&&65343>=a&&Na();if(a>=x.memoryLocationLcdControl&&a<=q.memoryLocationWindowX){if(a===x.memoryLocationLcdControl)return x.updateLcdControl(c),!0;if(a===x.memoryLocationLcdStatus)return x.updateLcdStatus(c),!1;if(a===q.memoryLocationScanlineRegister)return q.scanlineRegister=0,e(a,0),!1;if(a===x.memoryLocationCoincidenceCompare)return x.coincidenceCompare=c,!0;if(a===q.memoryLocationDmaTransfer){c<<=
8;for(a=0;159>=a;a++)f=w(c+a),e(d.spriteInformationTableLocation+a,f);d.DMACycles=644;return!0}switch(a){case q.memoryLocationScrollX:q.scrollX=c;break;case q.memoryLocationScrollY:q.scrollY=c;break;case q.memoryLocationWindowX:q.windowX=c;break;case q.memoryLocationWindowY:q.windowY=c}return!0}if(a===d.memoryLocationHdmaTrigger)return b.GBCEnabled&&(d.isHblankHdmaActive&&!n(7,c)?(d.isHblankHdmaActive=!1,c=w(d.memoryLocationHdmaTrigger),e(d.memoryLocationHdmaTrigger,c|128)):(a=w(d.memoryLocationHdmaSourceHigh),
f=w(d.memoryLocationHdmaSourceLow),a=l(a,f)&65520,f=w(d.memoryLocationHdmaDestinationHigh),z=w(d.memoryLocationHdmaDestinationLow),f=l(f,z),f=(f&8176)+d.videoRamLocation,z=F(7,c),z=16*(z+1),n(7,c)?(d.isHblankHdmaActive=!0,d.hblankHdmaTransferLengthRemaining=z,d.hblankHdmaSource=a,d.hblankHdmaDestination=f,e(d.memoryLocationHdmaTrigger,F(7,c))):(vb(a,f,z),e(d.memoryLocationHdmaTrigger,255)))),!1;if((a===d.memoryLocationGBCWRAMBank||a===d.memoryLocationGBCVRAMBank)&&d.isHblankHdmaActive&&(16384<=d.hblankHdmaSource&&
32767>=d.hblankHdmaSource||53248<=d.hblankHdmaSource&&57343>=d.hblankHdmaSource))return!1;if(a>=Ba.memoryLocationBackgroundPaletteIndex&&a<=Ba.memoryLocationSpritePaletteData){if(a===Ba.memoryLocationBackgroundPaletteData||a===Ba.memoryLocationSpritePaletteData){f=w(a-1);f=F(6,f);z=!1;a===Ba.memoryLocationSpritePaletteData&&(z=!0);var D=f&63;z&&(D+=64);g[67584+D]=c;c=f;--a;n(7,c)&&e(a,c+1|128)}return!0}if(a>=p.memoryLocationDividerRegister&&a<=p.memoryLocationTimerControl){cb(p.currentCycles);p.currentCycles=
0;switch(a){case p.memoryLocationDividerRegister:return p.updateDividerRegister(c),!1;case p.memoryLocationTimerCounter:p.updateTimerCounter(c);break;case p.memoryLocationTimerModulo:p.updateTimerModulo(c);break;case p.memoryLocationTimerControl:p.updateTimerControl(c)}return!0}a===y.memoryLocationJoypadRegister&&y.updateJoypad(c);if(a===k.memoryLocationInterruptRequest)return k.updateInterruptRequested(c),!0;a===k.memoryLocationInterruptEnabled&&k.updateInterruptEnabled(c);return!0}function gb(a){switch(a>>
12){case 0:case 1:case 2:case 3:return a+Ca;case 4:case 5:case 6:case 7:var c=d.currentRomBank;d.isMBC5||0!==c||(c=1);return 16384*c+(a-d.switchableCartridgeRomLocation)+Ca;case 8:case 9:return c=0,b.GBCEnabled&&(c=w(d.memoryLocationGBCVRAMBank)&1),a-d.videoRamLocation+2048+8192*c;case 10:case 11:return 8192*d.currentRamBank+(a-d.cartridgeRamLocation)+Qa;case 12:return a-d.internalRamBankZeroLocation+18432;case 13:return c=0,b.GBCEnabled&&(c=w(d.memoryLocationGBCWRAMBank)&7),1>c&&(c=1),a-d.internalRamBankZeroLocation+
18432+4096*(c-1);default:return a-d.echoRamLocation+51200}}function e(a,b){a=gb(a);g[a]=b}function N(a,b){g[a]=b?1:0}function wb(a){q.scanlineCycleCounter=0;q.scanlineRegister=0;e(q.memoryLocationScanlineRegister,0);var b=w(x.memoryLocationLcdStatus);b=F(1,b);b=F(0,b);x.currentLcdMode=0;e(x.memoryLocationLcdStatus,b);if(a)for(a=0;a<xb;a++)g[67584+a]=255}function yb(a,b){var c=x.coincidenceCompare;0!==a&&1!==a||q.scanlineRegister!==c?b=F(2,b):(b|=4,n(6,b)&&(k.isLcdInterruptRequested=!0,va(k.bitPositionLcdInterrupt)));
return b}function zb(a,c,f,d,e,h){for(var z=d>>3;160>e;e++){var D=e+h;256<=D&&(D-=256);var m=f+32*z+(D>>3),k=U(m,0),C=!1;if(M.tileCaching){var l=e;var p=a,v=D,r=m,t=k,u=0;if(0<p&&8<l&&t===ba.tileId&&l===ba.nextXIndexToPerformCacheCheck){var x=t=!1;n(5,w(r-1))&&(t=!0);n(5,w(r))&&(x=!0);for(r=0;8>r;r++)if(t!==x&&(r=7-r),160>=l+r){for(var y=l-(8-r),B=wa+3*(160*p+(l+r)),A=0;3>A;A++)X(l+r,p,A,g[B+A]);y=g[67712+(160*p+y)];La(l+r,p,F(2,y),n(2,y));u++}}else ba.tileId=t;l>=ba.nextXIndexToPerformCacheCheck&&
(ba.nextXIndexToPerformCacheCheck=l+8,p=v%8,l<p&&(ba.nextXIndexToPerformCacheCheck+=p));l=u;0<l&&(e+=l-1,C=!0)}M.tileRendering&&!C?(C=e,l=a,u=c,p=d%8,v=0,0==C&&(v=D-D/8*8),D=7,160<C+8&&(D=160-C),t=-1,x=0,b.GBCEnabled&&(t=U(m,1),n(3,t)&&(x=1),n(6,t)&&(p=7-p)),l=Va(k,u,x,v,D,p,C,l,160,wa,!1,0,t,-1),0<l&&(e+=l-1)):C||(b.GBCEnabled?(C=e,l=a,p=d,u=ya(c,k),m=U(m,1),p%=8,n(6,m)&&(p=7-p),v=0,n(3,m)&&(v=1),k=U(u+2*p,v),u=U(u+2*p+1,v),p=D%8,n(5,m)||(p=7-p),D=0,n(p,u)&&(D=D+1<<1),n(p,k)&&(D+=1),p=Ka(m&7,D,!1),
k=Y(0,p),u=Y(1,p),p=Y(2,p),X(C,l,0,k),X(C,l,1,u),X(C,l,2,p),La(C,l,D,n(7,m))):(m=e,C=a,u=d,l=ya(c,k),u%=8,k=U(l+2*u,0),l=U(l+2*u+1,0),u=7-D%8,D=0,n(u,l)&&(D=D+1<<1),n(u,k)&&(D+=1),k=Ja(D,q.memoryLocationBackgroundPalette),X(m,C,0,k),X(m,C,1,k),X(m,C,2,k),La(m,C,D)))}}function Ab(a){if(x.enabled)for(q.scanlineCycleCounter+=a;q.scanlineCycleCounter>=q.MAX_CYCLES_PER_SCANLINE();){q.scanlineCycleCounter-=q.MAX_CYCLES_PER_SCANLINE();a=q.scanlineRegister;if(144===a){if(M.graphicsDisableScanlineRendering)for(var b=
0;144>=b;b++)hb(b);else hb(a);for(b=0;144>b;b++)for(var f=0;160>f;f++)g[67712+(160*b+f)]=0;ba.tileId=-1;ba.nextXIndexToPerformCacheCheck=-1}else 144>a&&(M.graphicsDisableScanlineRendering||hb(a));a=153<a?0:a+1;q.scanlineRegister=a}if(x.enabled)if(b=q.scanlineRegister,f=x.currentLcdMode,a=0,144<=b?a=1:q.scanlineCycleCounter>=q.MIN_CYCLES_SPRITES_LCD_MODE()?a=2:q.scanlineCycleCounter>=q.MIN_CYCLES_TRANSFER_DATA_LCD_MODE()&&(a=3),f!==a){b=w(x.memoryLocationLcdStatus);x.currentLcdMode=a;f=!1;switch(a){case 0:b=
F(0,b);b=F(1,b);f=n(3,b);break;case 1:b=F(1,b);b|=1;f=n(4,b);break;case 2:b=F(0,b);b|=2;f=n(5,b);break;case 3:b|=3}f&&(k.isLcdInterruptRequested=!0,va(k.bitPositionLcdInterrupt));0===a&&d.isHblankHdmaActive&&(f=16,d.hblankHdmaTransferLengthRemaining<f&&(f=d.hblankHdmaTransferLengthRemaining),vb(d.hblankHdmaSource,d.hblankHdmaDestination,f),d.hblankHdmaSource+=f,d.hblankHdmaDestination+=f,d.hblankHdmaTransferLengthRemaining-=f,0>=d.hblankHdmaTransferLengthRemaining?(d.isHblankHdmaActive=!1,e(d.memoryLocationHdmaTrigger,
255)):e(d.memoryLocationHdmaTrigger,F(7,d.hblankHdmaTransferLengthRemaining/16-1)));1===a&&(k.isVBlankInterruptRequested=!0,va(k.bitPositionVBlankInterrupt));b=yb(a,b);e(x.memoryLocationLcdStatus,b)}else 153===b&&(b=w(x.memoryLocationLcdStatus),b=yb(a,b),e(x.memoryLocationLcdStatus,b))}function hb(a){var c=q.memoryLocationTileDataSelectZeroStart;x.bgWindowTileDataSelect&&(c=q.memoryLocationTileDataSelectOneStart);if(b.GBCEnabled||x.bgDisplayEnabled){var f=q.memoryLocationTileMapSelectZeroStart;x.bgTileMapDisplaySelect&&
(f=q.memoryLocationTileMapSelectOneStart);var d=q.scrollX,e=a+q.scrollY;256<=e&&(e-=256);zb(a,c,f,e,0,d)}x.windowDisplayEnabled&&(f=q.memoryLocationTileMapSelectZeroStart,x.windowTileMapDisplaySelect&&(f=q.memoryLocationTileMapSelectOneStart),d=q.windowX,e=q.windowY,a<e||(d-=7,zb(a,c,f,a-e,d,-1*d)));if(x.spriteDisplayEnable)for(c=x.tallSpriteSize,f=39;0<=f;f--){e=4*f;var h=w(q.memoryLocationSpriteAttributesTable+e);d=w(q.memoryLocationSpriteAttributesTable+e+1);var l=w(q.memoryLocationSpriteAttributesTable+
e+2);h-=16;d-=8;var m=8;c&&(m=16,1===l%2&&--l);if(a>=h&&a<h+m){e=w(q.memoryLocationSpriteAttributesTable+e+3);var p=n(7,e),k=n(6,e),v=n(5,e);h=a-h;k&&(h-=m,h*=-1,--h);h*=2;l=ya(q.memoryLocationTileDataSelectOneStart,l);m=l+=h;h=0;b.GBCEnabled&&n(3,e)&&(h=1);l=U(m,h);m=U(m+1,h);for(h=7;0<=h;h--){k=h;v&&(k-=7,k*=-1);var r=0;n(k,m)&&(r+=1,r<<=1);n(k,l)&&(r+=1);if(0!==r&&(k=d+(7-h),0<=k&&160>=k)){var u=!1,t=!1,y=!1;b.GBCEnabled&&!x.bgDisplayEnabled&&(u=!0);if(!u){var A=g[67712+(160*a+k)],B=A&3;p&&0<B?
t=!0:b.GBCEnabled&&n(2,A)&&0<B&&(y=!0)}if(u||!t&&!y)b.GBCEnabled?(t=Ka(e&7,r,!0),r=Y(0,t),u=Y(1,t),t=Y(2,t),X(k,a,0,r),X(k,a,1,u),X(k,a,2,t)):(u=q.memoryLocationSpritePaletteOne,n(4,e)&&(u=q.memoryLocationSpritePaletteTwo),r=Ja(r,u),X(k,a,0,r),X(k,a,1,r),X(k,a,2,r))}}}}}function X(a,b,f,d){g[wa+3*(160*b+a)+f]=d}function U(a,b){return g[a-d.videoRamLocation+2048+8192*(b&1)]}function ib(a){var c=d.videoRamLocation;return a<c||a>=c&&a<d.cartridgeRamLocation?-1:a>=d.echoRamLocation&&a<d.spriteInformationTableLocation?
w(a-8192):a>=d.spriteInformationTableLocation&&a<=d.spriteInformationTableLocationEnd?2>x.currentLcdMode?255:-1:a===b.memoryLocationSpeedSwitch?(a=255,c=w(b.memoryLocationSpeedSwitch),n(0,c)||(a=F(0,a)),b.GBCDoubleSpeed||(a=F(7,a)),a):a===q.memoryLocationScanlineRegister?(e(a,q.scanlineRegister),q.scanlineRegister):65296<=a&&65318>=a?(Na(),a=a===h.memoryLocationNR52?w(h.memoryLocationNR52)&128|112:-1,a):65328<=a&&65343>=a?(Na(),-1):a===p.memoryLocationDividerRegister?(c=A(p.dividerRegister),e(a,c),
c):a===p.memoryLocationTimerCounter?(e(a,p.timerCounter),p.timerCounter):a===k.memoryLocationInterruptRequest?224|k.interruptsRequestedValue:a===y.memoryLocationJoypadRegister?(a=y.joypadRegisterFlipped,y.isDpadType?(a=y.up?F(2,a):a|4,a=y.right?F(0,a):a|1,a=y.down?F(3,a):a|8,a=y.left?F(1,a):a|2):y.isButtonType&&(a=y.a?F(0,a):a|1,a=y.b?F(1,a):a|2,a=y.select?F(2,a):a|4,a=y.start?F(3,a):a|8),a|240):-1}function w(a){return g[gb(a)]}function fb(a){var b=ib(a);switch(b){case -1:return w(a);default:return b}}
function O(a){return 0<g[a]?!0:!1}function ca(a){P(b.registerA,a);Ua(b.registerA,a);b.registerA=b.registerA+a&255;0===b.registerA?m(1):m(0);v(0)}function da(a){var c=b.registerA+a+R()&255;0!=((b.registerA^a^c)&16)?B(1):B(0);0<(b.registerA+a+R()&256)?t(1):t(0);b.registerA=c;0===b.registerA?m(1):m(0);v(0)}function ea(a){var c=-1*a;P(b.registerA,c);Ua(b.registerA,c);b.registerA=b.registerA-a&255;0===b.registerA?m(1):m(0);v(1)}function fa(a){var c=b.registerA-a-R()&255;0!=((b.registerA^a^c)&16)?B(1):
B(0);0<(b.registerA-a-R()&256)?t(1):t(0);b.registerA=c;0===b.registerA?m(1):m(0);v(1)}function ha(a){b.registerA&=a;0===b.registerA?m(1):m(0);v(0);B(1);t(0)}function ia(a){b.registerA=(b.registerA^a)&255;0===b.registerA?m(1):m(0);v(0);B(0);t(0)}function ja(a){b.registerA|=a;0===b.registerA?m(1):m(0);v(0);B(0);t(0)}function ka(a){a*=-1;P(b.registerA,a);Ua(b.registerA,a);0===b.registerA+a?m(1):m(0);v(1)}function oa(a,b){0===(b&1<<a)?m(1):m(0);v(0);B(1);return b}function W(a,b,f){return 0<b?f|1<<a:f&
~(1<<a)}function Da(a){a=Ta(a);b.programCounter=b.programCounter+a&65535;b.programCounter=b.programCounter+1&65535}function Bb(a){b.programCounter=b.programCounter+1&65535;b.isHaltBug&&(b.programCounter=b.programCounter-1&65535);switch((a&240)>>4){case 0:return Db(a);case 1:return Eb(a);case 2:return Fb(a);case 3:return Gb(a);case 4:return Hb(a);case 5:return Ib(a);case 6:return Jb(a);case 7:return Kb(a);case 8:return Lb(a);case 9:return Mb(a);case 10:return Nb(a);case 11:return Ob(a);case 12:return Pb(a);
case 13:return Qb(a);case 14:return Rb(a);default:return Sb(a)}}function H(a){la(4);return fb(a)}function Q(a,b){la(4);Pa(a,b)&&e(a,b)}function Z(a){la(8);var b=ib(a);switch(b){case -1:b=w(a)}a+=1;var f=ib(a);switch(f){case -1:a=w(a);break;default:a=f}return l(a,b)}function S(a,b){la(8);var c=A(b);b&=255;var d=a+1;Pa(a,b)&&e(a,b);Pa(d,c)&&e(d,c)}function E(){la(4);return w(b.programCounter)}function V(){la(4);var a=w(b.programCounter+1&65535);return l(a,E())}function Db(a){switch(a){case 0:return 4;
case 1:return a=V(),b.registerB=A(a),b.registerC=a&255,b.programCounter=b.programCounter+2&65535,4;case 2:return Q(l(b.registerB,b.registerC),b.registerA),4;case 3:return a=l(b.registerB,b.registerC),a++,b.registerB=A(a),b.registerC=a&255,8;case 4:return P(b.registerB,1),b.registerB=b.registerB+1&255,0===b.registerB?m(1):m(0),v(0),4;case 5:return P(b.registerB,-1),b.registerB=b.registerB-1&255,0===b.registerB?m(1):m(0),v(1),4;case 6:return b.registerB=E(),b.programCounter=b.programCounter+1&65535,
4;case 7:return 128===(b.registerA&128)?t(1):t(0),a=b.registerA,b.registerA=(a<<1|a>>7)&255,m(0),v(0),B(0),4;case 8:return S(V(),b.stackPointer),b.programCounter=b.programCounter+2&65535,4;case 9:a=l(b.registerH,b.registerL);var c=l(b.registerB,b.registerC);pa(a,c,!1);a=a+c&65535;b.registerH=A(a);b.registerL=a&255;v(0);return 8;case 10:return b.registerA=H(l(b.registerB,b.registerC)),4;case 11:return a=l(b.registerB,b.registerC),a=a-1&65535,b.registerB=A(a),b.registerC=a&255,8;case 12:return P(b.registerC,
1),b.registerC=b.registerC+1&255,0===b.registerC?m(1):m(0),v(0),4;case 13:return P(b.registerC,-1),b.registerC=b.registerC-1&255,0===b.registerC?m(1):m(0),v(1),4;case 14:return b.registerC=E(),b.programCounter=b.programCounter+1&65535,4;case 15:return 0<(b.registerA&1)?t(1):t(0),a=b.registerA,b.registerA=(a>>1|a<<7)&255,m(0),v(0),B(0),4}return-1}function Eb(a){switch(a){case 16:if(b.GBCEnabled&&(a=H(b.memoryLocationSpeedSwitch),n(0,a)))return a=F(0,a),n(7,a)?(b.GBCDoubleSpeed=!1,a=F(7,a)):(b.GBCDoubleSpeed=
!0,a|=128),Q(b.memoryLocationSpeedSwitch,a),68;b.isStopped=!0;b.programCounter=b.programCounter+1&65535;return 4;case 17:return a=V(),b.registerD=A(a),b.registerE=a&255,b.programCounter=b.programCounter+2&65535,4;case 18:return Q(l(b.registerD,b.registerE),b.registerA),4;case 19:return a=l(b.registerD,b.registerE),a=a+1&65535,b.registerD=A(a),b.registerE=a&255,8;case 20:return P(b.registerD,1),b.registerD=b.registerD+1&255,0===b.registerD?m(1):m(0),v(0),4;case 21:return P(b.registerD,-1),b.registerD=
b.registerD-1&255,0===b.registerD?m(1):m(0),v(1),4;case 22:return b.registerD=E(),b.programCounter=b.programCounter+1&65535,4;case 23:return a=!1,128===(b.registerA&128)&&(a=!0),b.registerA=(b.registerA<<1|R())&255,a?t(1):t(0),m(0),v(0),B(0),4;case 24:return Da(E()),8;case 25:a=l(b.registerH,b.registerL);var c=l(b.registerD,b.registerE);pa(a,c,!1);a=a+c&65535;b.registerH=A(a);b.registerL=a&255;v(0);return 8;case 26:return a=l(b.registerD,b.registerE),b.registerA=H(a),4;case 27:return a=l(b.registerD,
b.registerE),a=a-1&65535,b.registerD=A(a),b.registerE=a&255,8;case 28:return P(b.registerE,1),b.registerE=b.registerE+1&255,0===b.registerE?m(1):m(0),v(0),4;case 29:return P(b.registerE,-1),b.registerE=b.registerE-1&255,0===b.registerE?m(1):m(0),v(1),4;case 30:return b.registerE=E(),b.programCounter=b.programCounter+1&65535,4;case 31:return a=!1,1===(b.registerA&1)&&(a=!0),b.registerA=(b.registerA>>1|R()<<7)&255,a?t(1):t(0),m(0),v(0),B(0),4}return-1}function Fb(a){switch(a){case 32:return 0===ma()?
Da(E()):b.programCounter=b.programCounter+1&65535,8;case 33:return a=V(),b.registerH=A(a),b.registerL=a&255,b.programCounter=b.programCounter+2&65535,4;case 34:return a=l(b.registerH,b.registerL),Q(a,b.registerA),a=a+1&65535,b.registerH=A(a),b.registerL=a&255,4;case 35:return a=l(b.registerH,b.registerL),a=a+1&65535,b.registerH=A(a),b.registerL=a&255,8;case 36:return P(b.registerH,1),b.registerH=b.registerH+1&255,0===b.registerH?m(1):m(0),v(0),4;case 37:return P(b.registerH,-1),b.registerH=b.registerH-
1&255,0===b.registerH?m(1):m(0),v(1),4;case 38:return b.registerH=E(),b.programCounter=b.programCounter+1&65535,4;case 39:var c=0;0<(b.registerF>>5&1)&&(c|=6);0<R()&&(c|=96);0<(b.registerF>>6&1)?a=b.registerA-c&255:(9<(b.registerA&15)&&(c|=6),153<b.registerA&&(c|=96),a=b.registerA+c&255);0===a?m(1):m(0);0!==(c&96)?t(1):t(0);B(0);b.registerA=a;return 4;case 40:return 0<ma()?Da(E()):b.programCounter=b.programCounter+1&65535,8;case 41:return a=l(b.registerH,b.registerL),pa(a,a,!1),a=2*a&65535,b.registerH=
A(a),b.registerL=a&255,v(0),8;case 42:return a=l(b.registerH,b.registerL),b.registerA=H(a),a=a+1&65535,b.registerH=A(a),b.registerL=a&255,4;case 43:return a=l(b.registerH,b.registerL),a=a-1&65535,b.registerH=A(a),b.registerL=a&255,8;case 44:return P(b.registerL,1),b.registerL=b.registerL+1&255,0===b.registerL?m(1):m(0),v(0),4;case 45:return P(b.registerL,-1),b.registerL=b.registerL-1&255,0===b.registerL?m(1):m(0),v(1),4;case 46:return b.registerL=E(),b.programCounter=b.programCounter+1&65535,4;case 47:return b.registerA=
~b.registerA,v(1),B(1),4}return-1}function Gb(a){switch(a){case 48:return 0===R()?Da(E()):b.programCounter=b.programCounter+1&65535,8;case 49:return b.stackPointer=V(),b.programCounter=b.programCounter+2&65535,4;case 50:return a=l(b.registerH,b.registerL),Q(a,b.registerA),a=a-1&65535,b.registerH=A(a),b.registerL=a&255,4;case 51:return b.stackPointer=b.stackPointer+1&65535,8;case 52:a=l(b.registerH,b.registerL);var c=H(a);P(c,1);c=c+1&255;0===c?m(1):m(0);v(0);Q(a,c);return 4;case 53:return a=l(b.registerH,
b.registerL),c=H(a),P(c,-1),c=c-1&255,0===c?m(1):m(0),v(1),Q(a,c),4;case 54:return Q(l(b.registerH,b.registerL),E()),b.programCounter=b.programCounter+1&65535,4;case 55:return v(0),B(0),t(1),4;case 56:return 1===R()?Da(E()):b.programCounter=b.programCounter+1&65535,8;case 57:return a=l(b.registerH,b.registerL),pa(a,b.stackPointer,!1),a=a+b.stackPointer&65535,b.registerH=A(a),b.registerL=a&255,v(0),8;case 58:return a=l(b.registerH,b.registerL),b.registerA=H(a),a=a-1&65535,b.registerH=A(a),b.registerL=
a&255,4;case 59:return b.stackPointer=b.stackPointer-1&65535,8;case 60:return P(b.registerA,1),b.registerA=b.registerA+1&255,0===b.registerA?m(1):m(0),v(0),4;case 61:return P(b.registerA,-1),b.registerA=b.registerA-1&255,0===b.registerA?m(1):m(0),v(1),4;case 62:return b.registerA=E(),b.programCounter=b.programCounter+1&65535,4;case 63:return v(0),B(0),0<R()?t(0):t(1),4}return-1}function Hb(a){switch(a){case 64:return 4;case 65:return b.registerB=b.registerC,4;case 66:return b.registerB=b.registerD,
4;case 67:return b.registerB=b.registerE,4;case 68:return b.registerB=b.registerH,4;case 69:return b.registerB=b.registerL,4;case 70:return b.registerB=H(l(b.registerH,b.registerL)),4;case 71:return b.registerB=b.registerA,4;case 72:return b.registerC=b.registerB,4;case 73:return 4;case 74:return b.registerC=b.registerD,4;case 75:return b.registerC=b.registerE,4;case 76:return b.registerC=b.registerH,4;case 77:return b.registerC=b.registerL,4;case 78:return b.registerC=H(l(b.registerH,b.registerL)),
4;case 79:return b.registerC=b.registerA,4}return-1}function Ib(a){switch(a){case 80:return b.registerD=b.registerB,4;case 81:return b.registerD=b.registerC,4;case 82:return 4;case 83:return b.registerD=b.registerE,4;case 84:return b.registerD=b.registerH,4;case 85:return b.registerD=b.registerL,4;case 86:return b.registerD=H(l(b.registerH,b.registerL)),4;case 87:return b.registerD=b.registerA,4;case 88:return b.registerE=b.registerB,4;case 89:return b.registerE=b.registerC,4;case 90:return b.registerE=
b.registerD,4;case 91:return 4;case 92:return b.registerE=b.registerH,4;case 93:return b.registerE=b.registerL,4;case 94:return b.registerE=H(l(b.registerH,b.registerL)),4;case 95:return b.registerE=b.registerA,4}return-1}function Jb(a){switch(a){case 96:return b.registerH=b.registerB,4;case 97:return b.registerH=b.registerC,4;case 98:return b.registerH=b.registerD,4;case 99:return b.registerH=b.registerE,4;case 100:return b.registerH=b.registerH,4;case 101:return b.registerH=b.registerL,4;case 102:return b.registerH=
H(l(b.registerH,b.registerL)),4;case 103:return b.registerH=b.registerA,4;case 104:return b.registerL=b.registerB,4;case 105:return b.registerL=b.registerC,4;case 106:return b.registerL=b.registerD,4;case 107:return b.registerL=b.registerE,4;case 108:return b.registerL=b.registerH,4;case 109:return b.registerL=b.registerL,4;case 110:return b.registerL=H(l(b.registerH,b.registerL)),4;case 111:return b.registerL=b.registerA,4}return-1}function Kb(a){switch(a){case 112:return Q(l(b.registerH,b.registerL),
b.registerB),4;case 113:return Q(l(b.registerH,b.registerL),b.registerC),4;case 114:return Q(l(b.registerH,b.registerL),b.registerD),4;case 115:return Q(l(b.registerH,b.registerL),b.registerE),4;case 116:return Q(l(b.registerH,b.registerL),b.registerH),4;case 117:return Q(l(b.registerH,b.registerL),b.registerL),4;case 118:return d.isHblankHdmaActive||b.enableHalt(),4;case 119:return Q(l(b.registerH,b.registerL),b.registerA),4;case 120:return b.registerA=b.registerB,4;case 121:return b.registerA=b.registerC,
4;case 122:return b.registerA=b.registerD,4;case 123:return b.registerA=b.registerE,4;case 124:return b.registerA=b.registerH,4;case 125:return b.registerA=b.registerL,4;case 126:return b.registerA=H(l(b.registerH,b.registerL)),4;case 127:return 4}return-1}function Lb(a){switch(a){case 128:return ca(b.registerB),4;case 129:return ca(b.registerC),4;case 130:return ca(b.registerD),4;case 131:return ca(b.registerE),4;case 132:return ca(b.registerH),4;case 133:return ca(b.registerL),4;case 134:return a=
H(l(b.registerH,b.registerL)),ca(a),4;case 135:return ca(b.registerA),4;case 136:return da(b.registerB),4;case 137:return da(b.registerC),4;case 138:return da(b.registerD),4;case 139:return da(b.registerE),4;case 140:return da(b.registerH),4;case 141:return da(b.registerL),4;case 142:return a=H(l(b.registerH,b.registerL)),da(a),4;case 143:return da(b.registerA),4}return-1}function Mb(a){switch(a){case 144:return ea(b.registerB),4;case 145:return ea(b.registerC),4;case 146:return ea(b.registerD),4;
case 147:return ea(b.registerE),4;case 148:return ea(b.registerH),4;case 149:return ea(b.registerL),4;case 150:return a=H(l(b.registerH,b.registerL)),ea(a),4;case 151:return ea(b.registerA),4;case 152:return fa(b.registerB),4;case 153:return fa(b.registerC),4;case 154:return fa(b.registerD),4;case 155:return fa(b.registerE),4;case 156:return fa(b.registerH),4;case 157:return fa(b.registerL),4;case 158:return a=H(l(b.registerH,b.registerL)),fa(a),4;case 159:return fa(b.registerA),4}return-1}function Nb(a){switch(a){case 160:return ha(b.registerB),
4;case 161:return ha(b.registerC),4;case 162:return ha(b.registerD),4;case 163:return ha(b.registerE),4;case 164:return ha(b.registerH),4;case 165:return ha(b.registerL),4;case 166:return a=H(l(b.registerH,b.registerL)),ha(a),4;case 167:return ha(b.registerA),4;case 168:return ia(b.registerB),4;case 169:return ia(b.registerC),4;case 170:return ia(b.registerD),4;case 171:return ia(b.registerE),4;case 172:return ia(b.registerH),4;case 173:return ia(b.registerL),4;case 174:return a=H(l(b.registerH,b.registerL)),
ia(a),4;case 175:return ia(b.registerA),4}return-1}function Ob(a){switch(a){case 176:return ja(b.registerB),4;case 177:return ja(b.registerC),4;case 178:return ja(b.registerD),4;case 179:return ja(b.registerE),4;case 180:return ja(b.registerH),4;case 181:return ja(b.registerL),4;case 182:return a=H(l(b.registerH,b.registerL)),ja(a),4;case 183:return ja(b.registerA),4;case 184:return ka(b.registerB),4;case 185:return ka(b.registerC),4;case 186:return ka(b.registerD),4;case 187:return ka(b.registerE),
4;case 188:return ka(b.registerH),4;case 189:return ka(b.registerL),4;case 190:return a=H(l(b.registerH,b.registerL)),ka(a),4;case 191:return ka(b.registerA),4}return-1}function Pb(a){switch(a){case 192:return 0===ma()?(b.programCounter=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 193:return a=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerB=A(a),b.registerC=a&255,4;case 194:if(0===ma())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;
return 12;case 195:return b.programCounter=V(),8;case 196:if(0===ma())return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 197:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,l(b.registerB,b.registerC)),8;case 198:return ca(E()),b.programCounter=b.programCounter+1&65535,4;case 199:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=
0,8;case 200:return 1===ma()?(b.programCounter=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 201:return b.programCounter=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,8;case 202:if(1===ma())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 203:var c=E();a=-1;var f=!1,d=0,e=0,h=c%8;switch(h){case 0:d=b.registerB;break;case 1:d=b.registerC;break;case 2:d=b.registerD;break;case 3:d=b.registerE;break;case 4:d=b.registerH;break;case 5:d=
b.registerL;break;case 6:d=H(l(b.registerH,b.registerL));break;case 7:d=b.registerA}var n=(c&240)>>4;switch(n){case 0:7>=c?(c=d,128===(c&128)?t(1):t(0),c=(c<<1|c>>7)&255,0===c?m(1):m(0),v(0),B(0),e=c,f=!0):15>=c&&(c=d,0<(c&1)?t(1):t(0),c=(c>>1|c<<7)&255,0===c?m(1):m(0),v(0),B(0),e=c,f=!0);break;case 1:23>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=(c<<1|R())&255,f?t(1):t(0),0===c?m(1):m(0),v(0),B(0),e=c,f=!0):31>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=(c>>1|R()<<7)&255,f?t(1):t(0),0===c?m(1):m(0),v(0),B(0),e=
c,f=!0);break;case 2:39>=c?(c=d,f=!1,128===(c&128)&&(f=!0),c=c<<1&255,f?t(1):t(0),0===c?m(1):m(0),v(0),B(0),e=c,f=!0):47>=c&&(c=d,f=!1,128===(c&128)&&(f=!0),d=!1,1===(c&1)&&(d=!0),c=c>>1&255,f&&(c|=128),0===c?m(1):m(0),v(0),B(0),d?t(1):t(0),e=c,f=!0);break;case 3:55>=c?(c=d,c=((c&15)<<4|(c&240)>>4)&255,0===c?m(1):m(0),v(0),B(0),t(0),e=c,f=!0):63>=c&&(c=d,f=!1,1===(c&1)&&(f=!0),c=c>>1&255,0===c?m(1):m(0),v(0),B(0),f?t(1):t(0),e=c,f=!0);break;case 4:71>=c?(e=oa(0,d),f=!0):79>=c&&(e=oa(1,d),f=!0);break;
case 5:87>=c?(e=oa(2,d),f=!0):95>=c&&(e=oa(3,d),f=!0);break;case 6:103>=c?(e=oa(4,d),f=!0):111>=c&&(e=oa(5,d),f=!0);break;case 7:119>=c?(e=oa(6,d),f=!0):127>=c&&(e=oa(7,d),f=!0);break;case 8:135>=c?(e=W(0,0,d),f=!0):143>=c&&(e=W(1,0,d),f=!0);break;case 9:151>=c?(e=W(2,0,d),f=!0):159>=c&&(e=W(3,0,d),f=!0);break;case 10:167>=c?(e=W(4,0,d),f=!0):175>=c&&(e=W(5,0,d),f=!0);break;case 11:183>=c?(e=W(6,0,d),f=!0):191>=c&&(e=W(7,0,d),f=!0);break;case 12:199>=c?(e=W(0,1,d),f=!0):207>=c&&(e=W(1,1,d),f=!0);
break;case 13:215>=c?(e=W(2,1,d),f=!0):223>=c&&(e=W(3,1,d),f=!0);break;case 14:231>=c?(e=W(4,1,d),f=!0):239>=c&&(e=W(5,1,d),f=!0);break;case 15:247>=c?(e=W(6,1,d),f=!0):255>=c&&(e=W(7,1,d),f=!0)}switch(h){case 0:b.registerB=e;break;case 1:b.registerC=e;break;case 2:b.registerD=e;break;case 3:b.registerE=e;break;case 4:b.registerH=e;break;case 5:b.registerL=e;break;case 6:(4>n||7<n)&&Q(l(b.registerH,b.registerL),e);break;case 7:b.registerA=e}f&&(a=4);b.programCounter=b.programCounter+1&65535;return a;
case 204:if(1===ma())return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter+2),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 205:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;case 206:return da(E()),b.programCounter=b.programCounter+1&65535,4;case 207:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=8}return-1}function Qb(a){switch(a){case 208:return 0===
R()?(b.programCounter=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 209:return a=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerD=A(a),b.registerE=a&255,4;case 210:if(0===R())return b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 212:if(0===R())return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter+2),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 213:return b.stackPointer=
b.stackPointer-2&65535,S(b.stackPointer,l(b.registerD,b.registerE)),8;case 214:return ea(E()),b.programCounter=b.programCounter+1&65535,4;case 215:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=16,8;case 216:return 1===R()?(b.programCounter=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,12):8;case 217:return b.programCounter=Z(b.stackPointer),Oa(!0),b.stackPointer=b.stackPointer+2&65535,8;case 218:if(1===R())return b.programCounter=V(),8;
b.programCounter=b.programCounter+2&65535;return 12;case 220:if(1===R())return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter+2&65535),b.programCounter=V(),8;b.programCounter=b.programCounter+2&65535;return 12;case 222:return fa(E()),b.programCounter=b.programCounter+1&65535,4;case 223:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=24,8}return-1}function Rb(a){switch(a){case 224:return a=E(),Q(65280+a,b.registerA),b.programCounter=
b.programCounter+1&65535,4;case 225:return a=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerH=A(a),b.registerL=a&255,4;case 226:return Q(65280+b.registerC,b.registerA),4;case 229:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,l(b.registerH,b.registerL)),8;case 230:return ha(E()),b.programCounter=b.programCounter+1&65535,4;case 231:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=32,8;case 232:return a=Ta(E()),pa(b.stackPointer,
a,!0),b.stackPointer=b.stackPointer+a&65535,m(0),v(0),b.programCounter=b.programCounter+1&65535,12;case 233:return b.programCounter=l(b.registerH,b.registerL),4;case 234:return Q(V(),b.registerA),b.programCounter=b.programCounter+2&65535,4;case 238:return ia(E()),b.programCounter=b.programCounter+1&65535,4;case 239:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=40,8}return-1}function Sb(a){switch(a){case 240:return a=E(),b.registerA=H(65280+a)&255,
b.programCounter=b.programCounter+1&65535,4;case 241:return a=Z(b.stackPointer),b.stackPointer=b.stackPointer+2&65535,b.registerA=A(a),b.registerF=a&255,4;case 242:return b.registerA=H(65280+b.registerC)&255,4;case 243:return Oa(!1),4;case 245:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,l(b.registerA,b.registerF)),8;case 246:return ja(E()),b.programCounter=b.programCounter+1&65535,4;case 247:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=
48,8;case 248:return a=Ta(E()),m(0),v(0),pa(b.stackPointer,a,!0),a=b.stackPointer+a&65535,b.registerH=A(a),b.registerL=a&255,b.programCounter=b.programCounter+1&65535,8;case 249:return b.stackPointer=l(b.registerH,b.registerL),8;case 250:return b.registerA=H(V()),b.programCounter=b.programCounter+2&65535,4;case 251:return Oa(!0),4;case 254:return ka(E()),b.programCounter=b.programCounter+1&65535,4;case 255:return b.stackPointer=b.stackPointer-2&65535,S(b.stackPointer,b.programCounter),b.programCounter=
56,8}return-1}function la(a){0<d.DMACycles&&(a+=d.DMACycles,d.DMACycles=0);b.currentCycles+=a;if(!b.isStopped){if(M.graphicsBatchProcessing){if(q.currentCycles+=a,!(q.currentCycles<q.batchProcessCycles()))for(;q.currentCycles>=q.batchProcessCycles();)Ab(q.batchProcessCycles()),q.currentCycles-=q.batchProcessCycles()}else Ab(a);M.audioBatchProcessing?h.currentCycles+=a:sb(a);var c=a;if(K.transferStartFlag)for(var f=0;f<c;){var g=K.currentCycles;f+=4;K.currentCycles+=4;65535<K.currentCycles&&(K.currentCycles-=
65536);var m=K.currentCycles;var l=K.isClockSpeedFast?2:7;n(l,g)&&!n(l,m)&&(g=w(K.memoryLocationSerialTransferData),g=(g<<1)+1,g&=255,e(K.memoryLocationSerialTransferData,g),K.numberOfBitsTransferred+=1,8===K.numberOfBitsTransferred&&(K.numberOfBitsTransferred=0,k.isSerialInterruptRequested=!0,va(k.bitPositionSerialInterrupt),g=w(K.memoryLocationSerialTransferControl),e(K.memoryLocationSerialTransferControl,F(7,g)),K.transferStartFlag=!1))}}M.timersBatchProcessing?(p.currentCycles+=a,cb(p.currentCycles),
p.currentCycles=0):cb(a);T.cycles+=a;T.cycles>=T.cyclesPerCycleSet&&(T.cycleSets+=1,T.cycles-=T.cyclesPerCycleSet)}function jb(){return Ea(!0,-1,-1)}function Ea(a,c,f){void 0===c&&(c=-1);void 0===f&&(f=-1);a=1024;0<c?a=c:0>c&&(a=-1);for(var d=!1,e=!1,g=!1,h=!1;!(d||e||g||h);)c=kb(),0>c?d=!0:b.currentCycles>=b.MAX_CYCLES_PER_FRAME()?e=!0:-1<a&&ab()>=a?g=!0:-1<f&&b.programCounter===f&&(h=!0);if(e)return b.currentCycles-=b.MAX_CYCLES_PER_FRAME(),L.RESPONSE_CONDITION_FRAME;if(g)return L.RESPONSE_CONDITION_AUDIO;
if(h)return L.RESPONSE_CONDITION_BREAKPOINT;b.programCounter=b.programCounter-1&65535;return-1}function kb(){Fa=!0;if(b.isHaltBug){var a=w(b.programCounter);a=Bb(a);la(a);b.exitHaltAndStop()}k.masterInterruptSwitchDelay&&(k.masterInterruptSwitch=!0,k.masterInterruptSwitchDelay=!1);if(0<(k.interruptsEnabledValue&k.interruptsRequestedValue&31)){a=!1;k.masterInterruptSwitch&&!b.isHaltNoJump&&(k.isVBlankInterruptEnabled&&k.isVBlankInterruptRequested?(Aa(k.bitPositionVBlankInterrupt),a=!0):k.isLcdInterruptEnabled&&
k.isLcdInterruptRequested?(Aa(k.bitPositionLcdInterrupt),a=!0):k.isTimerInterruptEnabled&&k.isTimerInterruptRequested?(Aa(k.bitPositionTimerInterrupt),a=!0):k.isSerialInterruptEnabled&&k.isSerialInterruptRequested?(Aa(k.bitPositionSerialInterrupt),a=!0):k.isJoypadInterruptEnabled&&k.isJoypadInterruptRequested&&(Aa(k.bitPositionJoypadInterrupt),a=!0));var c=0;a&&(c=20,b.isHalted()&&(b.exitHaltAndStop(),c+=4));b.isHalted()&&b.exitHaltAndStop();a=c}else a=0;0<a&&la(a);a=4;b.isHalted()||b.isStopped||
(a=w(b.programCounter),a=Bb(a));b.registerF&=240;if(0>=a)return a;la(a);L.steps+=1;L.steps>=L.stepsPerStepSet&&(L.stepSets+=1,L.steps-=L.stepsPerStepSet);return a}const g=new Uint8ClampedArray(9109504),Ga={size:()=>9109504,grow:()=>{},wasmByteMemory:g};var wa=91264,Ha=wa+93184,Ra=Ha+196608,Sa=Ra+147456,xb=Sa-67584+15360,Xa=Sa+15360,Ya=Xa+131072,Za=Ya+131072,$a=Za+131072,za=$a+131072,Qa=za+131072,Ca=Qa+131072,lb=Ca+8258560,mb=lb+65535+1,nb=Math.ceil(mb/1024/64)+1,M=function(){function a(){}a.enableBootRom=
!1;a.useGbcWhenAvailable=!0;a.audioBatchProcessing=!1;a.graphicsBatchProcessing=!1;a.timersBatchProcessing=!1;a.graphicsDisableScanlineRendering=!1;a.audioAccumulateSamples=!1;a.tileRendering=!1;a.tileCaching=!1;a.enableAudioDebugging=!1;return a}(),Ba=function(){function a(){}a.memoryLocationBackgroundPaletteIndex=65384;a.memoryLocationBackgroundPaletteData=65385;a.memoryLocationSpritePaletteIndex=65386;a.memoryLocationSpritePaletteData=65387;return a}(),ba=function(){function a(){}a.tileId=-1;a.horizontalFlip=
!1;a.nextXIndexToPerformCacheCheck=-1;return a}(),u=function(){function a(){}a.updateNRx0=function(b){a.NRx0SweepPeriod=(b&112)>>4;a.NRx0Negate=n(3,b);a.NRx0SweepShift=b&7};a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};
a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){N(1024+50*a.saveStateSlot,a.isEnabled);g[1025+50*a.saveStateSlot]=a.frequencyTimer;g[1029+50*a.saveStateSlot]=a.envelopeCounter;g[1033+50*a.saveStateSlot]=a.lengthCounter;g[1038+50*a.saveStateSlot]=a.volume;g[1043+50*a.saveStateSlot]=a.dutyCycle;g[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty;N(1049+50*a.saveStateSlot,a.isSweepEnabled);g[1050+
50*a.saveStateSlot]=a.sweepCounter;g[1055+50*a.saveStateSlot]=a.sweepShadowFrequency};a.loadState=function(){a.isEnabled=O(1024+50*a.saveStateSlot);a.frequencyTimer=g[1025+50*a.saveStateSlot];a.envelopeCounter=g[1029+50*a.saveStateSlot];a.lengthCounter=g[1033+50*a.saveStateSlot];a.volume=g[1038+50*a.saveStateSlot];a.dutyCycle=g[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=g[1044+50*a.saveStateSlot];a.isSweepEnabled=O(1049+50*a.saveStateSlot);a.sweepCounter=g[1050+50*a.saveStateSlot];a.sweepShadowFrequency=
g[1055+50*a.saveStateSlot]};a.initialize=function(){e(a.memoryLocationNRx0,128);e(a.memoryLocationNRx1,191);e(a.memoryLocationNRx2,243);e(a.memoryLocationNRx3,193);e(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),
a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;pb(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.sweepShadowFrequency=a.frequency;a.sweepCounter=a.NRx0SweepPeriod;a.isSweepEnabled=0<a.NRx0SweepPeriod&&
0<a.NRx0SweepShift?!0:!1;0<a.NRx0SweepShift&&qb();a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateSweep=function(){--a.sweepCounter;0>=a.sweepCounter&&(a.sweepCounter=a.NRx0SweepPeriod,a.isSweepEnabled&&0<a.NRx0SweepPeriod&&qb())};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&
(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=b>>8;b&=255;var d=w(a.memoryLocationNRx4)&248|c;e(a.memoryLocationNRx3,b);e(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx0=65296;a.NRx0SweepPeriod=0;a.NRx0Negate=!1;a.NRx0SweepShift=0;a.memoryLocationNRx1=
65297;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65298;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65299;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65300;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=1;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.isSweepEnabled=!1;a.sweepCounter=0;a.sweepShadowFrequency=0;a.saveStateSlot=
7;return a}(),I=function(){function a(){}a.updateNRx1=function(b){a.NRx1Duty=b>>6&3;a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};
a.saveState=function(){N(1024+50*a.saveStateSlot,a.isEnabled);g[1025+50*a.saveStateSlot]=a.frequencyTimer;g[1029+50*a.saveStateSlot]=a.envelopeCounter;g[1033+50*a.saveStateSlot]=a.lengthCounter;g[1038+50*a.saveStateSlot]=a.volume;g[1043+50*a.saveStateSlot]=a.dutyCycle;g[1044+50*a.saveStateSlot]=a.waveFormPositionOnDuty};a.loadState=function(){a.isEnabled=O(1024+50*a.saveStateSlot);a.frequencyTimer=g[1025+50*a.saveStateSlot];a.envelopeCounter=g[1029+50*a.saveStateSlot];a.lengthCounter=g[1033+50*a.saveStateSlot];
a.volume=g[1038+50*a.saveStateSlot];a.dutyCycle=g[1043+50*a.saveStateSlot];a.waveFormPositionOnDuty=g[1044+50*a.saveStateSlot]};a.initialize=function(){e(a.memoryLocationNRx1-1,255);e(a.memoryLocationNRx1,63);e(a.memoryLocationNRx2,0);e(a.memoryLocationNRx3,0);e(a.memoryLocationNRx4,184)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=4*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=
function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=b,a.waveFormPositionOnDuty+=1,8<=a.waveFormPositionOnDuty&&(a.waveFormPositionOnDuty=0));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=1;pb(a.NRx1Duty,a.waveFormPositionOnDuty)||(c*=-1);return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.resetTimer();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.isDacEnabled||
(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&0<a.volume&&--a.volume))};a.setFrequency=function(b){var c=
b>>8;b&=255;var d=w(a.memoryLocationNRx4)&248|c;e(a.memoryLocationNRx3,b);e(a.memoryLocationNRx4,d);a.NRx3FrequencyLSB=b;a.NRx4FrequencyMSB=c;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.cycleCounter=0;a.memoryLocationNRx1=65302;a.NRx1Duty=0;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65303;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65304;a.NRx3FrequencyLSB=0;a.memoryLocationNRx4=65305;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.channelNumber=
2;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.dutyCycle=0;a.waveFormPositionOnDuty=0;a.saveStateSlot=8;return a}(),G=function(){function a(){}a.updateNRx0=function(b){a.isDacEnabled=n(7,b)};a.updateNRx1=function(b){a.NRx1LengthLoad=b;a.lengthCounter=256-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2VolumeCode=b>>5&15};a.updateNRx3=function(b){a.NRx3FrequencyLSB=b;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.updateNRx4=
function(b){a.NRx4LengthEnabled=n(6,b);a.NRx4FrequencyMSB=b&7;a.frequency=a.NRx4FrequencyMSB<<8|a.NRx3FrequencyLSB};a.saveState=function(){N(1024+50*a.saveStateSlot,a.isEnabled);g[1025+50*a.saveStateSlot]=a.frequencyTimer;g[1029+50*a.saveStateSlot]=a.lengthCounter;g[1033+50*a.saveStateSlot]=a.waveTablePosition};a.loadState=function(){a.isEnabled=O(1024+50*a.saveStateSlot);a.frequencyTimer=g[1025+50*a.saveStateSlot];a.lengthCounter=g[1029+50*a.saveStateSlot];a.waveTablePosition=g[1033+50*a.saveStateSlot]};
a.initialize=function(){e(a.memoryLocationNRx0,127);e(a.memoryLocationNRx1,255);e(a.memoryLocationNRx2,159);e(a.memoryLocationNRx3,0);e(a.memoryLocationNRx4,184);a.volumeCodeChanged=!0};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.resetTimer=function(){a.frequencyTimer=2*(2048-a.frequency);b.GBCDoubleSpeed&&(a.frequencyTimer*=2)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.resetTimer(),a.frequencyTimer-=
b,a.waveTablePosition+=1,32<=a.waveTablePosition&&(a.waveTablePosition=0));b=0;var c=a.volumeCode;if(a.isEnabled&&a.isDacEnabled)a.volumeCodeChanged&&(c=w(a.memoryLocationNRx2),c=c>>5&15,a.volumeCode=c,a.volumeCodeChanged=!1);else return 15;var d=w(a.memoryLocationWaveTable+(a.waveTablePosition/2|0));d=0===a.waveTablePosition%2?d>>4&15:d&15;switch(c){case 0:d>>=4;break;case 1:b=1;break;case 2:d>>=1;b=2;break;default:d>>=2,b=4}return(0<b?d/b:0)+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&
(a.lengthCounter=256);a.resetTimer();a.waveTablePosition=0;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter&&!a.volumeCodeChanged?!1:!0};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.cycleCounter=0;a.memoryLocationNRx0=65306;a.memoryLocationNRx1=65307;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65308;a.NRx2VolumeCode=0;a.memoryLocationNRx3=65309;a.NRx3FrequencyLSB=
0;a.memoryLocationNRx4=65310;a.NRx4LengthEnabled=!1;a.NRx4FrequencyMSB=0;a.memoryLocationWaveTable=65328;a.channelNumber=3;a.isEnabled=!1;a.isDacEnabled=!1;a.frequency=0;a.frequencyTimer=0;a.lengthCounter=0;a.waveTablePosition=0;a.volumeCode=0;a.volumeCodeChanged=!1;a.saveStateSlot=9;return a}(),J=function(){function a(){}a.updateNRx1=function(b){a.NRx1LengthLoad=b&63;a.lengthCounter=64-a.NRx1LengthLoad};a.updateNRx2=function(b){a.NRx2StartingVolume=b>>4&15;a.NRx2EnvelopeAddMode=n(3,b);a.NRx2EnvelopePeriod=
b&7;a.isDacEnabled=0<(b&248)};a.updateNRx3=function(b){a.NRx3ClockShift=b>>4;a.NRx3WidthMode=n(3,b);a.NRx3DivisorCode=b&7;switch(a.NRx3DivisorCode){case 0:a.divisor=8;break;case 1:a.divisor=16;break;case 2:a.divisor=32;break;case 3:a.divisor=48;break;case 4:a.divisor=64;break;case 5:a.divisor=80;break;case 6:a.divisor=96;break;case 7:a.divisor=112}};a.updateNRx4=function(b){a.NRx4LengthEnabled=n(6,b)};a.saveState=function(){N(1024+50*a.saveStateSlot,a.isEnabled);g[1025+50*a.saveStateSlot]=a.frequencyTimer;
g[1029+50*a.saveStateSlot]=a.envelopeCounter;g[1033+50*a.saveStateSlot]=a.lengthCounter;g[1038+50*a.saveStateSlot]=a.volume;g[1043+50*a.saveStateSlot]=a.linearFeedbackShiftRegister};a.loadState=function(){a.isEnabled=O(1024+50*a.saveStateSlot);a.frequencyTimer=g[1025+50*a.saveStateSlot];a.envelopeCounter=g[1029+50*a.saveStateSlot];a.lengthCounter=g[1033+50*a.saveStateSlot];a.volume=g[1038+50*a.saveStateSlot];a.linearFeedbackShiftRegister=g[1043+50*a.saveStateSlot]};a.initialize=function(){e(a.memoryLocationNRx1-
1,255);e(a.memoryLocationNRx1,255);e(a.memoryLocationNRx2,0);e(a.memoryLocationNRx3,0);e(a.memoryLocationNRx4,191)};a.getSampleFromCycleCounter=function(){var b=a.cycleCounter;a.cycleCounter=0;return a.getSample(b)};a.getSample=function(b){a.frequencyTimer-=b;0>=a.frequencyTimer&&(b=Math.abs(a.frequencyTimer),a.frequencyTimer=a.getNoiseChannelFrequencyPeriod(),a.frequencyTimer-=b,b=a.linearFeedbackShiftRegister&1^a.linearFeedbackShiftRegister>>1&1,a.linearFeedbackShiftRegister>>=1,a.linearFeedbackShiftRegister|=
b<<14,a.NRx3WidthMode&&(a.linearFeedbackShiftRegister&=-65,a.linearFeedbackShiftRegister|=b<<6));if(a.isEnabled&&a.isDacEnabled)b=a.volume;else return 15;var c=n(0,a.linearFeedbackShiftRegister)?-1:1;return c*b+15};a.trigger=function(){a.isEnabled=!0;0===a.lengthCounter&&(a.lengthCounter=64);a.frequencyTimer=a.getNoiseChannelFrequencyPeriod();a.envelopeCounter=a.NRx2EnvelopePeriod;a.volume=a.NRx2StartingVolume;a.linearFeedbackShiftRegister=32767;a.isDacEnabled||(a.isEnabled=!1)};a.willChannelUpdate=
function(b){a.cycleCounter+=b;return 0<a.frequencyTimer-a.cycleCounter?!1:!0};a.getNoiseChannelFrequencyPeriod=function(){var c=a.divisor<<a.NRx3ClockShift;b.GBCDoubleSpeed&&(c*=2);return c};a.updateLength=function(){0<a.lengthCounter&&a.NRx4LengthEnabled&&--a.lengthCounter;0===a.lengthCounter&&(a.isEnabled=!1)};a.updateEnvelope=function(){--a.envelopeCounter;0>=a.envelopeCounter&&(a.envelopeCounter=a.NRx2EnvelopePeriod,0!==a.envelopeCounter&&(a.NRx2EnvelopeAddMode&&15>a.volume?a.volume+=1:!a.NRx2EnvelopeAddMode&&
0<a.volume&&--a.volume))};a.cycleCounter=0;a.memoryLocationNRx1=65312;a.NRx1LengthLoad=0;a.memoryLocationNRx2=65313;a.NRx2StartingVolume=0;a.NRx2EnvelopeAddMode=!1;a.NRx2EnvelopePeriod=0;a.memoryLocationNRx3=65314;a.NRx3ClockShift=0;a.NRx3WidthMode=!1;a.NRx3DivisorCode=0;a.memoryLocationNRx4=65315;a.NRx4LengthEnabled=!1;a.channelNumber=4;a.isEnabled=!1;a.isDacEnabled=!1;a.frequencyTimer=0;a.envelopeCounter=0;a.lengthCounter=0;a.volume=0;a.divisor=0;a.linearFeedbackShiftRegister=0;a.saveStateSlot=
10;return a}(),r=function(){function a(){}a.channel1Sample=15;a.channel2Sample=15;a.channel3Sample=15;a.channel4Sample=15;a.channel1DacEnabled=!1;a.channel2DacEnabled=!1;a.channel3DacEnabled=!1;a.channel4DacEnabled=!1;a.leftChannelSampleUnsignedByte=127;a.rightChannelSampleUnsignedByte=127;a.mixerVolumeChanged=!1;a.mixerEnabledChanged=!1;a.needToRemixSamples=!1;return a}(),h=function(){function a(){}a.batchProcessCycles=function(){return b.GBCDoubleSpeed?174:87};a.updateNR50=function(b){a.NR50LeftMixerVolume=
b>>4&7;a.NR50RightMixerVolume=b&7};a.updateNR51=function(b){a.NR51IsChannel4EnabledOnLeftOutput=n(7,b);a.NR51IsChannel3EnabledOnLeftOutput=n(6,b);a.NR51IsChannel2EnabledOnLeftOutput=n(5,b);a.NR51IsChannel1EnabledOnLeftOutput=n(4,b);a.NR51IsChannel4EnabledOnRightOutput=n(3,b);a.NR51IsChannel3EnabledOnRightOutput=n(2,b);a.NR51IsChannel2EnabledOnRightOutput=n(1,b);a.NR51IsChannel1EnabledOnRightOutput=n(0,b)};a.updateNR52=function(b){a.NR52IsSoundEnabled=n(7,b)};a.maxFrameSequenceCycles=function(){return b.GBCDoubleSpeed?
16384:8192};a.maxDownSampleCycles=function(){return b.CLOCK_SPEED()};a.saveState=function(){g[1024+50*a.saveStateSlot]=a.frameSequenceCycleCounter;g[1028+50*a.saveStateSlot]=a.downSampleCycleCounter;g[1029+50*a.saveStateSlot]=a.frameSequencer};a.loadState=function(){a.frameSequenceCycleCounter=g[1024+50*a.saveStateSlot];a.downSampleCycleCounter=g[1028+50*a.saveStateSlot];a.frameSequencer=g[1029+50*a.saveStateSlot];bb()};a.currentCycles=0;a.memoryLocationNR50=65316;a.NR50LeftMixerVolume=0;a.NR50RightMixerVolume=
0;a.memoryLocationNR51=65317;a.NR51IsChannel1EnabledOnLeftOutput=!0;a.NR51IsChannel2EnabledOnLeftOutput=!0;a.NR51IsChannel3EnabledOnLeftOutput=!0;a.NR51IsChannel4EnabledOnLeftOutput=!0;a.NR51IsChannel1EnabledOnRightOutput=!0;a.NR51IsChannel2EnabledOnRightOutput=!0;a.NR51IsChannel3EnabledOnRightOutput=!0;a.NR51IsChannel4EnabledOnRightOutput=!0;a.memoryLocationNR52=65318;a.NR52IsSoundEnabled=!0;a.memoryLocationChannel3LoadRegisterStart=65328;a.frameSequenceCycleCounter=0;a.downSampleCycleCounter=0;
a.downSampleCycleMultiplier=48E3;a.frameSequencer=0;a.audioQueueIndex=0;a.wasmBoyMemoryMaxBufferSize=131072;a.saveStateSlot=6;return a}(),k=function(){function a(){}a.updateInterruptEnabled=function(b){a.isVBlankInterruptEnabled=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptEnabled=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptEnabled=n(a.bitPositionTimerInterrupt,b);a.isSerialInterruptEnabled=n(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptEnabled=n(a.bitPositionJoypadInterrupt,b);a.interruptsEnabledValue=
b};a.updateInterruptRequested=function(b){a.isVBlankInterruptRequested=n(a.bitPositionVBlankInterrupt,b);a.isLcdInterruptRequested=n(a.bitPositionLcdInterrupt,b);a.isTimerInterruptRequested=n(a.bitPositionTimerInterrupt,b);a.isSerialInterruptRequested=n(a.bitPositionSerialInterrupt,b);a.isJoypadInterruptRequested=n(a.bitPositionJoypadInterrupt,b);a.interruptsRequestedValue=b};a.areInterruptsPending=function(){return 0<(a.interruptsRequestedValue&a.interruptsEnabledValue&31)};a.saveState=function(){N(1024+
50*a.saveStateSlot,a.masterInterruptSwitch);N(1025+50*a.saveStateSlot,a.masterInterruptSwitchDelay)};a.loadState=function(){a.masterInterruptSwitch=O(1024+50*a.saveStateSlot);a.masterInterruptSwitchDelay=O(1025+50*a.saveStateSlot);a.updateInterruptEnabled(w(a.memoryLocationInterruptEnabled));a.updateInterruptRequested(w(a.memoryLocationInterruptRequest))};a.masterInterruptSwitch=!1;a.masterInterruptSwitchDelay=!1;a.bitPositionVBlankInterrupt=0;a.bitPositionLcdInterrupt=1;a.bitPositionTimerInterrupt=
2;a.bitPositionSerialInterrupt=3;a.bitPositionJoypadInterrupt=4;a.memoryLocationInterruptEnabled=65535;a.interruptsEnabledValue=0;a.isVBlankInterruptEnabled=!1;a.isLcdInterruptEnabled=!1;a.isTimerInterruptEnabled=!1;a.isSerialInterruptEnabled=!1;a.isJoypadInterruptEnabled=!1;a.memoryLocationInterruptRequest=65295;a.interruptsRequestedValue=0;a.isVBlankInterruptRequested=!1;a.isLcdInterruptRequested=!1;a.isTimerInterruptRequested=!1;a.isSerialInterruptRequested=!1;a.isJoypadInterruptRequested=!1;a.saveStateSlot=
2;return a}(),p=function(){function a(){}a.batchProcessCycles=function(){return 256};a.updateDividerRegister=function(b){b=a.dividerRegister;a.dividerRegister=0;e(a.memoryLocationDividerRegister,0);a.timerEnabled&&ub(b,a.dividerRegister)&&db()};a.updateTimerCounter=function(b){if(a.timerEnabled){if(a.timerCounterWasReset)return;a.timerCounterOverflowDelay&&(a.timerCounterOverflowDelay=!1)}a.timerCounter=b};a.updateTimerModulo=function(b){a.timerModulo=b;a.timerEnabled&&a.timerCounterWasReset&&(a.timerCounter=
a.timerModulo,a.timerCounterWasReset=!1)};a.updateTimerControl=function(b){var c=a.timerEnabled;a.timerEnabled=n(2,b);b&=3;if(!c){c=eb(a.timerInputClock);var d=eb(b);(a.timerEnabled?n(c,a.dividerRegister):n(c,a.dividerRegister)&&n(d,a.dividerRegister))&&db()}a.timerInputClock=b};a.saveState=function(){g[1024+50*a.saveStateSlot]=a.currentCycles;g[1028+50*a.saveStateSlot]=a.dividerRegister;N(1032+50*a.saveStateSlot,a.timerCounterOverflowDelay);N(1035+50*a.saveStateSlot,a.timerCounterWasReset);e(a.memoryLocationTimerCounter,
a.timerCounter)};a.loadState=function(){a.currentCycles=g[1024+50*a.saveStateSlot];a.dividerRegister=g[1028+50*a.saveStateSlot];a.timerCounterOverflowDelay=O(1032+50*a.saveStateSlot);a.timerCounterWasReset=O(1035+50*a.saveStateSlot);a.timerCounter=w(a.memoryLocationTimerCounter);a.timerModulo=w(a.memoryLocationTimerModulo);a.timerInputClock=w(a.memoryLocationTimerControl)};a.currentCycles=0;a.memoryLocationDividerRegister=65284;a.dividerRegister=0;a.memoryLocationTimerCounter=65285;a.timerCounter=
0;a.timerCounterOverflowDelay=!1;a.timerCounterWasReset=!1;a.timerCounterMask=0;a.memoryLocationTimerModulo=65286;a.timerModulo=0;a.memoryLocationTimerControl=65287;a.timerEnabled=!1;a.timerInputClock=0;a.saveStateSlot=5;return a}(),K=function(){function a(){}a.updateTransferControl=function(b){a.isShiftClockInternal=n(0,b);a.isClockSpeedFast=n(1,b);a.transferStartFlag=n(7,b);return!0};a.currentCycles=0;a.memoryLocationSerialTransferData=65281;a.memoryLocationSerialTransferControl=65282;a.numberOfBitsTransferred=
0;a.isShiftClockInternal=!1;a.isClockSpeedFast=!1;a.transferStartFlag=!1;return a}(),y=function(){function a(){}a.updateJoypad=function(b){a.joypadRegisterFlipped=b^255;a.isDpadType=n(4,a.joypadRegisterFlipped);a.isButtonType=n(5,a.joypadRegisterFlipped)};a.saveState=function(){};a.loadState=function(){a.updateJoypad(w(a.memoryLocationJoypadRegister))};a.up=!1;a.down=!1;a.left=!1;a.right=!1;a.a=!1;a.b=!1;a.select=!1;a.start=!1;a.memoryLocationJoypadRegister=65280;a.joypadRegisterFlipped=0;a.isDpadType=
!1;a.isButtonType=!1;a.saveStateSlot=3;return a}(),x=function(){function a(){}a.updateLcdStatus=function(b){var c=w(a.memoryLocationLcdStatus);b=b&248|c&7|128;e(a.memoryLocationLcdStatus,b)};a.updateLcdControl=function(b){var c=a.enabled;a.enabled=n(7,b);a.windowTileMapDisplaySelect=n(6,b);a.windowDisplayEnabled=n(5,b);a.bgWindowTileDataSelect=n(4,b);a.bgTileMapDisplaySelect=n(3,b);a.tallSpriteSize=n(2,b);a.spriteDisplayEnable=n(1,b);a.bgDisplayEnabled=n(0,b);c&&!a.enabled&&wb(!0);!c&&a.enabled&&
wb(!1)};a.memoryLocationLcdStatus=65345;a.currentLcdMode=0;a.memoryLocationCoincidenceCompare=65349;a.coincidenceCompare=0;a.memoryLocationLcdControl=65344;a.enabled=!0;a.windowTileMapDisplaySelect=!1;a.windowDisplayEnabled=!1;a.bgWindowTileDataSelect=!1;a.bgTileMapDisplaySelect=!1;a.tallSpriteSize=!1;a.spriteDisplayEnable=!1;a.bgDisplayEnabled=!1;return a}(),q=function(){function a(){}a.batchProcessCycles=function(){return a.MAX_CYCLES_PER_SCANLINE()};a.MAX_CYCLES_PER_SCANLINE=function(){return b.GBCDoubleSpeed?
153===a.scanlineRegister?8:912:153===a.scanlineRegister?4:456};a.MIN_CYCLES_SPRITES_LCD_MODE=function(){return b.GBCDoubleSpeed?752:376};a.MIN_CYCLES_TRANSFER_DATA_LCD_MODE=function(){return b.GBCDoubleSpeed?498:249};a.saveState=function(){g[1024+50*a.saveStateSlot]=a.scanlineCycleCounter;g[1028+50*a.saveStateSlot]=x.currentLcdMode;e(a.memoryLocationScanlineRegister,a.scanlineRegister)};a.loadState=function(){a.scanlineCycleCounter=g[1024+50*a.saveStateSlot];x.currentLcdMode=g[1028+50*a.saveStateSlot];
a.scanlineRegister=w(a.memoryLocationScanlineRegister);x.updateLcdControl(w(x.memoryLocationLcdControl))};a.currentCycles=0;a.scanlineCycleCounter=0;a.memoryLocationScanlineRegister=65348;a.scanlineRegister=0;a.memoryLocationDmaTransfer=65350;a.memoryLocationScrollX=65347;a.scrollX=0;a.memoryLocationScrollY=65346;a.scrollY=0;a.memoryLocationWindowX=65355;a.windowX=0;a.memoryLocationWindowY=65354;a.windowY=0;a.memoryLocationTileMapSelectZeroStart=38912;a.memoryLocationTileMapSelectOneStart=39936;a.memoryLocationTileDataSelectZeroStart=
34816;a.memoryLocationTileDataSelectOneStart=32768;a.memoryLocationSpriteAttributesTable=65024;a.memoryLocationBackgroundPalette=65351;a.memoryLocationSpritePaletteOne=65352;a.memoryLocationSpritePaletteTwo=65353;a.saveStateSlot=1;return a}(),d=function(){function a(){}a.saveState=function(){g[1024+50*a.saveStateSlot]=a.currentRomBank;g[1026+50*a.saveStateSlot]=a.currentRamBank;N(1028+50*a.saveStateSlot,a.isRamBankingEnabled);N(1029+50*a.saveStateSlot,a.isMBC1RomModeEnabled);N(1030+50*a.saveStateSlot,
a.isRomOnly);N(1031+50*a.saveStateSlot,a.isMBC1);N(1032+50*a.saveStateSlot,a.isMBC2);N(1033+50*a.saveStateSlot,a.isMBC3);N(1034+50*a.saveStateSlot,a.isMBC5)};a.loadState=function(){a.currentRomBank=g[1024+50*a.saveStateSlot];a.currentRamBank=g[1026+50*a.saveStateSlot];a.isRamBankingEnabled=O(1028+50*a.saveStateSlot);a.isMBC1RomModeEnabled=O(1029+50*a.saveStateSlot);a.isRomOnly=O(1030+50*a.saveStateSlot);a.isMBC1=O(1031+50*a.saveStateSlot);a.isMBC2=O(1032+50*a.saveStateSlot);a.isMBC3=O(1033+50*a.saveStateSlot);
a.isMBC5=O(1034+50*a.saveStateSlot)};a.cartridgeRomLocation=0;a.switchableCartridgeRomLocation=16384;a.videoRamLocation=32768;a.cartridgeRamLocation=40960;a.internalRamBankZeroLocation=49152;a.internalRamBankOneLocation=53248;a.echoRamLocation=57344;a.spriteInformationTableLocation=65024;a.spriteInformationTableLocationEnd=65183;a.unusableMemoryLocation=65184;a.unusableMemoryEndLocation=65279;a.currentRomBank=0;a.currentRamBank=0;a.isRamBankingEnabled=!1;a.isMBC1RomModeEnabled=!0;a.isRomOnly=!0;a.isMBC1=
!1;a.isMBC2=!1;a.isMBC3=!1;a.isMBC5=!1;a.memoryLocationHdmaSourceHigh=65361;a.memoryLocationHdmaSourceLow=65362;a.memoryLocationHdmaDestinationHigh=65363;a.memoryLocationHdmaDestinationLow=65364;a.memoryLocationHdmaTrigger=65365;a.DMACycles=0;a.isHblankHdmaActive=!1;a.hblankHdmaTransferLengthRemaining=0;a.hblankHdmaSource=0;a.hblankHdmaDestination=0;a.memoryLocationGBCVRAMBank=65359;a.memoryLocationGBCWRAMBank=65392;a.saveStateSlot=4;return a}(),b=function(){function a(){}a.CLOCK_SPEED=function(){return a.GBCDoubleSpeed?
8388608:4194304};a.MAX_CYCLES_PER_FRAME=function(){return a.GBCDoubleSpeed?140448:70224};a.enableHalt=function(){k.masterInterruptSwitch?a.isHaltNormal=!0:0===(k.interruptsEnabledValue&k.interruptsRequestedValue&31)?a.isHaltNoJump=!0:a.isHaltBug=!0};a.exitHaltAndStop=function(){a.isHaltNoJump=!1;a.isHaltNormal=!1;a.isHaltBug=!1;a.isStopped=!1};a.isHalted=function(){return a.isHaltNormal||a.isHaltNoJump?!0:!1};a.saveState=function(){g[1024+50*a.saveStateSlot]=a.registerA;g[1025+50*a.saveStateSlot]=
a.registerB;g[1026+50*a.saveStateSlot]=a.registerC;g[1027+50*a.saveStateSlot]=a.registerD;g[1028+50*a.saveStateSlot]=a.registerE;g[1029+50*a.saveStateSlot]=a.registerH;g[1030+50*a.saveStateSlot]=a.registerL;g[1031+50*a.saveStateSlot]=a.registerF;g[1032+50*a.saveStateSlot]=a.stackPointer;g[1034+50*a.saveStateSlot]=a.programCounter;g[1036+50*a.saveStateSlot]=a.currentCycles;N(1041+50*a.saveStateSlot,a.isHaltNormal);N(1042+50*a.saveStateSlot,a.isHaltNoJump);N(1043+50*a.saveStateSlot,a.isHaltBug);N(1044+
50*a.saveStateSlot,a.isStopped)};a.loadState=function(){a.registerA=g[1024+50*a.saveStateSlot];a.registerB=g[1025+50*a.saveStateSlot];a.registerC=g[1026+50*a.saveStateSlot];a.registerD=g[1027+50*a.saveStateSlot];a.registerE=g[1028+50*a.saveStateSlot];a.registerH=g[1029+50*a.saveStateSlot];a.registerL=g[1030+50*a.saveStateSlot];a.registerF=g[1031+50*a.saveStateSlot];a.stackPointer=g[1032+50*a.saveStateSlot];a.programCounter=g[1034+50*a.saveStateSlot];a.currentCycles=g[1036+50*a.saveStateSlot];a.isHaltNormal=
O(1041+50*a.saveStateSlot);a.isHaltNoJump=O(1042+50*a.saveStateSlot);a.isHaltBug=O(1043+50*a.saveStateSlot);a.isStopped=O(1044+50*a.saveStateSlot)};a.GBCEnabled=!1;a.memoryLocationSpeedSwitch=65357;a.GBCDoubleSpeed=!1;a.registerA=0;a.registerB=0;a.registerC=0;a.registerD=0;a.registerE=0;a.registerH=0;a.registerL=0;a.registerF=0;a.stackPointer=0;a.programCounter=0;a.currentCycles=0;a.isHaltNormal=!1;a.isHaltNoJump=!1;a.isHaltBug=!1;a.isStopped=!1;a.saveStateSlot=0;return a}(),T=function(){function a(){}
a.cyclesPerCycleSet=2E9;a.cycleSets=0;a.cycles=0;return a}(),L=function(){function a(){}a.stepsPerStepSet=2E9;a.stepSets=0;a.steps=0;a.RESPONSE_CONDITION_ERROR=-1;a.RESPONSE_CONDITION_FRAME=0;a.RESPONSE_CONDITION_AUDIO=1;a.RESPONSE_CONDITION_BREAKPOINT=2;return a}();Ga.size()<nb&&Ga.grow(nb-Ga.size());var Fa=!1,Tb=Object.freeze({memory:Ga,config:function(a,c,f,g,n,l,m,t,v,x){M.enableBootRom=0<a?!0:!1;M.useGbcWhenAvailable=0<c?!0:!1;M.audioBatchProcessing=0<f?!0:!1;M.graphicsBatchProcessing=0<g?!0:
!1;M.timersBatchProcessing=0<n?!0:!1;M.graphicsDisableScanlineRendering=0<l?!0:!1;M.audioAccumulateSamples=0<m?!0:!1;M.tileRendering=0<t?!0:!1;M.tileCaching=0<v?!0:!1;M.enableAudioDebugging=0<x?!0:!1;a=w(323);b.GBCEnabled=192===a||M.useGbcWhenAvailable&&128===a?!0:!1;b.GBCDoubleSpeed=!1;b.registerA=0;b.registerB=0;b.registerC=0;b.registerD=0;b.registerE=0;b.registerH=0;b.registerL=0;b.registerF=0;b.stackPointer=0;b.programCounter=0;b.currentCycles=0;b.isHaltNormal=!1;b.isHaltNoJump=!1;b.isHaltBug=
!1;b.isStopped=!1;b.GBCEnabled?(b.registerA=17,b.registerF=128,b.registerB=0,b.registerC=0,b.registerD=255,b.registerE=86,b.registerH=0,b.registerL=13):(b.registerA=1,b.registerF=176,b.registerB=0,b.registerC=19,b.registerD=0,b.registerE=216,b.registerH=1,b.registerL=77);b.programCounter=256;b.stackPointer=65534;d.isRamBankingEnabled=!1;d.isMBC1RomModeEnabled=!0;a=w(327);d.isRomOnly=!1;d.isMBC1=!1;d.isMBC2=!1;d.isMBC3=!1;d.isMBC5=!1;0===a?d.isRomOnly=!0:1<=a&&3>=a?d.isMBC1=!0:5<=a&&6>=a?d.isMBC2=
!0:15<=a&&19>=a?d.isMBC3=!0:25<=a&&30>=a&&(d.isMBC5=!0);d.currentRomBank=1;d.currentRamBank=0;e(65361,255);e(65362,255);e(65363,255);e(65364,255);e(65365,255);q.currentCycles=0;q.scanlineCycleCounter=0;q.scanlineRegister=0;q.scrollX=0;q.scrollY=0;q.windowX=0;q.windowY=0;b.GBCEnabled?(q.scanlineRegister=144,e(65344,145),e(65345,129),e(65348,144),e(65351,252)):(q.scanlineRegister=144,e(65344,145),e(65345,133),e(65350,255),e(65351,252),e(65352,255),e(65353,255));e(65359,0);e(65392,1);b.GBCEnabled?(e(65384,
192),e(65385,255),e(65386,193),e(65387,13)):(e(65384,255),e(65385,255),e(65386,255),e(65387,255));h.currentCycles=0;h.NR50LeftMixerVolume=0;h.NR50RightMixerVolume=0;h.NR51IsChannel1EnabledOnLeftOutput=!0;h.NR51IsChannel2EnabledOnLeftOutput=!0;h.NR51IsChannel3EnabledOnLeftOutput=!0;h.NR51IsChannel4EnabledOnLeftOutput=!0;h.NR51IsChannel1EnabledOnRightOutput=!0;h.NR51IsChannel2EnabledOnRightOutput=!0;h.NR51IsChannel3EnabledOnRightOutput=!0;h.NR51IsChannel4EnabledOnRightOutput=!0;h.NR52IsSoundEnabled=
!0;h.frameSequenceCycleCounter=0;h.downSampleCycleCounter=0;h.frameSequencer=0;h.audioQueueIndex=0;u.initialize();I.initialize();G.initialize();J.initialize();e(h.memoryLocationNR50,119);e(h.memoryLocationNR51,243);e(h.memoryLocationNR52,241);r.channel1Sample=15;r.channel2Sample=15;r.channel3Sample=15;r.channel4Sample=15;r.channel1DacEnabled=!1;r.channel2DacEnabled=!1;r.channel3DacEnabled=!1;r.channel4DacEnabled=!1;r.leftChannelSampleUnsignedByte=127;r.rightChannelSampleUnsignedByte=127;r.mixerVolumeChanged=
!0;r.mixerEnabledChanged=!0;r.needToRemixSamples=!1;k.updateInterruptEnabled(0);e(k.memoryLocationInterruptEnabled,k.interruptsEnabledValue);k.updateInterruptRequested(225);e(k.memoryLocationInterruptRequest,k.interruptsRequestedValue);p.currentCycles=0;p.dividerRegister=0;p.timerCounter=0;p.timerModulo=0;p.timerEnabled=!1;p.timerInputClock=0;p.timerCounterOverflowDelay=!1;p.timerCounterWasReset=!1;b.GBCEnabled?(e(65284,30),p.dividerRegister=7840):(e(65284,171),p.dividerRegister=43980);e(65287,248);
p.timerInputClock=248;K.currentCycles=0;K.numberOfBitsTransferred=0;b.GBCEnabled?(e(65282,124),K.updateTransferControl(124)):(e(65282,126),K.updateTransferControl(126));b.GBCEnabled?(e(65392,248),e(65359,254),e(65357,126),e(65280,207),e(65295,225),e(65388,254),e(65397,143)):(e(65392,255),e(65359,255),e(65357,255),e(65280,207),e(65295,225));Fa=!1;T.cyclesPerCycleSet=2E9;T.cycleSets=0;T.cycles=0;L.stepsPerStepSet=2E9;L.stepSets=0;L.steps=0},hasCoreStarted:function(){return Fa?1:0},saveState:function(){b.saveState();
q.saveState();k.saveState();y.saveState();d.saveState();p.saveState();h.saveState();u.saveState();I.saveState();G.saveState();J.saveState();Fa=!1},loadState:function(){b.loadState();q.loadState();k.loadState();y.loadState();d.loadState();p.loadState();h.loadState();u.loadState();I.loadState();G.loadState();J.loadState();Fa=!1;T.cyclesPerCycleSet=2E9;T.cycleSets=0;T.cycles=0;L.stepsPerStepSet=2E9;L.stepSets=0;L.steps=0},isGBC:function(){return b.GBCEnabled?1:0},getStepsPerStepSet:function(){return L.stepsPerStepSet},
getStepSets:function(){return L.stepSets},getSteps:function(){return L.steps},executeMultipleFrames:function(a){for(var b=0,d=0;d<a&&0<=b;)b=jb(),d+=1;return 0>b?b:0},executeFrame:jb,executeFrameAndCheckAudio:function(a){void 0===a&&(a=0);return Ea(!0,a,-1)},executeFrameUntilBreakpoint:function(a){return Ea(!0,-1,a)},executeFrameAndCheckAudioUntilBreakpoint:function(a,b){return Ea(!0,a,b)},executeUntilCondition:Ea,executeStep:kb,getCyclesPerCycleSet:function(){return T.cyclesPerCycleSet},getCycleSets:function(){return T.cycleSets},
getCycles:function(){return T.cycles},setJoypadState:function(a,b,d,e,g,h,n,l){0<a?na(0):aa(0,!1);0<b?na(1):aa(1,!1);0<d?na(2):aa(2,!1);0<e?na(3):aa(3,!1);0<g?na(4):aa(4,!1);0<h?na(5):aa(5,!1);0<n?na(6):aa(6,!1);0<l?na(7):aa(7,!1)},getNumberOfSamplesInAudioBuffer:ab,clearAudioBuffer:bb,WASMBOY_MEMORY_LOCATION:0,WASMBOY_MEMORY_SIZE:mb,WASMBOY_WASM_PAGES:nb,ASSEMBLYSCRIPT_MEMORY_LOCATION:0,ASSEMBLYSCRIPT_MEMORY_SIZE:1024,WASMBOY_STATE_LOCATION:1024,WASMBOY_STATE_SIZE:1024,GAMEBOY_INTERNAL_MEMORY_LOCATION:2048,
GAMEBOY_INTERNAL_MEMORY_SIZE:65536,VIDEO_RAM_LOCATION:2048,VIDEO_RAM_SIZE:16384,WORK_RAM_LOCATION:18432,WORK_RAM_SIZE:32768,OTHER_GAMEBOY_INTERNAL_MEMORY_LOCATION:51200,OTHER_GAMEBOY_INTERNAL_MEMORY_SIZE:16384,GRAPHICS_OUTPUT_LOCATION:67584,GRAPHICS_OUTPUT_SIZE:xb,GBC_PALETTE_LOCATION:67584,GBC_PALETTE_SIZE:128,BG_PRIORITY_MAP_LOCATION:67712,BG_PRIORITY_MAP_SIZE:23552,FRAME_LOCATION:wa,FRAME_SIZE:93184,BACKGROUND_MAP_LOCATION:Ha,BACKGROUND_MAP_SIZE:196608,TILE_DATA_LOCATION:Ra,TILE_DATA_SIZE:147456,
OAM_TILES_LOCATION:Sa,OAM_TILES_SIZE:15360,AUDIO_BUFFER_LOCATION:za,AUDIO_BUFFER_SIZE:131072,CHANNEL_1_BUFFER_LOCATION:Xa,CHANNEL_1_BUFFER_SIZE:131072,CHANNEL_2_BUFFER_LOCATION:Ya,CHANNEL_2_BUFFER_SIZE:131072,CHANNEL_3_BUFFER_LOCATION:Za,CHANNEL_3_BUFFER_SIZE:131072,CHANNEL_4_BUFFER_LOCATION:$a,CHANNEL_4_BUFFER_SIZE:131072,CARTRIDGE_RAM_LOCATION:Qa,CARTRIDGE_RAM_SIZE:131072,CARTRIDGE_ROM_LOCATION:Ca,CARTRIDGE_ROM_SIZE:8258560,DEBUG_GAMEBOY_MEMORY_LOCATION:lb,DEBUG_GAMEBOY_MEMORY_SIZE:65535,getWasmBoyOffsetFromGameBoyOffset:gb,
getRegisterA:function(){return b.registerA},getRegisterB:function(){return b.registerB},getRegisterC:function(){return b.registerC},getRegisterD:function(){return b.registerD},getRegisterE:function(){return b.registerE},getRegisterH:function(){return b.registerH},getRegisterL:function(){return b.registerL},getRegisterF:function(){return b.registerF},getProgramCounter:function(){return b.programCounter},getStackPointer:function(){return b.stackPointer},getOpcodeAtProgramCounter:function(){return w(b.programCounter)},
getLY:function(){return q.scanlineRegister},drawBackgroundMapToWasmMemory:function(a){var c=q.memoryLocationTileDataSelectZeroStart;x.bgWindowTileDataSelect&&(c=q.memoryLocationTileDataSelectOneStart);var d=q.memoryLocationTileMapSelectZeroStart;x.bgTileMapDisplaySelect&&(d=q.memoryLocationTileMapSelectOneStart);for(var e=0;256>e;e++)for(var h=0;256>h;h++){var l=e,m=h,k=d+32*(l>>3)+(m>>3),p=U(k,0);p=ya(c,p);var r=l%8;l=m%8;l=7-l;m=0;b.GBCEnabled&&0<a&&(m=U(k,1));n(6,m)&&(r=7-r);var t=0;n(3,m)&&(t=
1);k=U(p+2*r,t);p=U(p+2*r+1,t);r=0;n(l,p)&&(r+=1,r<<=1);n(l,k)&&(r+=1);p=3*(256*e+h);if(b.GBCEnabled&&0<a)m=Ka(m&7,r,!1),l=Y(0,m),k=Y(1,m),r=Y(2,m),m=Ha+p,g[m]=l,g[m+1]=k,g[m+2]=r;else for(l=Ja(r,q.memoryLocationBackgroundPalette),k=0;3>k;k++)m=Ha+p+k,g[m]=l}},drawTileDataToWasmMemory:function(){for(var a=0;23>a;a++)for(var c=0;31>c;c++){var d=0;15<c&&(d=1);var e=a;15<a&&(e-=15);e<<=4;e=15<c?e+(c-15):e+c;var h=q.memoryLocationTileDataSelectOneStart;15<a&&(h=q.memoryLocationTileDataSelectZeroStart);
for(var g=q.memoryLocationBackgroundPalette,m=-1,l=-1,k=0;8>k;k++)for(var p=0;5>p;p++){var r=4*(8*p+k),t=w(q.memoryLocationSpriteAttributesTable+r+2);e===t&&(r=w(q.memoryLocationSpriteAttributesTable+r+3),t=0,b.GBCEnabled&&n(3,r)&&(t=1),t===d&&(l=r,k=8,p=5,g=q.memoryLocationSpritePaletteOne,n(4,l)&&(g=q.memoryLocationSpritePaletteTwo)))}if(b.GBCEnabled&&0>l){k=q.memoryLocationTileMapSelectZeroStart;x.bgTileMapDisplaySelect&&(k=q.memoryLocationTileMapSelectOneStart);p=-1;for(r=0;32>r;r++)for(t=0;32>
t;t++){var u=k+32*t+r,v=U(u,0);e===v&&(p=u,t=r=32)}0<=p&&(m=U(p,1))}for(k=0;8>k;k++)Va(e,h,d,0,7,k,8*c,8*a+k,248,Ra,!1,g,m,l)}},drawOamToWasmMemory:function(){for(var a=0;8>a;a++)for(var c=0;5>c;c++){var d=4*(8*c+a);w(q.memoryLocationSpriteAttributesTable+d);w(q.memoryLocationSpriteAttributesTable+d+1);var e=w(q.memoryLocationSpriteAttributesTable+d+2),g=1;x.tallSpriteSize&&(1===e%2&&--e,g+=1);d=w(q.memoryLocationSpriteAttributesTable+d+3);var h=0;b.GBCEnabled&&n(3,d)&&(h=1);var m=q.memoryLocationSpritePaletteOne;
n(4,d)&&(m=q.memoryLocationSpritePaletteTwo);for(var k=0;k<g;k++)for(var l=0;8>l;l++)Va(e+k,q.memoryLocationTileDataSelectOneStart,h,0,7,l,8*a,16*c+l+8*k,64,Sa,!1,m,-1,d)}},getDIV:function(){return p.dividerRegister},getTIMA:function(){return p.timerCounter},getTMA:function(){return p.timerModulo},getTAC:function(){var a=p.timerInputClock;p.timerEnabled&&(a|=4);return a},updateDebugGBMemory:function(){for(var a=0;65535>a;a++){var b=fb(a);g[lb+a]=b}},update:jb,emulationStep:kb,getAudioQueueIndex:ab,
resetAudioQueue:bb,wasmMemorySize:mb,wasmBoyInternalStateLocation:1024,wasmBoyInternalStateSize:1024,gameBoyInternalMemoryLocation:2048,gameBoyInternalMemorySize:65536,videoOutputLocation:67584,frameInProgressVideoOutputLocation:wa,gameboyColorPaletteLocation:67584,gameboyColorPaletteSize:128,backgroundMapLocation:Ha,tileDataMap:Ra,soundOutputLocation:za,gameBytesLocation:Ca,gameRamBanksLocation:Qa});return async()=>({instance:{exports:Tb},byteMemory:Ga.wasmByteMemory,type:"TypeScript"})}();
